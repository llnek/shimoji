!function(t,e,r){var n,s=256,i="random",o=r.pow(s,6),l=r.pow(2,52),a=2*l,c=255;function h(c,h,m){function g(){for(var t=w.g(6),e=o,r=0;t<l;)t=(t+r)*s,e*=s,r=w.g(1);for(;a<=t;)t/=2,e/=2,r>>>=1;return(t+r)/e}var y=[],x=p(function t(e,r){var n,s=[],i=typeof e;if(r&&"object"==i)for(n in e)try{s.push(t(e[n],r-1))}catch(t){}return s.length?s:"string"==i?e:e+"\0"}((h=1==h?{entropy:!0}:h||{}).entropy?[c,d(e)]:null==c?function(){try{var r;return n&&(r=n.randomBytes)?r=r(s):(r=new Uint8Array(s),(t.crypto||t.msCrypto).getRandomValues(r)),d(r)}catch(r){var i=t.navigator,o=i&&i.plugins;return[+new Date,t,o,t.screen,d(e)]}}():c,3),y),w=new u(y);return g.int32=function(){return 0|w.g(4)},g.quick=function(){return w.g(4)/4294967296},g.double=g,p(d(w.S),e),(h.pass||m||function(t,e,n,s){return s&&(s.S&&f(s,w),t.state=function(){return f(w,{})}),n?(r[i]=t,e):t})(g,x,"global"in h?h.global:this==r,h.state)}function u(t){var e,r=t.length,n=this,i=0,o=n.i=n.j=0,l=n.S=[];for(r||(t=[r++]);i<s;)l[i]=i++;for(i=0;i<s;i++)l[i]=l[o=c&o+t[i%r]+(e=l[i])],l[o]=e;(n.g=function(t){for(var e,r=0,i=n.i,o=n.j,l=n.S;t--;)e=l[i=c&i+1],r=r*s+l[c&(l[i]=l[o=c&o+e])+(l[o]=e)];return n.i=i,n.j=o,r})(s)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){for(var r,n=t+"",s=0;s<n.length;)e[c&s]=c&(r^=19*e[c&s])+n.charCodeAt(s++);return d(e)}function d(t){return String.fromCharCode.apply(0,t)}if(p(r.random(),e),"object"==typeof module&&module.exports){module.exports=h;try{n=require("crypto")}catch(h){}}else"function"==typeof define&&define.amd?define((function(){return h})):r["seed"+i]=h}("undefined"!=typeof self?self:this,[],Math),"function"!=typeof JSON.decycle&&(JSON.decycle=function(t,e){"use strict";var r=new WeakMap;return function t(n,s){var i,o;return void 0!==e&&(n=e(n)),"object"!=typeof n||null===n||n instanceof Boolean||n instanceof Date||n instanceof Number||n instanceof RegExp||n instanceof String?n:void 0!==(i=r.get(n))?{$ref:i}:(r.set(n,s),Array.isArray(n)?(o=[],n.forEach((function(e,r){o[r]=t(e,s+"["+r+"]")}))):(o={},Object.keys(n).forEach((function(e){o[e]=t(n[e],s+"["+JSON.stringify(e)+"]")}))),o)}(t,"$")}),"function"!=typeof JSON.retrocycle&&(JSON.retrocycle=function retrocycle($){"use strict";var px=/^\$(?:\[(?:\d+|"(?:[^\\"\u0000-\u001f]|\\(?:[\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*")\])*$/;return function rez(value){value&&"object"==typeof value&&(Array.isArray(value)?value.forEach((function(element,i){if("object"==typeof element&&null!==element){var path=element.$ref;"string"==typeof path&&px.test(path)?value[i]=eval(path):rez(element)}})):Object.keys(value).forEach((function(name){var item=value[name];if("object"==typeof item&&null!==item){var path=item.$ref;"string"==typeof path&&px.test(path)?value[name]=eval(path):rez(item)}})))}($),$}),function(t,e,r,n){"use strict";function s(){const r=t,s=Math.floor,i=Array.prototype.slice,o=Object.prototype.toString;function l(t){return"[object Object]"==o.call(t)}function a(t){return l(t)}function c(t){return"[object Function]"==o.call(t)}function h(t){return"[object Array]"==o.call(t)}function u(t){return"[object Map]"==o.call(t)}function f(t){return"[object Set]"==o.call(t)}function p(t){return"[object String]"==o.call(t)}function d(t){return"[object Number]"==o.call(t)}function m(t){return"[object Boolean]"==o.call(t)}function g(t){return(t<0?-t:t)%2==0}function y(t){return void 0===t}function x(t){return h(t)||u(t)||l(t)}const w=1.6180339887,b=Math.seedrandom?new Math.seedrandom:function(){return Math.random()};function v(t,e){return t.forEach((t=>{if(!t[0](t[1]))throw new TypeError(`wanted ${e}`)})),!0}function M(t,e){for(let e,r=0;r<t.length;++r)if(e=t[r],e[0](e[1]))return!0;throw new TypeError(`wanted ${e}`)}function E(t,e,r){if(!t(e))throw new TypeError(`wanted ${r}`);return!0}const k=/(\/|\\\\)([^(\/|\\\\)]+)$/g,q=/(\.[^\.\/\?\\]*)(\?.*)?$/;function j(t,e){let r=q.exec(t);return r&&r[1]?(r=r[1].toLowerCase(),e||(r=r.substring(1))):r="",r}function S(t,e,r){const n=t(e);switch(r.length){case 0:return n;case 1:return n&&t(r[0]);case 2:return n&&t(r[0])&&t(r[1]);case 3:return n&&t(r[0])&&t(r[1])&&t(r[2]);default:return n&&r.every((e=>t(e)))}}const $=1e-10;let z=0;const A={},P={fun:(t,...e)=>S(c,t,e),str:(t,...e)=>S(p,t,e),undef:(t,...e)=>S(y,t,e),map:(t,...e)=>S(u,t,e),set:(t,...e)=>S(f,t,e),num:(t,...e)=>S(d,t,e),bool:(t,...e)=>S(m,t,e),pos:t=>d(t)&&t>0,neg:t=>d(t)&&t<0,vec:(t,...e)=>S(h,t,e),vecN:(t,e,r=!1)=>h(t)&&(r?t.length==e:t.length>=e),obj:(t,...e)=>S(l,t,e),notEmpty:t=>C.size(t)>0,isEmpty:t=>0==C.size(t),own:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},C={SORT_DESC:1,SORT_ASC:-1,error(...t){console.error(...t)},warn(...t){console.warn(...t)},log(...t){console.log(...t)},ndiv:(t,e)=>Math.floor(t/e),feq0:t=>t>=-1e-10&&t<=$,feq:(t,e,r=1e-10)=>t>=e-r&&t<=e+r,hexToBin(t){const e={0:"0000",1:"0001",2:"0010",3:"0011",4:"0100",5:"0101",6:"0110",7:"0111",8:"1000",9:"1001",a:"1010",b:"1011",c:"1100",d:"1101",e:"1110",f:"1111",A:"1010",B:"1011",C:"1100",D:"1101",E:"1110",F:"1111"};let r="";for(let s,i=0;i<t.length;++i){if(!(s=e[t[i]])){r=n;break}r+=s}return r},pack:t=>JSON.stringify(t),unpack:t=>JSON.parse(t),v2:(t=0,e=0)=>[t,e],p2:(t=0,e=0)=>({x:t,y:e}),numOrZero:t=>isNaN(t)?0:t,setVec:(t,...e)=>(e.forEach(((e,r)=>t[r]=e)),t),evenN:(t,e=!1)=>g(t=s(t))?t:e?t+1:t-1,nichts:t=>null==t,echt:t=>null!=t,nor:(t,e)=>null==t?e:t,or:(t,e)=>void 0===t?e:t,toNum(t,e){const r=parseFloat(t);return isNaN(r)&&d(e)?e:r},percentRemain:(t,e,r=!1)=>(t>e&&(t=r?t%e:e),Math.max(0,e-t)/e),splitVerStr(t){const e=(""+(t||"")).split(".").filter((t=>t.length>0));return[this.toNum(e[0],0),this.toNum(e[1],0),this.toNum(e[2],0)]},cmpVerStrs(t,e){let r=this.splitVerStr(""+t),n=this.splitVerStr(""+e);return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]>n[1]?1:r[1]<n[1]?-1:r[2]>n[2]?1:r[2]<n[2]?-1:0},pdef:t=>(t.configurable=!0)&&(t.enumerable=!0)&&t,findFiles:(t,e)=>t.filter((t=>e.indexOf(j(t,1))>-1)),zipMap(t,e,r=n){let s,i=Math.min(t.length,e.length),o=r||new Map;for(s=0;s<i;++s)o.set(t[s],e[s]);return o},zip(t,e,r=n){return this.zipMap(t,e,r)},zipObj(t,e,r=n){let s,i=Math.min(t.length,e.length),o=r||{};for(s=0;s<i;++s)o[t[s]]=e[s];return o},partition(t,e){const r=[];for(let n,s,i=0;;){for(n=[],s=0;s<t;++s){if(!(i<e.length)){s=-1;break}n.push(e[i++])}if(n.length>0&&r.push(n),s<0)break}return r},keys:t=>u(t)?Array.from(t.keys()):l(t)?Object.keys(t):[],selectNotKeys(t,e){M([[u,t],[l,t]],"map/object");const r=u(t)?new Map:{};return e=this.seq(e),this.doseq(t,((t,n)=>!e.includes(n)&&this.assoc(r,n,t))),r},selectKeys(t,e){M([[u,t],[l,t]],"map/object");const r=u(t)?new Map:{};return this.seq(e).forEach((e=>{u(t)?t.has(e)&&r.set(e,t.get(e)):P.own(t,e)&&(r[e]=t[e])})),r},copyKeys(t,e,r){return M([[u,t],[l,t]],"map/object"),e instanceof Map&&C.assert(t instanceof Map,"expected Map"),this.seq(r).forEach((r=>{u(e)?e.has(r)&&t.set(r,e.get(r)):(P.own(e,r)||void 0!==e[r])&&(t[r]=e[r])})),t},setManyKeys(t,e,r){return M([[u,t],[l,t]],"map/object"),this.seq(e).forEach((e=>{u(t)?t.set(e,r):t[e]=r})),t},clearKeys(t,e){return M([[u,t],[l,t]],"map/object"),this.seq(e).forEach((e=>{u(t)?t.delete(e):delete t[e]})),t},assertNot(t,...e){return this.assert(!t,...e)},assert(t,...e){if(!t)throw 0==e.length?"Assertion!":e.join("");return!0},noSuchKeys(t,e){return!this.some(this.seq(t),(t=>this.has(e,t)?t:null))},randInt2:(t,e)=>t+s(b()*(e-t+1)),randFloat2:(t,e)=>t+b()*(e-t),randMinus1To1:()=>2*(b()-.5),randInt:t=>s(b()*t),rand:(t=!1)=>t?Math.random():b(),randGaussian(t=6){let e,r=0;for(e=0;e<t;++e)r+=this.rand();return r/t},randSign:()=>b()>.5?-1:1,toGoldenRatio(t){let e=t/w,r=e/w;return[this.rounded(e),this.rounded(r)]},inst:(t,e)=>e instanceof t,hashCode(t){let e,r=0;for(e=0;e<t.length;++e)r=Math.imul(31,r)+t.charCodeAt(e);return r},cls(t){return this.trunc(t)},trunc(t){try{t.length=0}catch(t){}return t},randSample(t,e=1){let r,n;return 1==e?n=[this.randItem(t)]:0==e?n=[]:e>0&&(r=this.shuffle(t,!1),n=e>=r.length?r:r.slice(0,e)),n},randItem(t,e=!1){let r,n=-1;if(t)switch(t.length){case 0:case 1:r=t[n=0];break;case 2:r=t[n=this.randSign()>0?1:0];break;default:r=t[n=s(b()*t.length)]}return e?[r,n]:r},randAorB:(t,e)=>b()>.5?t:e,isPerc:t=>p(t)&&t.match(/^([0-9])(\.?[0-9]+|[0-9]*)%$/),isEven:t=>g(t),jsMap(...t){E(g,t.length,"even n# of args");let e,r=new Map;for(e=0;e<t.length;)r.set(t[e],t[e+1]),e+=2;return r},jsObj(...t){E(g,t.length,"even n# of args");let e,r={};for(e=0;e<t.length;)r[t[e]]=t[e+1],e+=2;return r},jsVec:(...t)=>0==t.length?[]:t.slice(),lastIndex:t=>h(t)&&t.length>0?t.length-1:-1,first(t){if(h(t)&&t.length>0)return t[0]},last(t){if(h(t)&&t.length>0)return t[t.length-1]},head(t){return this.first(t)},tail(t){return this.last(t)},floor:t=>Math.floor(t),ceil:t=>Math.ceil(t),abs:t=>Math.abs(t),sqrt:t=>Math.sqrt(t),min:(...t)=>Math.min(...t),max:(...t)=>Math.max(...t),slice:(t,e)=>i.call(t,e),every(t,e){E(h,t,"array");for(let r=0;r<t.length;++r)if(c(e)){if(!e(t[r]))return!1}else if(t[r]!=e)return!1;return t.length>0},notAny(t,e){E(h,t,"array");for(let r=0;r<t.length;++r)if(c(e)){if(e(t[r]))return!1}else if(t[r]===e)return!1;return t.length>0},copy(t,e=[]){v([[h,t],[h,e]],"arrays");let r,n=Math.min(t.length,e.length);for(r=0;r<n;++r)t[r]=e[r];return t},append(t,e=[],r=!1){v([[h,t],[h,e]],"arrays"),r&&(t.length=0);for(let r=0;r<e.length;++r)t.push(e[r]);return t},fill(t,e,...r){if(d(t)&&(t=new Array(t)),h(t))for(let n=0;n<t.length;++n)t[n]=c(e)?e(n,...r):e;return t},size(t){return h(t)||p(t)?t.length:f(t)||u(t)?t.size:t?this.keys(t).length:0},nextId:()=>++z,now:()=>Date.now(),fileExt:t=>j(t),fileBase(t){let e,r,n=t.indexOf("?");return n>0&&(t=t.substring(0,n)),t=t.replace(/(\/|\\\\)$/,""),r=k.exec(t),e="",r&&(e=r[2],n=e.lastIndexOf("."),n>0&&(e=e.substring(0,n))),e},range(t,e,r=1){1==arguments.length&&(e=t,t=0,r=1);let n=(e-t)/r;const s=[];n=Math.ceil(n),n=Math.max(0,n),s.length=n;for(let e=0;e<n;++e)s[e]=t,t+=r;return s},shuffle(t,e=!0){E(h,t,"array");const r=i.call(t,0);switch(r.length){case 0:case 1:break;case 2:if(this.randSign()>0){let t=r[0];r[0]=r[1],r[1]=t}break;default:for(let t,e,n=r.length-1;n>0;--n)e=s(b()*(n+1)),t=r[n],r[n]=r[e],r[e]=t}return e?this.copy(t,r):r},shuffle2(t,e=!0){E(h,t,"array");const r=i.call(t,0);switch(r.length){case 0:case 1:break;case 2:if(this.randSign()>0){let t=r[0];r[0]=r[1],r[1]=t}break;default:for(let t,e,n=0,i=r.length;n<i;++n)e=n+s(b()*(i-n)),t=r[e],r[e]=r[n],r[n]=t}return e?this.copy(t,r):r},shuffle3(t,e=!0){return(e?t:i.call(t,0)).sort(((t,e)=>this.rand()>.5?-1:this.rand()>.5?1:0))},uniq:t=>(E(h,t,"array"),Array.from(new Set(t))),map(t,e,r){if(E(x,t,"array/map/object"),h(t))return t.map(e,r);{const n=u(t)?new Map:{};return this.doseq(t,((s,i)=>{this.assoc(n,i,e.call(r,s,i,t))})),n}},find(t,e,r){let n,s=!0,o=i.call(arguments,3);return this.doseq(t,((t,i)=>{s&&e.apply(r,[t,i].concat(o))&&(n=[i,t],s=!1)})),n},some(t,e,r){let n,s=!0,o=i.call(arguments,3);return this.doseq(t,((t,i)=>{s&&(n=e.apply(r,[t,i].concat(o)),n?s=!1:n=void 0)})),n},equals(t,e){if(a(t)&&a(e)){let r,n,s=Object.keys(t),i=Object.keys(e);if(s.length==i.length){for(let o=0;o<s.length;++o)if(r=s[o],n=i[o],!this.equals(r,n)||!this.equals(t[r],e[n]))return!1;return!0}return!1}if(h(t)&&h(e)){if(t.length==e.length){for(let r=0;r<t.length;++r)if(!this.equals(t[r],e[r]))return!1;return!0}return!1}if(d(t)&&d(e))return t==e;if(p(t)&&p(e))return t==e;if(m(t)&&m(e))return t==e;if(null===t&&null===e)return!0;if(void 0===t&&void 0===e)return!0;throw Error("cant call equals for these types")},invoke(t,e){let r=i.call(arguments,2);h(t)&&t.forEach((t=>t[e].apply(t,r)))},delay:(t,e)=>setTimeout(e,t),timer:(t,e=0,r=!1)=>({repeat:!!r,id:r?setInterval(t,e):setTimeout(t,e)}),clear(t){t&&t.id?(t.repeat?clearInterval(t.id):clearTimeout(t.id),t.id=0):P.pos(t)&&clearTimeout(t)},rmap:(t,e,r,n,s)=>(t-e)/(r-e)*(s-n)+n,dotimes(t,e,r,...n){for(let s=0;s<t;++s)e.call(r,s,...n)},rseq(t,e,r){if(E(h,t,"array"),t.length>0)for(let n=t.length-1;n>=0;--n)e.call(r,t[n],n,t)},doseq(t,e,r){h(t)?t.forEach(e,r):u(t)?t.forEach(((n,s)=>e.call(r,n,s,t))):l(t)&&Object.keys(t).forEach((n=>e.call(r,t[n],n,t)))},doseqEx(t,e,r){this.doseq(t,((n,s)=>null!=n&&e.call(r,n,s,t)))},dissoc(t,e){if(arguments.length>2){let e,r=1;for(;r<arguments.length;++r)e=this.dissoc(t,arguments[r]);return e}{let r;return u(t)?(r=t.get(e),t.delete(e)):l(t)&&(r=t[e],delete t[e]),r}},get(t,e){if(void 0!==e){if(u(t))return t.get(e);if(t)return t[e]}},assoc(t,e,r){if(arguments.length>3){if((arguments.length-1)%2!=0)throw"wanted even count of args";let e,r=1;for(;r<arguments.length;)e=this.assoc(t,arguments[r],arguments[r+1]),r+=2;return e}{let n;return u(t)?(n=t.get(e),t.set(e,r)):t&&(n=t[e],t[e]=r),n}},disj(t,e){const r=t?t.indexOf(e):-1;return r>-1&&t.splice(r,1),r>-1},conj:(t,...e)=>(t&&e.forEach((e=>t.push(e))),t),seq:(t,e=/[,; \t\n]+/)=>("string"==typeof t&&(t=t.split(e).map((t=>t.trim())).filter((t=>t.length>0))),h(t)||(t=[t]),t),has(t,e){return 1!=arguments.length&&(u(t)?t.has(e):h(t)?-1!=t.indexOf(e):!!l(t)&&P.own(t,e))},patch(t,e){return E(l,t=t||{},"object"),e&&Object.keys(e).forEach((r=>{this.has(t,r)||(t[r]=e[r])})),t},clone(t){return t?this.unpack(this.pack(t)):t},inject:(t,...e)=>(t=t||{},e.forEach((e=>e&&function(t,e){let r=Object.keys(e).reduce(((t,r)=>(t[r]=Object.getOwnPropertyDescriptor(e,r),t)),{});return Object.getOwnPropertySymbols(e).forEach((t=>{let n=Object.getOwnPropertyDescriptor(e,t);n.enumerable&&(r[t]=n)})),Object.defineProperties(t,r)}(t,e))),t),deepCopyArray(t){E(h,t,"array");let e,r,n=[];for(e=0,r=t.length;e<r;++e)n[e]=h(t[e])?this.deepCopyArray(t[e]):t[e];return n},mergeEx(t,e){return this.merge(this.merge({},t),e)},merge(t,e){let r;return Object.keys(e).forEach((n=>{r=e[n],"object"==typeof r&&null!==r&&t[n]?("object"!=typeof t[n]&&(t[n]=r instanceof Array?[]:{}),this.merge(t[n],r)):t[n]=r})),t},throttle(t,e,r){let n=!0,s=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return l(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),this.debounce(t,e,{leading:n,trailing:s,maxWait:e})},debounce(t,e,n){let s,i,o,l,c,h,u=0,f=!1,p=!1,d=!0;const m=!e&&0!==e&&"function"==typeof r.requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function g(e){const r=s,n=i;return s=i=void 0,u=e,l=t.apply(n,r),l}function y(t,e){return m?(r.cancelAnimationFrame(c),r.requestAnimationFrame(t)):setTimeout(t,e)}function x(t){const r=t-h;return void 0===h||r>=e||r<0||p&&t-u>=o}function w(){const t=Date.now();if(x(t))return b(t);c=y(w,function(t){const r=t-u,n=e-(t-h);return p?Math.min(n,o-r):n}(t))}function b(t){return c=void 0,d&&s?g(t):(s=i=void 0,l)}function v(...t){const r=Date.now(),n=x(r);if(s=t,i=this,h=r,n){if(void 0===c)return function(t){return u=t,c=y(w,e),f?g(t):l}(h);if(p)return c=y(w,e),g(h)}return void 0===c&&(c=y(w,e)),l}return e=+e||0,a(n)&&(f=!!n.leading,p="maxWait"in n,o=p?Math.max(+n.maxWait||0,e):o,d="trailing"in n?!!n.trailing:d),v.cancel=function(){void 0!==c&&function(t){if(m)return r.cancelAnimationFrame(t);clearTimeout(t)}(c),u=0,s=h=i=c=void 0},v.flush=function(){return void 0===c?l:b(Date.now())},v.pending=function(){return void 0!==c},v},negate:t=>(E(c,t,"function"),function(...e){return!t.apply(this,e)}),strPadRight:(t,e,r)=>(e-=t.length)>0?t+new Array(Math.ceil(e/r.length)+1).join(r).substr(0,e):t,strPadLeft:(t,e,r)=>(e-=t.length)>0?new Array(Math.ceil(e/r.length)+1).join(r).substr(0,e)+t:t,safeSplit:(t,e)=>(t||"").trim().split(e).filter((t=>t.length>0)),capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),prettyNumber(t,e=2,r="0"){return this.strPadLeft(Number(t).toString(),e,r)},prettyMillis(t){let e,r,n=s(t/1e3);r=s(n/60),t-=1e3*n,n-=60*r,e=s(r/60),r-=60*e;let i=[];return i.push(`${n}.${t} secs`),(r>0||e>0)&&i.push(`${r} mins, `),e>0&&i.push(`${e} hrs, `),i.reverse().join("")},swap(t,e,r){let n=t[e];return t[e]=t[r],t[r]=n,t},listIndexesOf(t,e){let r=C.fill(t.length,(t=>t));return e?this.shuffle(r):r},dropArgs:(t,e)=>t.length>e?i.call(t,e):[],isSSL:()=>t&&t.location&&t.location.protocol.indexOf("https")>=0,isMobile:t=>t&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t.userAgent),isSafari:t=>t&&/Safari/.test(t.userAgent)&&/Apple Computer/.test(t.vendor),isCrossOrigin(e){let r=t;if(2==arguments.length&&911==arguments[1].hack&&(r=arguments[1]),r&&r.location&&e){const t=e.indexOf("://");if(t>0){let n=e.indexOf("/",t+3);return(n<0?e:e.substring(0,n))!=r.location.origin}}},addEvent(t,e,r,n){h(t)&&1==arguments.length?t.forEach((t=>this.addEvent.apply(this,t))):e.addEventListener(t,r,n)},delEvent(t,e,r,n){h(t)&&1==arguments.length?t.forEach((t=>this.delEvent.apply(this,t))):e.removeEventListener(t,r,n)},rounded(t){return this.roundUnderOffset(t,.5)},roundUnderOffset(t,e){const r=s(t);return t-r<e?r:r+1},comparator(t,e,r){return 1==arguments.length?t<0?function(t,e){return t<e?-1:t>e?1:0}:function(t,e){return t>e?-1:t<e?1:0}:t<0?function(t,n){let s=e(t),i=r(n);return s<i?-1:s>i?1:0}:function(t,n){let s=e(t),i=r(n);return s>i?-1:s<i?1:0}}},T={qSelector:t=>e.querySelectorAll(t),qId:t=>e.getElementById(t),parent(t){if(t)return t.parentNode},conj:(t,e)=>t.appendChild(e),byTag:(t,r)=>p(r)?e.getElementsByTagNameNS(r,t):e.getElementsByTagName(id),attrs(t,e){return!l(e)&&e?(arguments.length>2&&t.setAttribute(e,arguments[2]),t.getAttribute(e)):(e&&C.doseq(e,((e,r)=>t.setAttribute(r,e))),t)},css(t,e){return!l(e)&&e?(arguments.length>2&&(t.style[e]=arguments[2]),t.style[e]):(e&&C.doseq(e,((e,r)=>t.style[r]=e)),t)},wrap(t,e){const r=t.parentNode;return e.appendChild(t),r.appendChild(e),e},newElm(t,r,n){const s=e.createElement(t);return this.attrs(s,r),this.css(s,n),s},newTxt(t,r,n){const s=e.createTextNode(t);return this.attrs(s,r),this.css(s,n),s}},N={},B=[];class _{constructor(){this._tree=new Map,this._targets=new Map}sub(t,e,r,n){let s=t[0],i=t[1];return i&&!this._targets.has(i)&&this._targets.set(i,1),C.seq(s).forEach((t=>{if(e||(e=t),p(e)&&(e=(r=r||i)[e]),!e)throw"Error: no callback for sub()";this._tree.has(t)||this._tree.set(t,C.jsMap());let s=this._tree.get(t);i=i||N,!s.has(i)&&s.set(i,[]),s.get(i).push([e,r,n])})),this}pub(t,...e){let r,n,s=t[0],i=t[1]||N;return(i===N||this._targets.has(i))&&C.seq(s).forEach((t=>{n=this._tree.get(t),r=n&&n.get(i),r&&r.forEach((t=>{t[0].apply(t[1],e.concat(t[2]||B))}))})),this}reset(){return this._targets.clear(),this._tree.clear(),this}drop(t){if(this._targets.has(t)){this._targets.delete(t);let e=this._tree.values();for(let r=e.next();!r.done;)r.value.delete(t),r=e.next()}return this}unsub(t,e,r){if(1!=arguments.length||P.vec(t)){let n=t[0],s=t[1]||N;if(s===N||this._targets.has(s)){let t,i;C.seq(n).forEach((n=>{if(t=this._tree.get(n),i=t&&t.get(s),i&&(p(e)&&(e=(r=r||s)[e]),e))for(let t=i.length-1;t>=0;--t)i[t][0]===e&&i[t][1]===r&&i.splice(t,1)}))}}else this.drop(t);return this}}return e?A.dom=T:(delete C.addEvent,delete C.delEvent),A.EventBus=function(){return new _},A.is=P,A.u=C,A}"object"==typeof module&&module.exports||(e=t.document),"object"==typeof module&&module.exports?module.exports=s():t["io/czlab/mcfud/core"]=s}(this),function(t,e){"use strict";function r(e){e||(e=t["io/czlab/mcfud/core"]());const r=360,n=2*Math.PI,s=(Math.PI,Math.floor),{is:i,u:o}=e;const l=t=>t<0?- -t%r:t%r;return{lerp:(t,e,r)=>(1-r)*t+r*e,xmod:(t,e)=>t<0?t- -(e+e*s(-t/e)):t%e,ndiv:(t,e)=>s(t/e),pow:(t,e)=>0==e?1:1==e?t:2==e?t*t:3==e?t*t*t:Math.pow(t,e),pow2(t){let e=2;for(;t>e;)e*=2;return e},clamp:(t,e,r)=>r<t?t:r>e?e:r,sqr:t=>t*t,fuzzyEq:(t,e)=>o.feq(t,e),fuzzyZero:t=>o.feq0(t),radToDeg:t=>l(r*t/n),degToRad:t=>n*l(t)/r,pythag2:(t,e)=>t*t+e*e,pythag:(t,e)=>Math.sqrt(t*t+e*e),wrap:(t,e)=>(t+1)%e,biasGreater:(t,e)=>t>=.95*e+.01*t,remap(t,e,r,n,s,i){const o=(t-e)/(r-e)*(s-n)+n;return i?n<s?this.clamp(n,s,o):this.clamp(s,n,o):o},perlin1D(t,e,r,n,i){let o,l,a,c,h,u,f,p;for(let d=0;d<t;++d){o=0,l=0,a=1;for(let i=0;i<r;++i)c=t>>i,h=s(d/c)*c,u=(h+c)%t,f=(d-h)/c,p=(1-f)*e[s(h)]+f*e[s(u)],l+=a,o+=p*a,a/=n;i[d]=o/l}},perlin2D(t,e,r,n,i,o){let l,a,c,h,u,f,p,d,m,g,y,x;for(let w=0;w<t;++w)for(let b=0;b<e;++b){l=0,a=0,c=1;for(let o=0;o<n;++o)d=t>>o,m=s(w/d)*d,g=s(b/d)*d,y=(m+d)%t,x=(g+d)%e,h=(w-m)/d,u=(b-g)/d,f=(1-h)*r[s(g*t+m)]+h*r[s(g*t+y)],p=(1-h)*r[s(x*t+m)]+h*r[s(x*t+y)],a+=c,l+=(u*(p-f)+f)*c,c/=i;o[b*t+w]=l/a}}}}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/math"]=r}(this),function(t,e){"use strict";function r(e){e||(e=t["io/czlab/mcfud/core"]());const{u:r,is:n}=e,s=(t,e)=>r.assert(!n.num(t)&&!n.num(e)&&t&&e,"wanted 2 vecs"),i=(t,e=0,r=0)=>t?[e,r]:{x:e,y:r},o={};class l{constructor(){this.x=0,this.y=0}unit(t){return n.bool(t)&&(t=i(t)),n.vec(t)?(t[0]=this.x,t[1]=this.y):(t.x=this.x,t.y=this.y),t}bind(t){return n.vec(t)?(this.x=t[0],this.y=t[1]):(this.x=t.x,this.y=t.y),this}op(t,e,r){let s=o.take();switch(s.x=this.x,s.y=this.y,t){case"+":n.num(e)&&(s.x+=e),n.num(r)&&(s.y+=r);break;case"-":n.num(e)&&(s.x-=e),n.num(r)&&(s.y-=r);break;case"*":n.num(e)&&(s.x*=e),n.num(r)&&(s.y*=r);break;case"/":n.num(e)&&(s.x/=e),n.num(r)&&(s.y/=r)}return s}"+"(t){return this.op("+",t.x,t.y)}"-"(t){return this.op("-",t.x,t.y)}"*"(t){return this.op("*",t.x,t.y)}"/"(t){return this.op("/",t.x,t.y)}}function a(t,e,r,s,i,o,l){const a=t-i,c=e-o,h=i+(a*r-c*s),u=o+(a*s+c*r);return n.vec(l)?(l[0]=h,l[1]=u):(l.x=h,l.y=u),l}function c(t,e,r,s){let i,l,a=o.take().bind(t);if(n.num(e))l=a.op(r,e,e);else{let t=o.take().bind(e);l=a[r](t),o.drop(t)}return i=l.unit(s?t:n.vec(t)),o.drop(a,l),i}r.inject(o,{take(){return this._pool.pop()},drop(...t){t.forEach((t=>{t.x=0,t.y=0,this._pool.push(t)}))},_pool:r.fill(16,(()=>new l))});const h={gx:t=>n.vec(t)?t[0]:t.x,sx(t,e){n.vec[t]?t[0]=e:t.x=e},gy:t=>n.vec(t)?t[1]:t.y,sy(t,e){n.vec[t]?t[1]=e:t.y=e},vec:(t=0,e=0)=>i(!0,t,e),vecXY:(t=0,e=0)=>i(!1,t,e),add(t,e){return r.assert(2==arguments.length)&&c(t,e,"+")},add$(t,e){return r.assert(2==arguments.length)&&c(t,e,"+",!0)},sub(t,e){return r.assert(2==arguments.length)&&c(t,e,"-")},sub$(t,e){return r.assert(2==arguments.length)&&c(t,e,"-",!0)},mul(t,e){return r.assert(2==arguments.length)&&c(t,e,"*")},mul$(t,e){return r.assert(2==arguments.length)&&c(t,e,"*",!0)},div(t,e){return r.assert(2==arguments.length)&&c(t,e,"/")},div$(t,e){return r.assert(2==arguments.length)&&c(t,e,"/",!0)},dot(t,e){s(t,e);let r=o.take().bind(t),n=o.take().bind(e),i=r.x*n.x+r.y*n.y;return o.drop(r,n),i},equals(t,e){let r=o.take().bind(t),n=o.take().bind(e),s=r.x==n.x&&r.y==n.y;return o.drop(r,n),s},vecAB(t,e){s(t,e);let r,i=o.take().bind(t),l=o.take().bind(e),a=o.take();return a.x=l.x-i.x,a.y=l.y-i.y,r=a.unit(n.vec(t)),o.drop(i,l,a),r},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},dist2(t,e){return this.len2(this.sub(e,t))},dist(t,e){return Math.sqrt(this.dist2(t,e))},unit(t){let e,s=this.len(t),i=o.take().bind(t);return r.feq0(s)?(i.x=0,i.y=0):(i.x/=s,i.y/=s),e=i.unit(n.vec(t)),o.drop(i),e},unit$(t){let e,n=this.len(t),s=o.take().bind(t);return r.feq0(n)?(s.x=0,s.y=0):(s.x/=n,s.y/=n),e=s.unit(t),o.drop(s),e},copy(t,e){s(t,e);let r,n=o.take().bind(t),i=o.take().bind(e);return n.x=i.x,n.y=i.y,r=n.unit(t),o.drop(n,i),r},clone(t){let e=o.take().bind(t),r=e.unit(n.vec(t));return o.drop(e),r},set(t,e,r){let s,i=o.take().bind(t);return n.num(e)&&(i.x=e),n.num(r)&&(i.y=r),s=i.unit(t),o.drop(i),s},setX(t,e){return this.set(t,e)},setY(t,e){return this.set(t,null,e)},rot(t,e,r=null){let s,l,c=0,h=0,u=o.take().bind(t);return r&&(l=o.take().bind(r),c=l.x,h=l.y,o.drop(l)),s=a(u.x,u.y,Math.cos(e),Math.sin(e),c,h,i(n.vec(t))),o.drop(u),s},rot$(t,e,r){let n,s,i=0,l=0,c=o.take().bind(t);return r&&(s=o.take().bind(r),i=s.x,l=s.y,o.drop(s)),n=a(c.x,c.y,Math.cos(e),Math.sin(e),i,l,t),o.drop(c),n},cross(t,e){let r;if(n.num(t)){let s=o.take(),i=o.take().bind(e);s.x=-t*i.y,s.y=t*i.x,r=s.unit(n.vec(e)),o.drop(i,s)}else if(n.num(e)){let s=o.take(),i=o.take().bind(t);s.x=e*i.y,s.y=-e*i.x,r=s.unit(n.vec(t)),o.drop(i,s)}else{s(t,e);let n=o.take().bind(t),i=o.take().bind(e);r=n.x*i.y-n.y*i.x,o.drop(n,i)}return r},angle(t,e){return Math.acos(this.dot(t,e)/(this.len(t)*this.len(e)))},normal(t,e=!1){let r,s=o.take(),i=o.take().bind(t);return e?(s.x=-i.y,s.y=i.x):(s.x=i.y,s.y=-i.x),r=s.unit(n.vec(t)),o.drop(i,s),r},normal$(t,e=!1){let r,n=o.take(),s=o.take().bind(t);return e?(n.x=-s.y,n.y=s.x):(n.x=s.y,n.y=-s.x),r=n.unit(t),o.drop(s,n),r},proj_scalar(t,e){return this.dot(t,e)/this.len(e)},proj(t,e){const r=this.unit(e);this.mul$(r,this.dot(t,r));let s=o.take().bind(r),i=s.unit(n.vec(t));return o.drop(s),i},perp(t,e){return this.sub(t,this.proj(t,e))},reflect(t,e){const r=2*this.dot(t,e);return this.sub(t,this.mul(e,r))},flip(t){return this.mul(t,-1)},flip$(t){return this.mul$(t,-1)},translate(t,...e){let r,s,i,l,a=o.take().bind(t);return 1==e.length&&n.vec(e[0])&&!n.num(e[0][0])&&(e=e[0]),i=e.map((t=>(s=o.take().bind(t),r=s["+"](a),l=r.unit(n.vec(t)),o.drop(s,r),l))),o.drop(a),i},clamp$(t,e,r){const n=this.len(t),s=Math.max(e,Math.min(r,n));return n==s?t:this.mul$(this.div$(t,n||1),s)},clamp(t,e,r){const n=this.len(t),s=Math.max(e,Math.min(r,n));return n==s?t:this.mul(this.div(t,n||1),s)}};return h}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/vec2"]=r}(this),function(t,e){"use strict";function r(e){e||(e=t["io/czlab/mcfud/core"]());Math.atan2;const r=Math.cos,n=Math.sin,s=(Math.tan,Math.floor),{u:i,is:o}=e;const l=t=>t%2!=0,a=(t,e,r,n)=>n-1+(r-1)*e,c=(t,e,r)=>({cells:r,dim:[t,e]}),h=(t,e)=>c(t,e,i.fill(t*e,0));return{v4:(t=0,e=0,r=0,n=0)=>[t,e,r,n],v3:(t=0,e=0,r=0)=>[t,e,r],dot:(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],cross(t,e){return this.v3(t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0])},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},unit(t){let e=this.len(t);if(!i.feq0(e))return[t[0]/e,t[1]/e,t[2]/e]},sub(t,e){return o.num(e)?this.v3(t[0]-e,t[1]-e,t[2]-e):this.v3(t[0]-e[0],t[1]-e[1],t[2]-e[2])},add(t,e){return o.num(e)?this.v3(t[0]+e,t[1]+e,t[2]+e):this.v3(t[0]+e[0],t[1]+e[1],t[2]+e[2])},mul(t,e){return o.num(e)?this.v3(t[0]*e,t[1]*e,t[2]*e):this.v3(t[0]*e[0],t[1]*e[1],t[2]*e[2])},div(t,e){return o.num(e)?this.v3(t[0]/e,t[1]/e,t[2]/e):this.v3(t[0]/e[0],t[1]/e[1],t[2]/e[2])},matrix([t,e],...r){const n=t*e;return 0==r.length?h(t,e):i.assert(n==r.length)&&c(t,e,r)},matCell(t,e,r,n){const s=a(t.dim[0],t.dim[1],e,r);if(s>=0&&s<t.cells.length)return o.num(n)?(t.cells[s]=n,t):t.cells[s]},matIdentity(t){const e=i.assert(t>0)&&i.fill(t*t,0);for(let r=0;r<t;++r)e[a(0,t,r+1,r+1)]=1;return c(t,t,e)},matZero:t=>i.assert(t>0)&&c(t,t,i.fill(t*t,0)),matRowMajors(t){const[e,r]=t.dim;return i.partition(r,t.cells)},matColMajors(t){const[e,r]=t.dim,n=[];for(let s,i=0;i<r;++i){s=[];for(let n=0;n<e;++n)s.push(t.cells[n*r+i]);n.push(s)}return n},mat2(t,e,r,n){return this.matrix([2,2],t,e,r,n)},mat3(t,e,r,n,s,i,o,l,a){return this.matrix([3,3],t,e,r,n,s,i,o,l,a)},mat4(t,e,r,n,s,i,o,l,a,c,h,u,f,p,d,m){return this.matrix([4,4],t,e,r,n,s,i,o,l,a,c,h,u,f,p,d,m)},matEq(t,e){return t.dim[0]==e.dim[0]&&t.dim[1]==e.dim[1]&&(r=t.cells,n=e.cells,r.length==n.length&&r.every(((t,e)=>t==n[e]||i.feq(t,n[e]))));var r,n},matXpose(t){const[e,r]=t.dim,n=e*r,i=[];for(let o=0;o<n;++o)i.push(t.cells[s(o/e)+r*(o%e)]);return c(r,e,i)},matScale:(t,e)=>c(t.dim[0],t.dim[1],t.cells.map((t=>t*e))),matMult(t,e){let[r,n]=t.dim,[s,o]=e.dim,l=t.cells,a=e.cells;i.assert(n==s,"mismatch matrices");let h=new Array(r*o);for(let t=0;t<r;++t)for(let e=0;e<o;++e)h[e+t*o]=i.range(s).reduce(((r,s)=>r+l[s+t*n]*a[e+s*o]),0);return c(r,o,h)},matDet(t){let[e,r]=t.dim,n=[];if(2==r)return this._matDet2x2(t);for(let e=0;e<r;++e)i.conj(n,this.matDet(this.matCut(t,1,e+1)));return i.range(r).reduce(((e,r)=>{let s=n[r];return e+t.cells[r]*(l(r)?-s:s)}),0)},_matDet2x2:t=>(i.assert(4===t.cells.length),t.cells[0]*t.cells[3]-t.cells[1]*t.cells[2]),matCut(t,e,r){const[n,s]=t.dim;let o=e-1,l=r-1,a=[];for(let e=0;e<n;++e)for(let r=0;r<s;++r)e!=o&&r!=l&&i.conj(a,t.cells[r+e*s]);return c(n-1,s-1,a)},matMinor(t){const[e,r]=t.dim;let n=[];if(i.assert(e==r),2==r)return this._matMinor2x2(t);for(let s=0;s<e;++s)for(let e=0;e<r;++e)i.conj(n,this.matDet(this.matCut(t,s+1,e+1)));return c(e,r,n)},_matMinor2x2(t){return i.assert(4==t.cells.length)&&this.mat2(t.cells[3],t.cells[2],t.cells[1],t.cells[0])},matCofactor(t){const e=this.matMinor(t),[r,n]=e.dim;let s=e.cells.slice();for(let t=0;t<r;++t)for(let e,r=0;r<n;++r)e=t*n+r,l(t+r)&&(s[e]=-s[e]);return c(r,n,s)},matAdjugate(t){return this.matXpose(this.matCofactor(t))},_minv2x2(t){const[e,r]=t.dim;i.assert(4==t.cells.length&&2==e&&2==r);let n,s=t.cells,o=s[0]*s[3]-s[1]*s[2];if(i.feq0(o))n=this.matIdentity(e);else{let t=1/o;n=this.mat2(s[3]*t,-s[1]*t,-s[2]*t,s[0]*t)}return n},matInv(t){const[e,r]=t.dim;if(2==r)return this._minv2x2(t);let n=this.matDet(t);return i.feq0(n)?this.matIdentity(e):this.matScale(this.matAdjugate(t),1/n)},matFromColMajor(t){let e=t.length,r=t[0].length,n=h(r,e);for(let r,s=0;s<t.length;++s){r=t[s];for(let t=0;t<r.length;++t)n.cells[t*e+s]=r[t]}return n},matToColMajor(t){const[e,r]=t.dim,n=[];t.cells.slice();for(let s,i=0;i<r;++i){s=[];for(let n=0;n<e;++n)s.push(t.cells[n*r+i]);n.push(s)}return n},scale3D(t){const e=this.matIdentity(4);return e.cells[a(0,4,1,1)]=t[0],e.cells[a(0,4,2,2)]=t[1],e.cells[a(0,4,3,3)]=t[2],e},translate3D(t){const e=this.matIdentity(4);return e.cells[a(0,4,4,1)]=t[0],e.cells[a(0,4,4,2)]=t[1],e.cells[a(0,4,4,3)]=t[2],e},rot3D(t,e,r){return this.matMult(this.zRot3D(r),this.matMult(this.yRot3D(e),this.xRot3D(t)))},matVMult(t,e){let r=t.dim[1],n=e.length;i.assert(r==n);let s=this.matMult(t,c(n,1,e)),o=s.cells;return s.cells=null,o},rot2D(t){return this.mat2(r(t),-n(t),n(t),r(t))},xRot3D(t){return this.mat4(1,0,0,0,0,r(t),-n(t),0,0,n(t),r(t),0,0,0,0,1)},yRot3D(t){return this.mat4(r(t),0,n(t),0,0,1,0,0,-n(t),0,r(t),0,0,0,0,1)},zRot3D(t){return this.mat4(r(t),-n(t),0,0,n(t),r(t),0,0,0,0,1,0,0,0,0,1)},isIdentity(t){const[e,r]=t.dim;if(e==r){for(let n,s=0;s<e;++s)for(let e=0;e<r;++e)if(n=t.cells[s*r+e],s+1==e+1){if(1!=n)return!1}else if(0!=n)return!1;return!0}return!1},isOrthogonal(t){let e=this.matDet(t);return 1==Math.abs(e)&&this.isIdentity(this.matMult(this.matXpose(t),this.matInv(t)))}}}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/matrix"]=r}(this),function(t,e){"use strict";const r=" @N/\\Ri2}aP`(xeT4F3mt;8~%r0v:L5$+Z{'V)\"CKIc>z.*fJEwSU7juYg<klO&1?[h9=n,yoQGsW]BMHpXb6A|D#q^_d!-".split(""),n=r.length;function s(e){e||(e=t["io/czlab/mcfud/core"]());const{u:s}=e,i=t=>Math.abs(t)%n,o=t=>r[t],l=t=>r.findIndex((e=>e==t));function a(t,e){let r=e+t;return o(r>=n?r-n:r)}function c(t,e){let r=e-t;return o(r<0?n+r:r)}return{encrypt(t,e){if(0!=e){let r,n=i(e);r=t.split("").map((t=>(r=l(t),r<0?t:((t,e,r)=>t<0?a(e,r):c(e,r))(e,n,r)))),t=r.join("")}return t},decrypt(t,e){if(0!=e){let r,n=i(e);r=t.split("").map((t=>(r=l(t),r<0?t:((t,e,r)=>t<0?c(e,r):a(e,r))(e,n,r)))),t=r.join("")}return t}}}"object"==typeof module&&module.exports?module.exports=s(require("./core")):t["io/czlab/mcfud/crypt"]=s}(this),function(t,e){"use strict";function r(e){e||(e=t["io/czlab/mcfud/core"]());return{fsm(t){let e=t.initState();return{state:()=>e,process(){const r=t[e];r&&r.run&&r.run()},trigger(r="change",n){const s=t[e],i=s&&s.transitions[r];if(i){const r=i.target,o=t[r];if(o)return s.exit&&s.exit(),o.enter&&o.enter(),n&&n.action?n.action():i.action&&i.action(n),e=r}}}}}}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/fsm"]=r}(this),function(t,e){"use strict";function r(e,r,n,s){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/vec2"]()),n||(n=t["io/czlab/mcfud/math"]()),s||(s=t["io/czlab/mcfud/matrix"]());const i=2*Math.PI,{u:o}=e;return{setContextTransform:(t,e,r=!1)=>(t[r?"setTransform":"transform"](e.cells[0],e.cells[3],e.cells[1],e.cells[4],e.cells[2],e.cells[5]),t),textStyle:(t,e,r,n,s,i)=>(e&&(t.font=e),n&&(t.fillStyle=n),s&&(t.textAlign=s),i&&(t.textBaseline=i),r&&(t.strokeStyle=r),t),drawShape:(t,e,...r)=>(e&&e.draw&&e.draw(t,...r),t),cfgStyle:(t,e,r,n,s)=>(r&&(t.fillStyle=r),e&&(t.strokeStyle=e),s&&(t.lineCap=s),n&&(t.lineWidth=n),t),drawPoints(t,e){t.beginPath();for(let n,s,i,o=e.length,l=0;l<o;++l)i=(l+1)%o,n=e[l],s=e[i],t.moveTo(r.gx(n),r.gy(n)),t.lineTo(r.gx(s),r.gy(s));return t.closePath(),t.stroke(),t},fillPoints(t,e){t.beginPath();for(let n,s,i,o=e.length,l=0;l<o;++l)i=(l+1)%o,n=e[l],s=e[i],0==l?t.moveTo(r.gx(n),r.gy(n)):t.lineTo(r.gx(n),r.gy(n)),t.lineTo(r.gx(s),r.gy(s));return t.closePath(),t.fill(),t},drawCircle:(t,e,r,n)=>(t.beginPath(),t.arc(e,r,n,0,i,!0),t.closePath(),t.stroke(),t),fillCircle:(t,e,r,n)=>(t.beginPath(),t.arc(e,r,n,0,i,!0),t.closePath(),t.fill(),t),drawRect:(t,e,r,n,s,i=0,o=0,l=0)=>(t.save(),t.translate(o,l),t.rotate(i),t.translate(-o,-l),t.strokeRect(e,r,n,s),t.restore(),t),fillRect:(t,e,r,n,s,i=0,o=0,l=0)=>(t.save(),t.translate(o,l),t.rotate(i),t.translate(-o,-l),t.fillRect(e,r,n,s),t.restore(),t),drawLine:(t,e,r,n,s)=>(t.beginPath(),t.moveTo(e,r),t.lineTo(n,s),t.stroke(),t),drawText:(t,e,r,n)=>(t.strokeText(e,r,n),t),fillText:(t,e,r,n)=>(t.fillText(e,r,n),t),clearCanvas(t){return this.clearRect(t,0,0,t.canvas.width,t.canvas.height)},fillCanvas(t){return this.fillRect(t,0,0,t.canvas.width,t.canvas.height)},clearRect:(t,e,r,n,s)=>(t.clearRect(e,r,n,s),t)}}"object"==typeof module&&module.exports?module.exports=r(require("./core"),require("./vec2"),require("./math"),require("./matrix")):t["io/czlab/mcfud/gfx"]=r}(this),function(t,e){"use strict";const[r,n,s]=[1,0,-1];function i(e,i,o,l,a){e||(e=t["io/czlab/mcfud/core"]()),i||(i=t["io/czlab/mcfud/math"]()),o||(o=t["io/czlab/mcfud/vec2"]()),l||(l=t["io/czlab/mcfud/matrix"]()),a||(a=t["io/czlab/mcfud/algo/basic"]());const{Stack:c,StdCompare:h}=a,{is:u,u:f}=(Math.floor,e);const p=f.fill(36,undefined);function d(t){f.assert(t.length>2&&t.length<=36,"too little/many vertices");let e=0,r=t[0][0];for(let n,s=1;s<t.length;++s)n=t[s][0],n>r?(r=n,e=s):f.feq(n,r)&&t[s][1]<t[e][1]&&(e=s);let n=0,s=e;for(;;){p[n]=s;let r=0,i=p[n];for(let e,n,l,a=1;a<t.length;++a)r!=s?(e=o.sub(t[r],t[i]),n=o.sub(t[a],t[i]),l=o.cross(e,n),l<0&&(r=a),f.feq0(l)&&o.len2(n)>o.len2(e)&&(r=a)):r=a;if(s=r,++n,r==e)break}const i=[];for(let e=0;e<n;++e)i.push(o.clone(t[p[e]]));return i}class m{constructor(t,e,r,n){switch(arguments.length){case 2:this.pos=o.vec(),this.width=t,this.height=e;break;case 4:this.pos=o.vec(t,e),this.width=r,this.height=n;break;default:throw"Error: bad input to Rect()"}}}class g{constructor(t,e){this.width=t,this.height=e}half(){return new g(i.ndiv(this.width,2),i.ndiv(this.height,2))}}class w{constructor(t,e,r,n){this.p=o.vec(t,e),this.q=o.vec(r,n)}}class b{constructor(t,e=0,r=0){this.pos=o.vec(e,r),this.shape=t}}class v{constructor(){this.orient=0}setOrient(t){throw Error("no implementation")}}class M extends v{constructor(t){super(),this.calcPoints=[],this.normals=[],this.edges=[],this.set(t||[])}set(t){return this.calcPoints.length=0,this.normals.length=0,this.edges.length=0,this.points=d(t),this.points.forEach((t=>{this.calcPoints.push(o.vec()),this.edges.push(o.vec()),this.normals.push(o.vec())})),this._recalc()}setOrient(t){return this.orient=t,this._recalc()}moveBy(t,e){return this.points.forEach((r=>{r[0]+=t,r[1]+=e})),this._recalc()}_recalc(){let t=this.points.length;return this.points.forEach(((t,e)=>{o.copy(this.calcPoints[e],t),f.feq0(this.orient)||o.rot$(this.calcPoints[e],this.orient)})),this.points.forEach(((e,r)=>{this.edges[r]=o.sub(this.calcPoints[(r+1)%t],this.calcPoints[r]),this.normals[r]=o.unit(o.normal(this.edges[r]))})),this}}class E{constructor(t,e){this.overlapN=o.vec(),this.overlapV=o.vec(),this.A=t,this.B=e,this.clear()}swap(){let t=new E,e=this.AInB,r=this.BInA,n=this.A;return t.overlap=this.overlap,t.A=this.B,t.B=n,t.AInB=r,t.BInA=e,t.overlapN=o.flip(this.overlapN),t.overlapV=o.flip(this.overlapV),t}clear(){return this.overlap=1/0,this.AInB=!0,this.BInA=!0,this}}function k(t,e){let r=1/0,n=-1/0;for(let s,i=0;i<t.length;++i)s=o.dot(t[i],e),s<r&&(r=s),s>n&&(n=s);return[r,n]}function q(t,e){let i=o.len2(t),l=o.dot(e,t);return l<0?r:l>i?s:n}function j(t,e,r,n,s,i){let[l,a]=k(e,s),[c,h]=k(n,s),u=o.vecAB(t,r),f=o.dot(u,s);if(c+=f,h+=f,l>h||c>a)return!0;if(i){let t=0;if(l<c)if(i.AInB=!1,a<h)t=a-c,i.BInA=!1;else{let[e,r]=[a-c,h-l];t=e<r?e:-r}else if(i.BInA=!1,a>h)t=l-h,i.AInB=!1;else{let[e,r]=[a-c,h-l];t=e<r?e:-r}let e=Math.abs(t);e<i.overlap&&(i.overlap=e,o.copy(i.overlapN,s),t<0&&o.flip$(i.overlapN))}}function S(t,e,r){let n,s=t.shape.radius+e.shape.radius,i=o.vecAB(t.pos,e.pos),l=o.len2(i),a=!(l>s*s);return a&&r&&(n=Math.sqrt(l),r.A=t,r.B=e,r.overlap=s-n,o.copy(r.overlapN,o.unit$(i)),o.copy(r.overlapV,o.mul(i,r.overlap)),r.AInB=t.shape.radius<=e.shape.radius&&n<=e.shape.radius-t.shape.radius,r.BInA=e.shape.radius<=t.shape.radius&&n<=t.shape.radius-e.shape.radius),a}function $(t,e,n){let i,l=e.shape.radius*e.shape.radius,a=o.vecAB(t.pos,e.pos),c=t.shape.calcPoints,h=o.vec();for(let u,f,p,d,m=c.length,g=0;g<m;++g){u=g==m-1?0:g+1,f=0==g?m-1:g-1,p=0,d=null,o.copy(h,t.shape.edges[g]),i=o.vecAB(c[g],a),n&&o.len2(i)>l&&(n.AInB=!1);let y=q(h,i);if(y===r){if(o.copy(h,t.shape.edges[f]),y=q(h,o.vecAB(c[f],a)),y===s){let t=o.len(i);if(t>e.shape.radius)return!1;n&&(n.BInA=!1,d=o.unit(i),p=e.shape.radius-t)}}else if(y===s){if(o.copy(h,t.shape.edges[u]),o.sub$(o.copy(i,a),c[u]),y=q(h,i),y===r){let t=o.len(i);if(t>e.shape.radius)return!1;n&&(n.BInA=!1,d=o.unit(i),p=e.shape.radius-t)}}else{let t=o.unit$(o.normal(h)),r=o.dot(i,t),s=Math.abs(r);if(r>0&&s>e.shape.radius)return!1;n&&(d=t,p=e.shape.radius-r,(r>=0||p<2*e.shape.radius)&&(n.BInA=!1))}d&&n&&Math.abs(p)<Math.abs(n.overlap)&&(n.overlap=p,o.copy(n.overlapN,d))}return n&&(n.A=t,n.B=e,o.mul$(o.copy(n.overlapV,n.overlapN),n.overlap)),!0}function z(t,e,r){let n=$(e,t,r);if(n&&r){let t=r.A,e=r.AInB;o.flip$(r.overlapN),o.flip$(r.overlapV),r.A=r.B,r.B=t,r.AInB=r.BInA,r.BInA=e}return n}function A(t,e,r){let n=t.shape.calcPoints,s=e.shape.calcPoints;for(let i=0;i<n.length;++i)if(j(t.pos,n,e.pos,s,t.shape.normals[i],r))return!1;for(let i=0;i<s.length;++i)if(j(t.pos,n,e.pos,s,e.shape.normals[i],r))return!1;if(r){if(0==r.overlap||f.feq0(r.overlap))return!1;r.A=t,r.B=e,o.copy(r.overlapV,r.overlapN),o.mul$(r.overlapV,r.overlap)}return!0}class P{static create(){return new P}constructor(){this.identity()}identity(){return this.m=l.matIdentity(3),this}translate(t,e){return this.m=l.matMult(this.m,l.mat3(1,0,t,0,1,e,0,0,1)),this}scale(t,e){return this.m=l.matMult(this.m,l.mat3(t,0,0,0,e,0,0,0,1)),this}shear(t,e){return this.m=l.matMult(this.m,l.mat3(1,t,0,e,1,0,0,0,1)),this}rotateCCW(t,e,r){let n=Math.sin(t),s=Math.cos(t);return void 0!==e&&void 0!==r?(this.translate(-e,-r),this.rotateCCW(t),this.translate(e,r)):this.m=l.matMult(this.m,l.mat3(s,-n,0,n,s,0,0,0,1)),this}rotateCW(t,e,r){let n=Math.sin(t),s=Math.cos(t);return void 0!==e&&void 0!==r?(this.translate(-e,-r),this.rotateCW(t),this.translate(e,r)):this.m=l.matMult(this.m,l.mat3(s,n,0,-n,s,0,0,0,1)),this}transformXY(t,e){let r=[t,e,1];return l.matVMult(this.m,r).length=2,2}transformPoints(t){let e,r=[0,0,1];t.forEach((t=>{u.vec(t)?(r[0]=t[0],r[1]=t[1]):(r[0]=t.x,r[1]=t.y),e=l.matVMult(this.m,r),u.vec(t)?(t[0]=e[0],t[1]=e[1]):(t.x=e[0],t.y=e[1])}))}}class C{constructor(t,e){if(e<t){let r=t;t=e,e=r}f.feq0(t)&&(t=0),f.feq0(e)&&(e=0),this.min=t,this.max=e}min(){return this.min}max(){return this.max}intersects(t){return!(this.max<t.min||t.max<this.min)}contains(t){return this.min<=t&&t<=this.max}length(){return this.max-this.min}static MinEndPtCmp(t,e){return t.min<e.min?-1:t.min>e.min?1:t.max<e.max?-1:t.max>e.max?1:0}static MaxEndPtCmp(t,e){return t.max<e.max?-1:t.max>e.max?1:t.min<e.min?-1:t.min>e.min?1:0}static LenCmp(t,e){let r=t.length(),n=e.length();return r<n?-1:r>n?1:0}static test(){let t=[new C(15,33),new C(45,60),new C(20,70),new C(46,55)];console.log("Unsorted"),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`))),console.log("Sort by min endpoint"),t.sort(C.MinEndPtCmp),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`))),console.log("Sort by max endpoint"),t.sort(C.MaxEndPtCmp),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`))),console.log("Sort by length"),t.sort(C.LenCmp),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`)))}}class T{static theta(t){return Math.atan2(t[1],t[0])}static angleBetween(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}static ccw(t,e,r){let n=(e[0]-t[0])*(r[1]-t[1])-(e[1]-t[1])*(r[0]-t[0]);return n<0?-1:n>0?1:0}static area2(t,e,r){return(e[0]-t[0])*(r[1]-t[1])-(e[1]-t[1])*(r[0]-t[0])}static distTo(t,e){let r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}static distSqTo(t,e){let r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}static compareTo(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:t[0]<e[0]?-1:t[0]>e[0]?1:0}static XOrderCmp(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:0}static YOrderCmp(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0}static ROrderCmp(t,e){let r=t[0]*t[0]+t[1]*t[1]-(e[0]*e[0]+e[1]*e[1]);return r<0?-1:r>0?1:0}static PolarOrderCmp(t){return(e,r)=>{let n=e[0]-t[0],s=e[1]-t[1],i=r[0]-t[0],o=r[1]-t[1];return s>=0&&o<0?-1:o>=0&&s<0?1:f.feq0(s)&&f.feq0(o)?n>=0&&i<0?-1:i>=0&&n<0?1:0:-T.ccw(t,e,r)}}static DistToOrderCmp(t,e){let r=T.distSqTo(t),n=T.distSqTo(e);return r<n?-1:r>n?1:0}static equals(t,e){return e===t||!!e&&(t[0]==e[0]&&t[1]==e[1])}static farthestPair(t){let e,r=[0,0],n=[0,0],s=0,i=-1/0,l=T.calcConvexHull(t);if(!1===l||t.length<=1)return!1;if(e=l.length,l.unshift(null),2==e)r=l[1],n=l[2],s=T.distTo(r,n);else{let t,s=2;for(;T.area2(l[e],l[1],l[s+1])>T.area2(l[e],l[1],l[s]);)++s;t=s;for(let a,c=1;c<=s&&t<=e;++c)for(T.distSqTo(l[c],l[t])>i&&(i=T.distSqTo(l[c],l[t]),o.copy(r,l[c]),o.copy(n,l[t]));t<e&&T.area2(l[c],l[c+1],l[t+1])>T.area2(l[c],l[c+1],l[t]);)++t,a=T.distSqTo(l[c],l[t]),a>i&&(i=T.distSqTo(l[c],l[t]),o.copy(r,l[c]),o.copy(n,l[t]))}return{best1:r,best2:n,bestDistance:Math.sqrt(i)}}static closestPair(t){let e=[0,0],r=[0,0],n=1/0,s=t.slice();const l=t.length;s.sort(T.YOrderCmp),s.sort(T.XOrderCmp);for(let t=0;t<l-1;++t)if(T.equals(s[t],s[t+1]))return o.copy(e,s[t]),o.copy(r,s[t+1]),{bestDistance:0,best1:e,best2:r};let a=s.slice();return function t(s,l,a,c,h){if(h<=c)return 1/0;let u=c+i.ndiv(h-c,2),f=s[u],p=t(s,l,a,c,u),d=t(s,l,a,u+1,h),m=Math.min(p,d);!function(t,e,r,n,s){for(let n=r;n<=s;++n)o.copy(e[n],t[n]);let i=r,l=n+1;for(let a=r;a<=s;++a)i>n?o.copy(t[a],e[l++]):l>s?o.copy(t[a],e[i++]):T.compareTo(e[l],e[i])<0?o.copy(t[a],e[l++]):o.copy(t[a],e[i++])}(l,a,c,u,h);let g=0;for(let t=c;t<=h;++t)Math.abs(l[t][0]-f[0])<m&&o.copy(a[g++],l[t]);for(let t=0;t<g;++t)for(let s,i=t+1;i<g&&a[i][1]-a[t][1]<m;++i)s=T.distTo(a[t],a[i]),s<m&&(m=s,s<n&&(n=m,o.copy(e,a[t]),o.copy(r,a[i])));return m}(s,a,f.fill(l,(()=>[0,0])),0,l-1),{bestDistance:n,best1:e,best2:r}}static calcConvexHull(t){f.assert(t&&t.length>0,"invalid points");let e,r,n,s=t.length,i=f.deepCopyArray(t),l=new c;for(i.sort(T.compareTo),e=i[0],i.shift(),i.sort(T.PolarOrderCmp(e)),i.unshift(e),l.push(i[0]),r=1;r<s&&T.equals(i[0],i[r]);++r);if(r==s)return!1;for(n=r+1;n<s&&0==T.ccw(i[0],i[r],i[n]);++n);l.push(i[n-1]);for(let t,e=n;e<s;++e){for(t=l.pop();T.ccw(l.peek(),t,i[e])<=0;)t=l.pop();l.push(t),l.push(i[e])}let a=new c;for(let t=l.iterator();t.hasNext();)a.push(t.next());s=a.size(),t=[];for(let e=a.iterator();e.hasNext();)t.push(o.clone(e.next()));if(s>2)for(let e=0;e<s;++e)if(T.ccw(t[e],t[(e+1)%s],t[(e+2)%s])<=0)return!1;return t}static test_convexHull(){let t="9230 13137 4096 24064 8192 26112 22016  9344 4440  8028 6505 31422 28462 32343 17152 19200 9561 11599\n               4096 20992 21538  2430 21903 23677 17152 16128 7168 25088 10162 18638 822 32301 16128 12032 18989  3797\n               8192 28160 16128 20224 14080 20224 26112  7296 20367 20436 7486   422 17835  2689 22016  3200 22016  5248\n               24650 16886 15104 20224 25866  4204 13056 15104 13662 10301 17152 20224 15104 12032 6144 20992 26112  3200\n               6144 29184 13056 12032 8128 20992 5076 19172 17152 17152 823 15895 25216  3200 6071 29161 5120 20992\n               10324 22176 29900  9390 27424  7945 4096 23040 12831 27971 29860 12437 28668  2061 1429 12561 29413   596\n               17152 18176 8192 27136 5120 29184 22016 11392 1444 10362 32011  3140 15731 32661 26112  4224 13120 20224\n               30950  2616 4096 22016 4096 25088 24064  3200 26112  5248 4862 30650 5570  8885 21784 18853 23164 32371\n               4160 29184 13056 13056 8192 29184 23040  7296 5120 25088 22016  7296 7168 29184 25216  7296 23040  3200\n               4718  4451 14080 16128 7168 20992 19546 17728 13056 16128 17947 17017 26112  6272 20658  1204 23553 13965\n               13056 14080 14080 12032 24064  7296 21377 26361 17088\n               12032 16128 16128 30875 28560 2542 26201 8192 25088 11444 16973".split(/\s+/).map((t=>+t)),e=[];for(let r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);e=[[5,15],[5,-20],[-60,10],[70,-10],[-60,-10],[70,10]];let r=T.calcConvexHull(e);!1===r||r.length!=e.length?console.log("not convex!"):r.forEach((t=>{console.log(`${t[0]}, ${t[1]}`)}))}static test_closestPair(){let t="954 11163 1125 11331 1296 11499 1467 11667 1657 11796 1847 11925 2037 12054 2238 12207 2439 12360\n               2640 12513 2878 12523 3116 12533 3354 12543 3518 12493 3682 12443 3846 12393\n               8463 7794 8022 7527 7581 7260 7140 6993 6731 6624 6322 6255 5913 5886\n               5521 5494 5129 5102 4737 4710 4599 5158".split(/\s+/).map((t=>+t)),e=[];for(let r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);let{bestDistance:r,best1:n,best2:s}=T.closestPair(e);console.log(`bestDist=${r}, p1=${n}, p2=${s}`)}static test_farthestPair(){let t="9230 13137 4096 24064 8192 26112 22016  9344 4440  8028 6505 31422 28462 32343 17152 19200 9561 11599 4096 20992 21538  2430\n               21903 23677 17152 16128 7168 25088 10162 18638 822 32301 16128 12032 18989  3797 8192 28160 16128 20224 14080 20224 26112  7296\n               20367 20436 7486   422 17835  2689 22016  3200 22016  5248 24650 16886 15104 20224 25866  4204 13056 15104 13662 10301 17152 20224\n               15104 12032 6144 20992 26112  3200 6144 29184 13056 12032 8128 20992 5076 19172 17152 17152 823 15895 25216  3200 6071 29161\n               5120 20992 10324 22176 29900  9390 27424  7945 4096 23040 12831 27971 29860 12437 28668  2061 1429 12561 29413   596 17152 18176\n               8192 27136 5120 29184 22016 11392 1444 10362 32011  3140 15731 32661 26112  4224 13120 20224 30950  2616 4096 22016\n               4096 25088 24064  3200 26112  5248 4862 30650 5570  8885 21784 18853 23164 32371 4160 29184 13056 13056 8192 29184 23040  7296\n               5120 25088 22016  7296 7168 29184 25216  7296 23040  3200 4718  4451 14080 16128 7168 20992 19546 17728 13056 16128 17947 17017\n               26112  6272 20658  1204 23553 13965 13056 14080 14080 12032 24064  7296 21377 26361 17088 12032 16128 16128\n               30875 28560 2542 26201 8192 25088 11444 16973".split(/\s+/).map((t=>+t)),e=[];for(let r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);let{bestDistance:r,best1:n,best2:s}=T.farthestPair(e);console.log(`bestDist=${r}, p1=${n}, p2=${s}`)}}return{Rect:m,Area:g,Line:w,Body:b,Circle:class extends v{constructor(t){super(),this.radius=t}setOrient(t){return this.orient=t,this}},Polygon:M,Manifold:E,C2DMatrix:P,Point2D:T,Interval1D:C,Interval2D:class{constructor(t,e){this.x=t,this.y=e}intersects(t){return!!this.x.intersects(t.x)&&!!this.y.intersects(t.y)}contains(t){return x.contains(t[0])&&y.contains(t[1])}area(){return x.length()*y.length()}},bodyWrap:(t,e,r)=>new b(t,e,r),orderVertices:t=>d(t),polyArea(t,e=!1){let r=e?this.orderVertices(t):t,n=0;for(let t,e,s,i=r.length,o=0;o<i;++o)s=(o+1)%i,t=r[o],e=r[s],n+=t[0]*e[1]-e[0]*t[1];return i.ndiv(Math.abs(n),2)},calcPolygonCenter(t,e=!1){const r=e?this.orderVertices(t):t,n=6*this.polyArea(r);let s=0,l=0;for(let t,e,n,i=0,o=r.length;i<o;++i)n=(i+1)%o,t=r[i],e=r[n],s+=(t[0]+e[0])*(t[0]*e[1]-e[0]*t[1]),l+=(t[1]+e[1])*(t[0]*e[1]-e[0]*t[1]);return o.vec(i.ndiv(s,n),i.ndiv(l,n))},getAABB(t){if(f.assert(t instanceof b,"wanted a body"),f.has(t.shape,"radius"))return new m(t.pos[0]-t.shape.radius,t.pos[1]-t.shape.radius,2*t.shape.radius,2*t.shape.radius);{let e=o.translate(t.pos,t.shape.calcPoints),r=e[0][0],n=e[0][1],s=r,i=n;for(let t,o=1;o<e.length;++o)t=e[o],t[0]<r&&(r=t[0]),t[0]>s&&(s=t[0]),t[1]<n&&(n=t[1]),t[1]>i&&(i=t[1]);return new m(r,n,s-r,i-n)}},shiftPoints:(t,e)=>t.map((t=>o.add(t,e))),rotPoints:(t,e,r)=>t.map((t=>o.rot(t,e,r))),calcRectPoints(t,e){const r=t/2,n=e/2;return[o.vec(r,-n),o.vec(r,n),o.vec(-r,n),o.vec(-r,-n)]},line:(t,e,r,n)=>new w(t,e,r,n),rectEqRect:(t,e)=>t.width==e.width&&t.height==e.height&&t.pos[0]==e.pos[0]&&t.pos[1]==e.pos[1],rectContainsRect:(t,e)=>!(t.pos[0]>=e.pos[0]||t.pos[1]>=e.pos[1]||t.pos[0]+t.width<=e.pos[0]+e.width||t.pos[1]+t.height<=e.pos[1]+e.height),rectGetMaxX:t=>t.pos[0]+t.width,rectGetMidX:t=>t.pos[0]+t.width/2,rectGetMinX:t=>t.pos[0],rectGetMaxY:t=>t.pos[1]+t.height,rectGetMidY:t=>t.pos[1]+t.height/2,rectGetMinY:t=>t.pos[1],rectContainsPoint(t,e,r){return e>=this.rectGetMinX(t)&&e<=this.rectGetMaxX(t)&&r>=this.rectGetMinY(t)&&r<=this.rectGetMaxY(t)},rectOverlayRect:(t,e)=>!(t.pos[0]+t.width<e.pos[0]||e.pos[0]+e.width<t.pos[0]||t.pos[1]+t.height<e.pos[1]||e.pos[1]+e.height<t.pos[1]),rectUnion(t,e){const r=Math.min(t.pos[0],e.pos[0]),n=Math.min(t.pos[1],e.pos[1]);return new m(r,n,Math.max(t.pos[0]+t.width,e.pos[0]+e.width)-r,Math.max(t.pos[1]+t.height,e.pos[1]+e.height)-n)},rectIntersection(t,e){if(this.rectOverlayRect(t,e)){const r=Math.max(t.pos[0],e.pos[0]),n=Math.max(t.pos[1],e.pos[1]);return new m(r,n,Math.min(t.pos[0]+t.width,e.pos[0]+e.width)-r,Math.min(t.pos[1]+t.height,e.pos[1]+e.height)-n)}},hitTestPointCircle(t,e,r){f.assert(r instanceof b,"wanted a body");let n=t-r.pos[0],s=e-r.pos[1];return n*n+s*s<=r.shape.radius*r.shape.radius},hitCircleCircle(t,e){f.assert(t instanceof b&&e instanceof b,"need bodies");let r=new E;if(S(t,e,r))return r},hitTestCircleCircle:(t,e)=>(f.assert(t instanceof b&&e instanceof b,"need bodies"),S(t,e,new E)),hitPolygonCircle(t,e){f.assert(t instanceof b&&e instanceof b,"need bodies");let r=new E;if($(t,e,r))return r},hitTestPolygonCircle:(t,e)=>(f.assert(t instanceof b&&e instanceof b,"need bodies"),$(t,e,new E)),hitCirclePolygon(t,e){f.assert(e instanceof b&&t instanceof b,"need bodies");let r=new E;if(z(t,e,r))return r},hitTestCirclePolygon:(t,e)=>(f.assert(e instanceof b&&t instanceof b,"need bodies"),z(t,e,new E)),hitPolygonPolygon(t,e){f.assert(t instanceof b&&e instanceof b,"need bodies");let r=new E;if(A(t,e,r))return r},hitTestPolygonPolygon:(t,e)=>(f.assert(t instanceof b&&e instanceof b,"need bodies"),A(t,e,new E)),hitTestPointInPolygon(t,e,r){let n;for(let s,i,o=r.length,l=0,a=o-1;l<o;)s=r[l],i=r[a],s[1]>e!=i[1]>e&&t<(i[0]-s[0])*(e-s[1])/(i[1]-s[1])+s[0]&&(n=!n),a=l,++l;return n},hitTestPointPolygon(t,e,r){return f.assert(r instanceof b,"wanted a body"),this.hitTestPointInPolygon(t,e,o.translate(r.pos,r.shape.calcPoints))},hitTestLineCircle(t,e,r,n,s){let i,l=o.sub(e,t),a=[r,n],c=o.sub(a,t),h=o.sub(a,e),u=o.len2(c),f=o.dot(c,l)/o.dot(l,l);return i=f>=0&&f<=1?u-f*f*o.len2(l):f<0?u:o.len2(h),[i<s*s]},hitTestLinePolygon(t,e,r){f.assert(r instanceof b,"wanted a body");let n=o.translate(r.pos,r.shape.calcPoints);for(let r=0,s=0;r<n.length;++r){s=r+1,s==n.length&&(s=0);let[i,o]=this.lineIntersect2D(t,e,n[r],n[s]);if(i)return[i,o]}return[!1]},lineIntersect2D(t,e,r,n){let s,i,o=t[0],l=t[1],a=e[0],c=e[1],h=r[0],u=r[1],p=n[0],d=n[1],m=(o-a)*(u-d)-(l-c)*(h-p);return f.feq0(m)?[!1]:(s=(o-h)*(u-d)-(l-u)*(h-p),s/=m,i=(o-h)*(l-c)-(l-u)*(o-a),i/=m,0<=s&&s<=1&&0<=i&&i<=1?[!0,s,[o+s*(a-o),l+s*(c-l)]]:[!1])},lineIntersection2D(t,e,r,n){if(t[1]>n[1]&&e[1]>n[1]&&t[1]>r[1]&&e[1]>r[1]||e[1]<r[1]&&t[1]<r[1]&&e[1]<n[1]&&t[1]<n[1]||t[0]>n[0]&&e[0]>n[0]&&t[0]>r[0]&&e[0]>r[0]||e[0]<r[0]&&t[0]<r[0]&&e[0]<n[0]&&t[0]<n[0])return[!1,0];let s=(t[1]-r[1])*(n[0]-r[0])-(t[0]-r[0])*(n[1]-r[1]),i=(e[0]-t[0])*(n[1]-r[1])-(e[1]-t[1])*(n[0]-r[0]),o=(t[1]-r[1])*(e[0]-t[0])-(t[0]-r[0])*(e[1]-t[1]),l=(e[0]-t[0])*(n[1]-r[1])-(e[1]-t[1])*(n[0]-r[0]),a=s*i,c=o*l;return a>0&&a<i*i&&c>0&&c<l*l?[!0,s/i]:[!1,0]}}}"object"==typeof module&&module.exports?module.exports=i(require("./core"),require("./math"),require("./vec2"),require("./matrix"),require("../algo/basic")):t["io/czlab/mcfud/geo2d"]=i}(this),function(t,e){"use strict";function r(r,n){r||(r=t["io/czlab/mcfud/core"]()),n||(n=t["io/czlab/mcfud/math"]());Math.floor;const{u:s,is:i}=r;return{spatialGrid:(t=320,r=320)=>function(t,r){const o=new Map;return{searchAndExec(t,e){let r,n=t.getSpatial();for(let s,i,l=n.y1;l<=n.y2;++l)if(i=o.get(l))for(let o,a,c=n.x1;c<=n.x2;++c)if(s=i.get(c))for(o=s.values(),a=o.next();!a.done;){if(t!==a.value&&(r=e(t,a.value))){c=l=1/0;break}r=null,a=o.next()}return r},search(t,e=!1){let r,n,s=[],i=t.getSpatial();for(let l=i.y1;l<=i.y2;++l)if(n=o.get(l))for(let o=i.x1;o<=i.x2;++o)(r=n.get(o))&&r.forEach((r=>{(r!==t||e)&&s.push(r)}));return s},engrid(e,s){if(!e)return;let i=e.getBBox(),o=e.getSpatial(),l=n.ndiv(i.x1,t),a=n.ndiv(i.y1,r),c=n.ndiv(i.x2,t),h=n.ndiv(i.y2,r);return o.x1==l&&o.x2==c&&o.y1==a&&o.y2==h||(this.degrid(e),o.x1=l,o.x2=c,o.y1=a,o.y2=h,s||this._register(e)),e},reset(){o.clear()},_register(t){let e=t.getSpatial();if(i.num(e.x1))for(let r,n,i=e.y1;i<=e.y2;++i){o.has(i)||o.set(i,new Map),n=o.get(i);for(let i=e.x1;i<=e.x2;++i)n.has(i)||n.set(i,new Map),r=n.get(i),s.assoc(r,t.getGuid(),t)}},degrid(t){if(t){let r=t.getSpatial();if(i.num(r.x1))for(let e,n,i=r.y1;i<=r.y2;++i)if(n=o.get(i))for(let i=r.x1;i<=r.x2;++i)(e=n.get(i))&&s.dissoc(e,t.getGuid());r.x1=e,r.x2=e,r.y1=e,r.y2=e}}}}(t,r)}}"object"==typeof module&&module.exports?module.exports=r(require("./core"),require("./math")):t["io/czlab/mcfud/spatial"]=r}(this),function(t,e){"use strict";function r(e,r){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/math"]());Math.floor;const{u:s}=e;function i(t,e,o,l,a,c,h){let u=null,f=[],p=r.ndiv(t+e,2),d=r.ndiv(o+l,2);function m(t){function e({x1:t,x2:e,y1:r,y2:n}){let s=[],i=t<p,o=e>p;return r<d&&(i&&s.push(3),o&&s.push(0)),n>d&&(i&&s.push(2),o&&s.push(1)),s}return t.getBBox?e(t.getBBox()):(s.assert(void 0!==t.x1&&void 0!==t.y1&&void 0!==t.x2&&void 0!==t.y2,"wanted bbox for quadtree"),e(t))}const g={x1:t,x2:e,y1:o,y2:l};return{boundingBox:()=>g,subTrees:()=>u,dbg:t=>t(f,u,a,c,h),insert(...r){r.forEach((r=>{u?m(r).forEach((t=>u[t].insert(r))):(f.push(r),f.length>a&&h<c&&(s.assert(null===u),u=[i(p,e,o,d,a,c,h+1),i(p,e,d,l,a,c,h+1),i(t,p,d,l,a,c,h+1),i(t,p,o,d,a,c,h+1)],f.forEach((t=>m(t).forEach((e=>u[e].insert(t))))),f.length=0))}))},remove(t){u?u.forEach((e=>e.remove(t))):s.disj(f,t)},isLeaf:()=>null===u?-1:f.length,prune(){if(u){let t=0,e=0;for(let r,s=0;s<u.length;++s)r=u[s],r.prune(),n=r.isLeaf(),n>=0&&(++t,e+=n);t==u.length&&e<a&&(s.assert(0==f.length,"quadtree wanted zero items"),u.forEach((t=>t._swap(f))),u=null)}},_swap(t){f.forEach((e=>t.push(e))),f.length=0},reset(){f.length=0,u&&u.forEach((t=>t.reset())),u=null},searchAndExec(t,e,r){let n;if(u){let s=m(t);for(let i=0;i<s.length&&(n=u[s[i]].searchAndExec(t,e,r),!n);++i);}else for(let s,i=0;i<f.length&&(s=f[i],r&&s===t||!(n=e(s,t)));++i);return n},search(t,e){const r=new Map,n=[];return e&&r.set(t,null),u&&m(t).forEach((e=>{u[e].search(t).forEach((t=>{r.has(t)||(r.set(t,null),n.push(t))}))})),f.forEach((t=>{r.has(t)||(r.set(t,null),n.push(t))})),r.clear(),n}}}return{quadtree(t,e=12,r=5){const{x1:n,x2:s,y1:o,y2:l}=t;return i(n,s,o,l,e,r,0)}}}"object"==typeof module&&module.exports?module.exports=r(require("./core"),require("./math")):t["io/czlab/mcfud/qtree"]=r}(this),function(t,e){"use strict";function r(r){r||(r=t["io/czlab/mcfud/core"]());const n=(t,e)=>t<e?-1:t>e?1:0,s=Math.floor,{is:i,u:o}=r,l=t=>o.assert(i.num(t)||i.str(t),"expected number or string");function a(t,e=" ",r=""){for(;t.hasNext();)r+=`${t.next()}${e}`;return r}class c{constructor(t){this.current=t}hasNext(){return o.echt(this.current)}remove(){throw Error("Unsupported")}next(){if(!this.hasNext())throw Error("NoSuchElementException");let t=this.current.item;return this.current=this.current.next,t}}function h(t,r=e){return{item:t,next:r}}class u{constructor(){this.first=e,this.n=0}clone(){let t,e=new u,r=this.first;for(;r;)t?(t.next=h(r.item),t=t.next):e.first=t=h(r.item),e.n+=1,r=r.next;return e}isEmpty(){return o.nichts(this.first)}size(){return this.n}add(t){this.first=h(t,this.first),this.n+=1}iter(){return new c(this.first)}static test(){let t=new u;"to be or not to - be - - that - - - is".split(" ").forEach((e=>t.add(e))),console.log("size of bag = "+t.size()),console.log(a(t.iter()));let e=t.clone();console.log("size of cloned = "+e.size()),console.log(a(e.iter()))}}class f{constructor(){this.first=e,this.n=0}clone(){let t,e=new f,r=this.first;for(;r;)t?(t.next=h(r.item),t=t.next):e.first=t=h(r.item),e.n+=1,r=r.next;return e}isEmpty(){return o.nichts(this.first)}size(){return this.n}push(t){this.first=h(t,this.first),this.n+=1}pop(){if(this.isEmpty())throw Error("Stack underflow");let t=this.first.item;return this.first=this.first.next,this.n-=1,t}peek(){if(this.isEmpty())throw Error("Stack underflow");return this.first.item}toString(){return a(this.iter())}iter(){return new c(this.first)}static test(){let t=new f;"to be or not to - be - - that - - - is".split(" ").forEach((e=>{"-"!=e?t.push(e):t.isEmpty()||console.log("(-)"+t.pop()+" ")})),console.log("("+t.size()+" left on stack)");let e=t.clone();console.log("cloned= "+a(e.iter())),console.log("("+e.size()+" left on stack)")}}class p{constructor(){this.first=e,this.last=e,this.n=0}clone(){let t=new p,e=this.first;for(;e;)t.enqueue(e.item),e=e.next;return t}isEmpty(){return o.nichts(this.first)}size(){return this.n}peek(){if(this.isEmpty())throw Error("Queue underflow");return this.first.item}enqueue(t){let e=this.last;this.last=h(t),this.isEmpty()?this.first=this.last:e.next=this.last,this.n+=1}dequeue(){if(this.isEmpty())throw Error("Queue underflow");let t=this.first.item;return this.first=this.first.next,this.n-=1,this.isEmpty()&&(this.last=e),t}toString(){return a(this.iter())}iter(){return new c(this.first)}static test(){let t=new p;"to be or not to - be - - that - - - is".split(/\s+/).forEach((e=>{"-"!=e?t.enqueue(e):t.isEmpty()||console.log(t.dequeue()+" ")})),console.log("("+t.size()+" left on queue)");let e=t.clone();console.log("cloned= "+a(e.iter())),console.log("("+e.size()+" left on queue)")}}class d{constructor(t){this.compare=t||n,this.root=e,this.n=0}size(){return this.n}contains(t){return void 0!==this.get(t)}get(t){const e=(t,r,n)=>{if(r){let s=this.compare(t,r.key);n=s<0?e(t,r.left):s>0?e(t,r.right):r.value}return n};if(l(t)&&this.n>0)return e(t,this.root)}set(t,e){const r=(t,e,n)=>{if(!n)return this.n+=1,{key:t,value:e};let s=this.compare(t,n.key);return s<0?n.left=r(t,e,n.left):s>0?n.right=r(t,e,n.right):n.value=e,n};l(t)&&void 0!==e&&(this.root=r(t,e,this.root))}_getMaxNode(t){for(;t&&t.right;)t=t.right;return t}_getMaxKey(){let t=this._getMaxNode(this.root);if(t)return t.key}_getMinNode(t){for(;t&&t.left;)t=t.left;return t}_getMinKey(){let t=this._getMinNode(this.root);if(t)return t.key}remove(t){const r=(t,n)=>{if(n){let s,i,o,l=this.compare(t,n.key);l<0?n.left=r(t,n.left):l>0?n.right=r(t,n.right):n.left&&n.right?(o=this._getMaxNode(n.left),s=o.key,i=o.value,o.value=n.value,o.key=n.key,n.key=s,n.value=i,n.left=r(t,n.left)):n.left?(n=n.left,this.n-=1):n.right?(n=n.right,this.n-=1):(n=e,this.n-=1)}return n};l(t)&&(this.root=r(t,this.root))}keys(){let t=new p;return this.forEach(((e,r)=>t.enqueue(r))),t.iter()}firstKey(){let t;try{this.forEach(((e,r)=>{throw t=r,Error("????")}))}catch(t){}return t}lastKey(){let t;return this.forEach(((e,r)=>{t=r})),t}forEach(t,e){function r(t,e){return e&&e.apply(t,Array.prototype.slice.call(arguments,2))}!function t(e,n,s,i){if(!e)return r(s,i);t(e.left,n,s,(function(){r(s,n,e.value,e.key),t(e.right,n,s,(function(){r(s,i)}))}))}(this.root,t,e)}static test(){let t=new d;t.set(3,"3"),t.set(2,"2"),t.set(7,"7"),t.set(1,"1"),console.log(`firstKey= ${t.firstKey()}`),console.log(`lastKey= ${t.lastKey()}`),console.log(a(t.keys())),console.log(`k= ${t.get(3)}`),console.log(`has 2 = ${t.contains(2)}`),console.log(`has size = ${t.size()}`),t.remove(1),console.log(`has size = ${t.size()}`),console.log(a(t.keys())),console.log(`k= ${t.get(2)}`)}}class m{constructor(){this.st=new d}get(t){if(o.nichts(t))throw Error("calls get() with null key");return this.st.get(t)}put(t,e){if(o.nichts(t))throw Error("calls put() with null key");void 0===e?this.st.remove(t):this.st.set(t,e)}remove(t){if(o.nichts(t))throw Error("calls remove() with null key");this.st.remove(t)}contains(t){if(o.nichts(t))throw Error("calls contains() with null key");return this.st.contains(t)}size(){return this.st.size()}isEmpty(){return 0==this.size()}keys(){return this.st.keys()}min(){if(this.isEmpty())throw Error("calls min() with empty symbol table");return this.st.firstKey()}max(){if(this.isEmpty())throw Error("calls max() with empty symbol table");return this.st.lastKey()}ceiling(t){if(o.nichts(t))throw Error("argument to ceiling() is null");let e,r,n=this.st.keys();for(;n.hasNext();)if(r=n.next(),r==t||r>t){e=r;break}if(void 0===e)throw Error("argument to ceiling() is too large");return e}floor(t){if(o.nichts(t))throw Error("argument to floor() is null");let e,r,n=this.st.keys();for(;n.hasNext();)r=n.next(),(r==t||r<t)&&(e=r);if(void 0===e)throw Error("argument to floor() is too small");return e}static test(){let t=new m;t.put("a",1),t.put("g",9),t.put("c",3),t.put("j",10),t.put("z",26),t.put("x",24),console.log(`isEmpty= ${t.isEmpty()}`),console.log(`size= ${t.size()}`),console.log(`get-c= ${t.get("c")}`),console.log(`contains z= ${t.contains("z")}`),console.log(`contains m= ${t.contains("m")}`),console.log(a(t.keys())),console.log(`ceil w= ${t.ceiling("w")}`),console.log(`floor k= ${t.floor("k")}`),console.log(`min = ${t.min()}`),console.log(`max = ${t.max()}`),t.remove("x"),console.log(a(t.keys()))}}class g{static M=4;Node(t){return{m:t,children:new Array(g.M)}}Entry(t,r,n=e){return{key:t,val:r,next:n}}constructor(t){this.root=this.Node(0),this.compare=t,this._height=0,this.n=0}isEmpty(){return 0==this.size()}size(){return this.n}height(){return this._height}get(t){if(o.nichts(t))throw Error("argument to get() is null");return this._search(this.root,t,this._height)}_search(t,e,r){let n=t.children;if(0==r){for(let r=0;r<t.m;++r)if(0==this.compare(e,n[r].key))return n[r].val}else for(let s=0;s<t.m;++s)if(s+1==t.m||this.compare(e,n[s+1].key)<0)return this._search(n[s].next,e,r-1)}put(t,e){if(o.nichts(t))throw Error("argument key to put() is null");let r,n=this._insert(this.root,t,e,this._height);this.n+=1,n&&(r=this.Node(2),r.children[0]=this.Entry(this.root.children[0].key,null,this.root),r.children[1]=this.Entry(n.children[0].key,null,n),this.root=r,this._height+=1)}_insert(t,e,r,n){let s,i=this.Entry(e,r);if(0==n)for(s=0;s<t.m&&!(this.compare(e,t.children[s].key)<0);++s);else for(s=0;s<t.m;++s)if(s+1==t.m||this.compare(e,t.children[s+1].key)<0){let o=this._insert(t.children[s++].next,e,r,n-1);if(!o)return null;i.key=o.children[0].key,i.val=null,i.next=o;break}for(let e=t.m;e>s;--e)t.children[e]=t.children[e-1];if(t.children[s]=i,t.m++,t.m>=g.M)return this._split(t)}_split(t){let e=s(g.M/2),r=this.Node(e);t.m=e;for(let n=0;n<e;++n)r.children[n]=t.children[e+n];return r}toString(){return function t(e,r,n){let s="",i=e.children;if(0==r)for(let t=0;t<e.m;++t)s+=`${n}${i[t].key} ${i[t].val}\n`;else for(let o=0;o<e.m;++o)o>0&&(s+=`${n}(${i[o].key})\n`),s+=t(i[o].next,r-1,n+"     ");return s}(this.root,this._height,"")+"\n"}static test(){let t=new g(n);t.put("www.cs.princeton.edu","128.112.136.12"),t.put("www.cs.princeton.edu","128.112.136.11"),t.put("www.princeton.edu","128.112.128.15"),t.put("www.yale.edu","130.132.143.21"),t.put("www.simpsons.com","209.052.165.60"),t.put("www.apple.com","17.112.152.32"),t.put("www.amazon.com","207.171.182.16"),t.put("www.ebay.com","66.135.192.87"),t.put("www.cnn.com","64.236.16.20"),t.put("www.google.com","216.239.41.99"),t.put("www.nytimes.com","199.239.136.200"),t.put("www.microsoft.com","207.126.99.140"),t.put("www.dell.com","143.166.224.230"),t.put("www.slashdot.org","66.35.250.151"),t.put("www.espn.com","199.181.135.201"),t.put("www.weather.com","63.111.66.11"),t.put("www.yahoo.com","216.109.118.65"),console.log("cs.princeton.edu:  "+t.get("www.cs.princeton.edu")),console.log("hardvardsucks.com: "+t.get("www.harvardsucks.com")),console.log("simpsons.com:      "+t.get("www.simpsons.com")),console.log("apple.com:         "+t.get("www.apple.com")),console.log("ebay.com:          "+t.get("www.ebay.com")),console.log("dell.com:          "+t.get("www.dell.com")),console.log(""),console.log("size:    "+t.size()),console.log("height:  "+t.height()),console.log(t.toString()),console.log("")}}class y{constructor(t){this.d=t,this.st=new m}put(t,e){if(t<0||t>=this.d)throw Error("Illegal index");o.feq0(e)?this.st.remove(t):this.st.put(t,e)}get(t){if(t<0||t>=this.d)throw Error("Illegal index");return this.st.contains(t)?this.st.get(t):0}nnz(){return this.st.size()}dimension(){return this.d}dot(t){if(o.assert(t instanceof y,"expected SparseVector data"),this.d!=t.d)throw Error("Vector lengths disagree");let e,r=0,n=(this.st.size()<=t.st.size()?this:t).st.keys();for(;n.hasNext();)e=n.next(),t.st.contains(e)&&(r+=this.get(e)*t.get(e));return r}dotWith(t){let e=0;for(let r,n=this.st.keys();n.hasNext();)r=n.next(),e+=t[r]*this.get(r);return e}magnitude(){return Math.sqrt(this.dot(this))}scale(t){let e=new y(this.d);for(let r,n=this.st.keys();n.hasNext();)r=n.next(),e.put(r,t*this.get(r));return e}plus(t){if(o.assert(t instanceof y,"expected SparseVector data"),this.d!=t.d)throw Error("Vector lengths disagree");let e=new y(this.d);for(let t,r=this.st.keys();r.hasNext();)t=r.next(),e.put(t,this.get(t));for(let r,n=t.st.keys();n.hasNext();)r=n.next(),e.put(r,t.get(r)+e.get(r));return e}toString(){let t="";for(let e,r=this.st.keys();r.hasNext();)e=r.next(),t+=`(${e}, ${this.st.get(e)}) `;return t}static test(){let t=new y(10),e=new y(10);t.put(3,.5),t.put(9,.75),t.put(6,.11),t.put(6,0),e.put(3,.6),e.put(4,.9),console.log("a = "+t.toString()),console.log("b = "+e.toString()),console.log("a dot b = "+t.dot(e)),console.log("a + b   = "+t.plus(e).toString())}}return{prnIter:a,StdCompare:n,BTree:g,Bag:u,Stack:f,Queue:p,ST:m,TreeMap:d,SparseVector:y,Iterator:c}}"object"==typeof module&&module.exports?module.exports=r(require("../main/core")):t["io/czlab/mcfud/algo/basic"]=r}(this),function(t,e){"use strict";function r(e,r){if(e||(e=t["io/czlab/mcfud/core"]()),!r)throw"Fatal: No Colors!";const{is:n,u:s}=e;function i(t,e){let r="";for(;t>0;)r+=e,--t;return r}function o(t,e){let r=h;return e&&(n.str(t)?r="any"==t||t==e?u:h:t instanceof e&&(r=u)),r}function l(t,e,r){return new Promise(((n,s)=>{let i;try{i=r.call(t),i instanceof Promise?i.then((function(t){n(`${t?u:h}: ${e}`)})):(i=i?709394==i?c:u:h,n(`${i}: ${e}`))}catch(t){i=h,n(`${i}: ${e}`)}}))}function a(t,e,r,n){return new Promise(((s,i)=>{let l;try{l=r.call(t),l=709394==l?u:o(n,null)}catch(t){l=o(n,t)}s(`${l}: ${e}`)}))}const[c,h,u]=["Skippd","Failed","Passed"];return{prn(t){const e=t.passed.length,n=t.total,o=e/n*100;console.log(r.white(i(78,"+"))),console.log(r.white.bold(t.title)),console.log(r.white(t.date)),console.log(r.white(i(78,"+"))),t.passed.length>0&&console.log(r.green(t.passed.join("\n"))),t.skippd.length>0&&console.log(r.grey(t.skippd.join("\n"))),t.failed.length>0&&console.log(r.magenta(t.failed.join("\n"))),console.log(r.white(i(78,"="))),console.log(r.yellow(["Passed: ",e,"/",n," [",0|o,"%]"].join(""))),console.log(r.magenta("Failed: "+(n-e))),console.log(r.white(["cpu-time: ",s.prettyMillis(t.duration)].join(""))),console.log(r.white(i(78,"=")))},deftest(t){let[e,r,n,s]=[null,null,null,null];const i={ensure:(t,e)=>(n.push([1,t,e]),i),eerror:(t,e)=>(n.push([911,t,e]),i),begin:t=>(s={},n=[],e=t,i),end(i){r=i;let o=function(){return new Promise(((t,i)=>{e&&e(s);let o,c=[];for(let t,e,r=0;r<n.length;++r){switch(e=n[r],e[0]){case 1:t=l(s,e[1],e[2]);break;case 911:t=a(s,e[1],e[2],"any")}o=o?o.then((function(e){return c.push(e),t})):t}o&&o.then((function(e){c.push(e),n.length=0,r&&r(s),t(c)}))}))};return(o.title=t)&&o}};return i},_run:t=>new Promise(((e,r)=>{t().then((function(t){e(t)}))})),runtest(t,e){const r=Date.now();return this._run(t).then((function(n){const s=Date.now(),i={title:e||t.title,date:(new Date).toString(),total:n.length,duration:s-r,passed:n.filter((t=>"P"==t[0])),skippd:n.filter((t=>"S"==t[0])),failed:n.filter((t=>"F"==t[0]))};return new Promise((t=>{t(i)}))}))}}}"object"==typeof module&&module.exports?module.exports=r(require("./core"),require("colors/safe")):t["io/czlab/mcfud/test"]=r}(this),function(t,e){"use strict";console.log("@czlab/mufud version: 1.5.0")}();