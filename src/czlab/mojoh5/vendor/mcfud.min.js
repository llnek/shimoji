!function(t,e,r){var n,s=256,o="random",i=r.pow(s,6),l=r.pow(2,52),a=2*l,u=255;function c(u,c,m){function g(){for(var t=x.g(6),e=i,r=0;t<l;)t=(t+r)*s,e*=s,r=x.g(1);for(;a<=t;)t/=2,e/=2,r>>>=1;return(t+r)/e}var y=[],v=d(function t(e,r){var n,s=[],o=typeof e;if(r&&"object"==o)for(n in e)try{s.push(t(e[n],r-1))}catch(t){}return s.length?s:"string"==o?e:e+"\0"}((c=1==c?{entropy:!0}:c||{}).entropy?[u,p(e)]:null==u?function(){try{var r;return n&&(r=n.randomBytes)?r=r(s):(r=new Uint8Array(s),(t.crypto||t.msCrypto).getRandomValues(r)),p(r)}catch(r){var o=t.navigator,i=o&&o.plugins;return[+new Date,t,i,t.screen,p(e)]}}():u,3),y),x=new h(y);return g.int32=function(){return 0|x.g(4)},g.quick=function(){return x.g(4)/4294967296},g.double=g,d(p(x.S),e),(c.pass||m||function(t,e,n,s){return s&&(s.S&&f(s,x),t.state=function(){return f(x,{})}),n?(r[o]=t,e):t})(g,v,"global"in c?c.global:this==r,c.state)}function h(t){var e,r=t.length,n=this,o=0,i=n.i=n.j=0,l=n.S=[];for(r||(t=[r++]);o<s;)l[o]=o++;for(o=0;o<s;o++)l[o]=l[i=u&i+t[o%r]+(e=l[o])],l[i]=e;(n.g=function(t){for(var e,r=0,o=n.i,i=n.j,l=n.S;t--;)e=l[o=u&o+1],r=r*s+l[u&(l[o]=l[i=u&i+e])+(l[i]=e)];return n.i=o,n.j=i,r})(s)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function d(t,e){for(var r,n=t+"",s=0;s<n.length;)e[u&s]=u&(r^=19*e[u&s])+n.charCodeAt(s++);return p(e)}function p(t){return String.fromCharCode.apply(0,t)}if(d(r.random(),e),"object"==typeof module&&module.exports){module.exports=c;try{n=require("crypto")}catch(c){}}else"function"==typeof define&&define.amd?define((function(){return c})):r["seed"+o]=c}("undefined"!=typeof self?self:this,[],Math),function(t,e,r){"use strict";function n(){const n=t,s=Math.floor,o=Array.prototype.slice,i=Object.prototype.toString;function l(t){return"[object Object]"==i.call(t)}function a(t){return"[object Function]"==i.call(t)}function u(t){return"[object Array]"==i.call(t)}function c(t){return"[object Map]"==i.call(t)}function h(t){return"[object Set]"==i.call(t)}function f(t){return"[object String]"==i.call(t)}function d(t){return"[object Number]"==i.call(t)}function p(t){return"[object Boolean]"==i.call(t)}function m(t){return t>0?t%2==0:-t%2==0}function g(t){return void 0===t}function y(t){return u(t)||c(t)||l(t)}let v=r?r():new Math.seedrandom;function x(t,e){for(let r,n=0;n<t.length;++n)if(r=t[n],!r[0](r[1]))throw new TypeError("wanted "+e);return!0}function b(t,e){for(let e,r=0;r<t.length;++r)if(e=t[r],e[0](e[1]))return!0;throw new TypeError("wanted "+e)}function M(t,e,r){if(t(e))return!0;throw new TypeError("wanted "+r)}const w=/(\/|\\\\)([^(\/|\\\\)]+)$/g,k=/(\.[^\.\/\?\\]*)(\?.*)?$/;function j(t,e){let r=k.exec(t);return r&&r[1]?(r=r[1].toLowerCase(),e||(r=r.substring(1))):r="",r}let P=0;function A(t,e,r){let n=t(e);switch(r.length){case 0:return n;case 1:return n&&t(r[0]);case 2:return n&&t(r[0])&&t(r[1]);case 3:return n&&t(r[0])&&t(r[1])&&t(r[2]);default:return n&&r.every(e=>t(e))}}const q={},E={fun:(t,...e)=>A(a,t,e),str:(t,...e)=>A(f,t,e),undef:(t,...e)=>A(g,t,e),map:(t,...e)=>A(c,t,e),set:(t,...e)=>A(h,t,e),num:(t,...e)=>A(d,t,e),bool:(t,...e)=>A(p,t,e),pos:t=>d(t)&&t>0,neg:t=>d(t)&&t<0,vec:(t,...e)=>A(u,t,e),obj:(t,...e)=>A(l,t,e),some:t=>S.size(t)>0,none:t=>0===S.size(t),own:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},S={error(...t){console.error(...t)},log(...t){console.log(...t)},srand(){v=r?r():new Math.seedrandom},feq0:t=>Math.abs(t)<1e-10,feq:(t,e)=>Math.abs(t-e)<1e-10,pack:t=>JSON.stringify(t),unpack:t=>JSON.parse(t),v2:(t=0,e=0)=>[t,e],p2:(t=0,e=0)=>({x:t,y:e}),numOrZero:t=>isNaN(t)?0:t,setVec(t,...e){e.forEach((e,r)=>t[r]=e)},evenN:(t,e)=>m(t=Math.floor(t))?t:e?t+1:t-1,nichts:t=>null==t,nor:(t,e)=>null==t?e:t,or:(t,e)=>void 0===t?e:t,toNum(t,e){const r=parseFloat(t);return isNaN(r)&&d(e)?e:r},percentRemain:(t,e)=>t%e/e,splitVerStr(t){const e=(""+(t||"")).split(".").filter(t=>t.length>0);return[this.toNum(e[0],0),this.toNum(e[1],0),this.toNum(e[2],0)]},cmpVerStrs(t,e){let r=this.splitVerStr(""+t),n=this.splitVerStr(""+e);return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]>n[1]?1:r[1]<n[1]?-1:r[2]>n[2]?1:r[2]<n[2]?-1:0},pdef:t=>(t.configurable=!0)&&(t.enumerable=!0)&&t,findFiles:(t,e)=>t.filter(t=>e.indexOf(j(t,1))>-1),partition(t,e){const r=[];for(let n,s,o=0;;){for(n=[],s=0;s<t;++s){if(!(o<e.length)){s=-1;break}n.push(e[o++])}if(n.length>0&&r.push(n),s<0)break}return r},keys:t=>c(t)?Array.from(t.keys()):l(t)?Object.keys(t):[],selectNotKeys(t,e){b([[c,t],[l,t]],"map/object");const r=c(t)?new Map:{};return e=this.seq(e),this.doseq(t,(t,n)=>!e.includes(n)&&this.assoc(r,n,t)),r},selectKeys(t,e){b([[c,t],[l,t]],"map/object");const r=c(t)?new Map:{};return this.seq(e).forEach(e=>{c(t)?t.has(e)&&r.set(e,t.get(e)):E.own(t,e)&&(r[e]=t[e])}),r},assertNot(t,...e){return this.assert(!t,...e)},assert(t,...e){if(!t)throw 0===e.length?"Assertion!":e.join("");return!0},noSuchKeys(t,e){return!this.some(this.seq(t),t=>this.has(e,t)?t:null)},randInt2:(t,e)=>function(t,e){return s(v()*(e-t+1)+t)}(t,e),randFloat:(t,e)=>t+v()*(e-t),randMinus1To1:()=>2*(v()-.5),randInt:t=>s(v()*t),rand:(t=!1)=>t?Math.random():v(),randSign:()=>v()>.5?-1:1,inst:(t,e)=>e instanceof t,hashCode(t){let e=0;for(let r=0;r<t.length;++r)e=Math.imul(31,e)+t.charCodeAt(r);return e},randItem(t){let e;if(t)switch(t.length){case 0:case 1:e=t[0];break;case 2:e=this.randSign()>0?t[1]:t[0];break;default:e=t[s(v()*t.length)]}return e},isPerc:t=>f(t)&&t.match(/^([0-9])(\.?[0-9]+|[0-9]*)%$/),isEven:t=>m(t),jsMap(...t){M(m,t.length,"even n# of args");let e=new Map;for(let r=0;r<t.length;)e.set(t[r],t[r+1]),r+=2;return e},jsObj(...t){M(m,t.length,"even n# of args");let e={};for(let r=0;r<t.length;)e[t[r]]=t[r+1],r+=2;return e},jsVec:(...t)=>0===t.length?[]:t.slice(),lastIndex:t=>u(t)&&t.length>0?t.length-1:-1,first(t){if(u(t)&&t.length>0)return t[0]},last(t){if(u(t)&&t.length>0)return t[t.length-1]},head(t){return this.first(t)},tail(t){return this.last(t)},floor:t=>Math.floor(t),ceil:t=>Math.ceil(t),abs:t=>Math.abs(t),sqrt:t=>Math.sqrt(t),min:(...t)=>Math.min(...t),max:(...t)=>Math.max(...t),slice:(t,e)=>o.call(t,e),every(t,e){M(u,t,"array");for(let r=0;r<t.length;++r)if(a(e)){if(!e(t[r]))return!1}else if(t[r]!=e)return!1;return t.length>0},notAny(t,e){M(u,t,"array");for(let r=0;r<t.length;++r)if(a(e)){if(e(t[r]))return!1}else if(t[r]===e)return!1;return t.length>0},copy(t,e=[]){x([[u,t],[u,e]],"arrays");const r=Math.min(t.length,e.length);for(let n=0;n<r;++n)t[n]=e[n];return t},append(t,e=[]){x([[u,t],[u,e]],"arrays");for(let r=0;r<e.length;++r)t.push(e[r]);return t},fill(t,e,...r){if(d(t)&&(t=new Array(t)),u(t))for(let n=0;n<t.length;++n)t[n]=a(e)?e(...r):e;return t},size(t){return u(t)||f(t)?t.length:h(t)||c(t)?t.size:t?this.keys(t).length:0},nextId:()=>++P,now:()=>Date.now(),fileExt:t=>j(t),fileBase(t){let e,r,n=t.indexOf("?");return n>0&&(t=t.substring(0,n)),t=t.replace(/(\/|\\\\)$/,""),r=w.exec(t),e="",r&&(e=r[2],n=e.lastIndexOf("."),n>0&&(e=e.substring(0,n))),e},range(t,e,r=1){1===arguments.length&&(e=t,t=0,r=1);let n=(e-t)/r;const s=[];n=Math.ceil(n),n=Math.max(0,n),s.length=n;for(let e=0;e<n;++e)s[e]=t,t+=r;return s},shuffle(t,e=!0){M(u,t,"array");const r=o.call(t,0);switch(r.length){case 0:case 1:break;case 2:if(this.randSign()>0){let t=r[0];r[0]=r[1],r[1]=t}break;default:for(let t,e,n=r.length-1;n>0;--n)e=s(v()*(n+1)),t=r[n],r[n]=r[e],r[e]=t}return e?this.copy(t,r):r},uniq:t=>(M(u,t,"array"),Array.from(new Set(t))),map(t,e,r){if(M(y,t,"array/map/object"),u(t))return t.map(e,r);{const n=c(t)?new Map:{};return this.doseq(t,(s,o)=>{this.assoc(n,o,e.call(r,s,o,t))}),n}},find(t,e,r){let n,s=!0,i=o.call(arguments,3);return this.doseq(t,(t,o)=>{s&&e.apply(r,[t,o].concat(i))&&(n=[o,t],s=!1)}),n},some(t,e,r){let n,s=!0,i=o.call(arguments,3);return this.doseq(t,(t,o)=>{s&&(n=e.apply(r,[t,o].concat(i)),n?s=!1:n=void 0)}),n},invoke(t,e){let r=o.call(arguments,2);u(t)&&t.forEach(t=>t[e].apply(t,r))},delay:(t,e)=>setTimeout(e,t),timer:(t,e=0,r=!1)=>({repeat:!!r,id:r?setInterval(t,e):setTimeout(t,e)}),clear(t){t&&t.id?(t.repeat?clearInterval(t.id):clearTimeout(t.id),t.id=0):E.pos(t)&&clearTimeout(t)},rseq(t,e,r){if(M(u,t,"array"),t.length>0)for(let n=t.length-1;n>=0;--n)e.call(r,t[n],n,t)},doseq(t,e,r){u(t)?t.forEach(e,r):c(t)?t.forEach((n,s)=>e.call(r,n,s,t)):l(t)&&Object.keys(t).forEach(n=>e.call(r,t[n],n,t))},doseqEx(t,e,r){this.doseq(t,(n,s)=>null!=n&&e.call(r,n,s,t))},dissoc(t,e){if(arguments.length>2){let e,r=1;for(;r<arguments.length;++r)e=this.dissoc(t,arguments[r]);return e}{let r;return c(t)?(r=t.get(e),t.delete(e)):l(t)&&(r=t[e],delete t[e]),r}},get(t,e){if(void 0!==e){if(c(t))return t.get(e);if(t)return t[e]}},assoc(t,e,r){if(arguments.length>3){if((arguments.length-1)%2!=0)throw"wanted even count of args";let e,r=1;for(;r<arguments.length;)e=this.assoc(t,arguments[r],arguments[r+1]),r+=2;return e}{let n;return c(t)?(n=t.get(e),t.set(e,r)):t&&(n=t[e],t[e]=r),n}},disj(t,e){const r=t?t.indexOf(e):-1;return r>-1&&t.splice(r,1),r>-1},conj:(t,...e)=>(t&&e.forEach(e=>t.push(e)),t),seq:(t,e=/[,; \t\n]+/)=>("string"==typeof t&&(t=t.split(e).map(t=>t.trim()).filter(t=>t.length>0)),u(t)||(t=[t]),t),has(t,e){return 1!==arguments.length&&(c(t)?t.has(e):u(t)?-1!==t.indexOf(e):!!l(t)&&E.own(t,e))},patch(t,e){return M(l,t=t||{},"object"),e&&Object.keys(e).forEach(r=>{this.has(t,r)||(t[r]=e[r])}),t},clone(t){return t?this.unpack(this.pack(t)):t},inject:(t,...e)=>(t=t||{},e.forEach(e=>e&&function(t,e){let r=Object.keys(e).reduce((t,r)=>(t[r]=Object.getOwnPropertyDescriptor(e,r),t),{});return Object.getOwnPropertySymbols(e).forEach(t=>{let n=Object.getOwnPropertyDescriptor(e,t);n.enumerable&&(r[t]=n)}),Object.defineProperties(t,r),t}(t,e)),t),deepCopyArray(t){M(u,t,"array");const e=[];for(let r=0,n=t.length;r<n;++r)e[r]=u(t[r])?this.deepCopyArray(t[r]):t[r];return e},mergeEx(t,e){return this.merge(this.merge({},t),e)},merge(t,e){let r;return Object.keys(e).forEach(n=>{r=e[n],"object"==typeof r&&null!==r&&t[n]?("object"!=typeof t[n]&&(t[n]=r instanceof Array?[]:{}),this.merge(t[n],r)):t[n]=r}),t},throttle(t,e,r){let n=!0,s=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return l(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),this.debounce(t,e,{leading:n,trailing:s,maxWait:e})},debounce(t,e,r){let s,o,i,a,u,c,h=0,f=!1,d=!1,p=!0;const m=!e&&0!==e&&"function"==typeof n.requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function g(e){const r=s,n=o;return s=o=void 0,h=e,a=t.apply(n,r),a}function y(t,e){return m?(n.cancelAnimationFrame(u),n.requestAnimationFrame(t)):setTimeout(t,e)}function v(t){const r=t-c;return void 0===c||r>=e||r<0||d&&t-h>=i}function x(){const t=Date.now();if(v(t))return b(t);u=y(x,function(t){const r=t-h,n=e-(t-c);return d?Math.min(n,i-r):n}(t))}function b(t){return u=void 0,p&&s?g(t):(s=o=void 0,a)}function M(...t){const r=Date.now(),n=v(r);if(s=t,o=this,c=r,n){if(void 0===u)return function(t){return h=t,u=y(x,e),f?g(t):a}(c);if(d)return u=y(x,e),g(c)}return void 0===u&&(u=y(x,e)),a}return e=+e||0,l(r)&&(f=!!r.leading,d="maxWait"in r,i=d?Math.max(+r.maxWait||0,e):i,p="trailing"in r?!!r.trailing:p),M.cancel=function(){void 0!==u&&function(t){if(m)return n.cancelAnimationFrame(t);clearTimeout(t)}(u),h=0,s=c=o=u=void 0},M.flush=function(){return void 0===u?a:b(Date.now())},M.pending=function(){return void 0!==u},M},negate:t=>(M(a,t,"function"),function(...e){return!t.apply(this,e)}),strPadRight:(t,e,r)=>(e-=t.length)>0?t+new Array(Math.ceil(e/r.length)+1).join(r).substr(0,e):t,strPadLeft:(t,e,r)=>(e-=t.length)>0?new Array(Math.ceil(e/r.length)+1).join(r).substr(0,e)+t:t,safeSplit:(t,e)=>(t||"").trim().split(e).filter(t=>t.length>0),capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),prettyNumber(t,e=2){return this.strPadLeft(Number(t).toString(),e,"0")},prettyMillis(t){let e,r,n=s(t/1e3);r=s(n/60),t-=1e3*n,n-=60*r,e=s(r/60),r-=60*e;let o=[];return o.push(`${n}.${t} secs`),(r>0||e>0)&&o.push(r+" mins, "),e>0&&o.push(e+" hrs, "),o.reverse().join("")},dropArgs:(t,e)=>t.length>e?o.call(t,e):[],isSSL:()=>t&&t.location&&t.location.protocol.indexOf("https")>=0,isMobile:t=>t&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t.userAgent),isSafari:t=>t&&/Safari/.test(t.userAgent)&&/Apple Computer/.test(t.vendor),isCrossOrigin(e){let r=t;if(2===arguments.length&&911===arguments[1].hack&&(r=arguments[1]),r&&r.location&&e){const t=e.indexOf("://");if(t>0){let n=e.indexOf("/",t+3);return(n<0?e:e.substring(0,n))!=r.location.origin}}},addEvent(t,e,r,n){u(t)&&1===arguments.length?t.forEach(t=>this.addEvent.apply(this,t)):e.addEventListener(t,r,n)},delEvent(t,e,r,n){u(t)&&1===arguments.length?t.forEach(t=>this.delEvent.apply(this,t)):e.removeEventListener(t,r,n)}},B={qSelector:t=>e.querySelectorAll(t),qId:t=>e.getElementById(t),parent(t){if(t)return t.parentNode},conj:(t,e)=>t.appendChild(e),byTag:(t,r)=>f(r)?e.getElementsByTagNameNS(r,t):e.getElementsByTagName(id),attrs(t,e){return!l(e)&&e?(arguments.length>2&&t.setAttribute(e,arguments[2]),t.getAttribute(e)):(e&&S.doseq(e,(e,r)=>t.setAttribute(r,e)),t)},css(t,e){return!l(e)&&e?(arguments.length>2&&(t.style[e]=arguments[2]),t.style[e]):(e&&S.doseq(e,(e,r)=>t.style[r]=e),t)},wrap(t,e){const r=t.parentNode;return e.appendChild(t),r.appendChild(e),e},newElm(t,r,n){const s=e.createElement(t);return this.attrs(s,r),this.css(s,n),s},newTxt(t,r,n){const s=e.createTextNode(t);return this.attrs(s,r),this.css(s,n),s}},I={},N=[];class C{constructor(){this._tree=new Map,this._targets=new Map}sub(t,e,r,n){let s=t[0],o=t[1];return o&&!this._targets.has(o)&&this._targets.set(o,1),S.seq(s).forEach(t=>{if(e||(e=t),f(e)&&(e=(r=r||o)[e]),!e)throw"Error: no callback for sub()";this._tree.has(t)||this._tree.set(t,S.jsMap());let s=this._tree.get(t);o=o||I,!s.has(o)&&s.set(o,[]),s.get(o).push([e,r,n])}),this}pub(t,...e){let r,n,s=t[0],o=t[1]||I;return(o===I||this._targets.has(o))&&S.seq(s).forEach(t=>{n=this._tree.get(t),r=n&&n.get(o),r&&r.forEach(t=>{t[0].apply(t[1],e.concat(t[2]||N))})}),this}reset(){return this._targets.clear(),this._tree.clear(),this}drop(t){if(this._targets.has(t)){this._targets.delete(t);let e=this._tree.values();for(let r=e.next();!r.done;)r.value.delete(t),r=e.next()}return this}unsub(t,e,r){if(1!==arguments.length||E.vec(t)){let n=t[0],s=t[1]||I;if(s===I||this._targets.has(s)){let t,o;S.seq(n).forEach(n=>{if(t=this._tree.get(n),o=t&&t.get(s),o&&(f(e)&&(e=(r=r||s)[e]),e))for(let t=o.length-1;t>=0;--t)o[t][0]===e&&o[t][1]===r&&o.splice(t,1)})}}else this.drop(t);return this}}return e?q.dom=B:(delete S.addEvent,delete S.delEvent),q.EventBus=function(){return new C},q.is=E,q.u=S,q}"object"==typeof module&&module.exports?r=require("../tpcl/seedrandom.min"):e=t.document,"object"==typeof module&&module.exports?module.exports=n():t["io/czlab/mcfud/core"]=n}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const r=360,n=2*Math.PI,{is:s,u:o}=(Math.PI,e);function i(t){return t<0?- -t%r:t%r}return{lerp:(t,e,r)=>(1-r)*t+r*e,xmod:(t,e)=>t<0?t- -(e+e*Math.floor(-t/e)):t%e,clamp:(t,e,r)=>r<t?t:r>e?e:r,sqr:t=>t*t,fuzzyEq:(t,e)=>o.feq(t,e),fuzzyZero:t=>o.feq0(t),radToDeg:t=>i(r*t/n),degToRad:t=>n*i(t)/r,pythag2:(t,e)=>t*t+e*e,pythag:(t,e)=>Math.sqrt(t*t+e*e),wrap:(t,e)=>(t+1)%e,biasGreater:(t,e)=>t>=.95*e+.01*t}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/math"]=e}(this),function(t){"use strict";function e(e=null){e||(e=t["io/czlab/mcfud/core"]());const{u:r,is:n}=e;function s(t,e){r.assert(!n.num(t)&&!n.num(e)&&t&&e,"wanted 2 vecs")}function o(t,e=0,r=0){return t?[e,r]:{x:e,y:r}}const i={};class l{constructor(){this.x=0,this.y=0}unit(t){return n.bool(t)&&(t=o(t)),n.vec(t)?(t[0]=this.x,t[1]=this.y):(t.x=this.x,t.y=this.y),t}bind(t){return n.vec(t)?(this.x=t[0],this.y=t[1]):(this.x=t.x,this.y=t.y),this}op(t,e,r){let s=i.take();switch(s.x=this.x,s.y=this.y,t){case"+":n.num(e)&&(s.x+=e),n.num(r)&&(s.y+=r);break;case"-":n.num(e)&&(s.x-=e),n.num(r)&&(s.y-=r);break;case"*":n.num(e)&&(s.x*=e),n.num(r)&&(s.y*=r);break;case"/":n.num(e)&&(s.x/=e),n.num(r)&&(s.y/=r)}return s}"+"(t){return this.op("+",t.x,t.y)}"-"(t){return this.op("-",t.x,t.y)}"*"(t){return this.op("*",t.x,t.y)}"/"(t){return this.op("/",t.x,t.y)}}function a(t,e,r,s,o,i,l){const a=t-o,u=e-i,c=o+(a*r-u*s),h=i+(a*s+u*r);return n.vec(l)?(l[0]=c,l[1]=h):(l.x=c,l.y=h),l}function u(t,e,r,s){let o,l,a=i.take().bind(t);if(n.num(e))l=a.op(r,e,e);else{let t=i.take().bind(e);l=a[r](t),i.drop(t)}return o=l.unit(s?t:n.vec(t)),i.drop(a,l),o}r.inject(i,{take(){return this._pool.pop()},drop(...t){t.forEach(t=>{t.x=0,t.y=0,this._pool.push(t)})},_pool:r.fill(16,()=>new l)});return{vec:(t=0,e=0)=>o(!0,t,e),vecXY:(t=0,e=0)=>o(!1,t,e),add(t,e){return r.assert(2===arguments.length)&&u(t,e,"+")},add$(t,e){return r.assert(2===arguments.length)&&u(t,e,"+",!0)},sub(t,e){return r.assert(2===arguments.length)&&u(t,e,"-")},sub$(t,e){return r.assert(2===arguments.length)&&u(t,e,"-",!0)},mul(t,e){return r.assert(2===arguments.length)&&u(t,e,"*")},mul$(t,e){return r.assert(2===arguments.length)&&u(t,e,"*",!0)},div(t,e){return r.assert(2===arguments.length)&&u(t,e,"/")},div$(t,e){return r.assert(2===arguments.length)&&u(t,e,"/",!0)},dot(t,e){s(t,e);let r=i.take().bind(t),n=i.take().bind(e),o=r.x*n.x+r.y*n.y;return i.drop(r,n),o},vecAB(t,e){s(t,e);let r=i.take().bind(t),o=i.take().bind(e),l=i.take();l.x=o.x-r.x,l.y=o.y-r.y;let a=l.unit(n.vec(t));return i.drop(r,o,l),a},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},dist2(t,e){return this.len2(this.sub(e,t))},dist(t,e){return Math.sqrt(this.dist2(t,e))},unit(t){let e=i.take().bind(t),s=this.len(t);r.feq0(s)?(e.x=0,e.y=0):(e.x/=s,e.y/=s);let o=e.unit(n.vec(t));return i.drop(e),o},unit$(t){let e=i.take().bind(t),n=this.len(t);r.feq0(n)?(e.x=0,e.y=0):(e.x/=n,e.y/=n);let s=e.unit(t);return i.drop(e),s},copy(t,e){s(t,e);let r=i.take().bind(t),n=i.take().bind(e);r.x=n.x,r.y=n.y;let o=r.unit(t);return i.drop(r,n),o},clone(t){let e=i.take().bind(t),r=e.unit(n.vec(t));return i.drop(e),r},set(t,e,r){let s=i.take().bind(t);n.num(e)&&(s.x=e),n.num(r)&&(s.y=r);let o=s.unit(t);return i.drop(s),o},setX(t,e){return this.set(t,e)},setY(t,e){return this.set(t,null,e)},rot(t,e,r=null){let s=i.take().bind(t),l=0,u=0;if(r){let t=i.take().bind(r);l=t.x,u=t.y,i.drop(t)}let c=a(s.x,s.y,Math.cos(e),Math.sin(e),l,u,o(n.vec(t)));return i.drop(s),c},rot$(t,e,r){let n=i.take().bind(t),s=0,o=0;if(r){let t=i.take().bind(r);s=t.x,o=t.y,i.drop(t)}let l=a(n.x,n.y,Math.cos(e),Math.sin(e),s,o,t);return i.drop(n),l},cross(t,e){let r;if(n.num(t)){let s=i.take().bind(e),o=i.take();o.x=-t*s.y,o.y=t*s.x,r=o.unit(n.vec(e)),i.drop(s,o)}else if(n.num(e)){let s=i.take().bind(t),o=i.take();o.x=e*s.y,o.y=-e*s.x,r=o.unit(n.vec(t)),i.drop(s,o)}else{s(t,e);let n=i.take().bind(t),o=i.take().bind(e);r=n.x*o.y-n.y*o.x,i.drop(n,o)}return r},angle(t,e){return Math.acos(this.dot(t,e)/(this.len(t)*this.len(e)))},normal(t,e=!1){let r=i.take().bind(t),s=i.take();e?(s.x=-r.y,s.y=r.x):(s.x=r.y,s.y=-r.x);let o=s.unit(n.vec(t));return i.drop(r,s),o},normal$(t,e=!1){let r=i.take().bind(t),n=i.take();e?(n.x=-r.y,n.y=r.x):(n.x=r.y,n.y=-r.x);let s=n.unit(t);return i.drop(r,n),s},proj_scalar(t,e){return this.dot(t,e)/this.len(e)},proj(t,e){const r=this.unit(e);this.mul$(r,this.dot(t,r));let s=i.take().bind(r),o=s.unit(n.vec(t));return i.drop(s),o},perp(t,e){return this.sub(t,this.proj(t,e))},reflect(t,e){let r=2*this.dot(t,e);return this.sub(t,this.mul(e,r))},flip(t){return this.mul(t,-1)},flip$(t){return this.mul$(t,-1)},translate(t,...e){let r,s,o,l,a=i.take().bind(t);return 1===e.length&&n.vec(e[0])&&!n.num(e[0][0])&&(e=e[0]),o=e.map(t=>(s=i.take().bind(t),r=s["+"](a),l=r.unit(n.vec(t)),i.drop(s,r),l)),i.drop(a),o}}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/vec2"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());Math.atan2;const r=Math.cos,n=Math.sin,s=(Math.tan,Math.floor),{u:o,is:i}=e;function l(t){return t%2!=0}function a(t,e,r,n){return n-1+(r-1)*e}function u(t,e,r){return{dim:[t,e],cells:r}}function c(t,e){return u(t,e,o.fill(t*e,0))}return{v4:(t=0,e=0,r=0,n=0)=>[t,e,r,n],v3:(t=0,e=0,r=0)=>[t,e,r],dot:(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],cross(t,e){return this.v3(t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0])},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},unit(t){let e=this.len(t);if(!o.feq0(e))return[t[0]/e,t[1]/e,t[2]/e]},sub(t,e){return i.num(e)?this.v3(t[0]-e,t[1]-e,t[2]-e):this.v3(t[0]-e[0],t[1]-e[1],t[2]-e[2])},add(t,e){return i.num(e)?this.v3(t[0]+e,t[1]+e,t[2]+e):this.v3(t[0]+e[0],t[1]+e[1],t[2]+e[2])},mul(t,e){return i.num(e)?this.v3(t[0]*e,t[1]*e,t[2]*e):this.v3(t[0]*e[0],t[1]*e[1],t[2]*e[2])},div(t,e){return i.num(e)?this.v3(t[0]/e,t[1]/e,t[2]/e):this.v3(t[0]/e[0],t[1]/e[1],t[2]/e[2])},matrix([t,e],...r){const n=t*e;return 0===r.length?c(t,e):o.assert(n===r.length)&&u(t,e,r)},matCell(t,e,r,n){const s=a(t.dim[0],t.dim[1],e,r);if(s>=0&&s<t.cells.length)return i.num(n)?(t.cells[s]=n,t):t.cells[s]},matIdentity(t){const e=o.assert(t>0)&&o.fill(t*t,0);for(let r=0;r<t;++r)e[a(0,t,r+1,r+1)]=1;return u(t,t,e)},matZero:t=>o.assert(t>0)&&u(t,t,o.fill(t*t,0)),matRowMajors(t){const[e,r]=t.dim;return o.partition(r,t.cells)},matColMajors(t){const[e,r]=t.dim,n=[];for(let s,o=0;o<r;++o){s=[];for(let n=0;n<e;++n)s.push(t.cells[n*r+o]);n.push(s)}return n},mat2(t,e,r,n){return this.matrix([2,2],t,e,r,n)},mat3(t,e,r,n,s,o,i,l,a){return this.matrix([3,3],t,e,r,n,s,o,i,l,a)},mat4(t,e,r,n,s,o,i,l,a,u,c,h,f,d,p,m){return this.matrix([4,4],t,e,r,n,s,o,i,l,a,u,c,h,f,d,p,m)},matEq:(t,e)=>t.dim[0]===e.dim[0]&&t.dim[1]===e.dim[1]&&function(t,e){for(let r=0;r<t.length;++r)if(!o.feq(t[r],e[r]))return!1;return!0}(t.cells,e.cells),matXpose(t){const[e,r]=t.dim,n=e*r,o=[];for(let i=0;i<n;++i)o.push(t.cells[s(i/e)+r*(i%e)]);return u(r,e,o)},matScale:(t,e)=>u(t.dim[0],t.dim[1],t.cells.map(t=>t*e)),matMult(t,e){let[r,n]=t.dim,[s,i]=e.dim,l=t.cells,a=e.cells;o.assert(n===s,"mismatch matrices");let c=new Array(r*i);for(let t=0;t<r;++t)for(let e=0;e<i;++e)c[e+t*i]=o.range(s).reduce((r,s)=>r+l[s+t*n]*a[e+s*i],0);return u(r,i,c)},matDet(t){let[e,r]=t.dim,n=[];if(2===r)return this._matDet2x2(t);for(let e=0;e<r;++e)o.conj(n,this.matDet(this.matCut(t,1,e+1)));return o.range(r).reduce((e,r)=>{let s=n[r];return e+t.cells[r]*(l(r)?-s:s)},0)},_matDet2x2:t=>(o.assert(4===t.cells.length),t.cells[0]*t.cells[3]-t.cells[1]*t.cells[2]),matCut(t,e,r){const[n,s]=t.dim;let i=e-1,l=r-1,a=[];for(let e=0;e<n;++e)for(let r=0;r<s;++r)e!==i&&r!==l&&o.conj(a,t.cells[r+e*s]);return u(n-1,s-1,a)},matMinor(t){const[e,r]=t.dim;let n=[];if(o.assert(e===r),2===r)return this._matMinor2x2(t);for(let s=0;s<e;++s)for(let e=0;e<r;++e)o.conj(n,this.matDet(this.matCut(t,s+1,e+1)));return u(e,r,n)},_matMinor2x2(t){return o.assert(4===t.cells.length)&&this.mat2(t.cells[3],t.cells[2],t.cells[1],t.cells[0])},matCofactor(t){const e=this.matMinor(t),[r,n]=e.dim;let s=e.cells.slice();for(let t=0;t<r;++t)for(let e,r=0;r<n;++r)e=t*n+r,l(t+r)&&(s[e]=-s[e]);return u(r,n,s)},matAdjugate(t){return this.matXpose(this.matCofactor(t))},_minv2x2(t){const[e,r]=t.dim;o.assert(4===t.cells.length&&2===e&&2===r);let n,s=t.cells,i=s[0]*s[3]-s[1]*s[2];if(o.feq0(i))n=this.matIdentity(e);else{let t=1/i;n=this.mat2(s[3]*t,-s[1]*t,-s[2]*t,s[0]*t)}return n},matInv(t){const[e,r]=t.dim;if(2===r)return this._minv2x2(t);let n=this.matDet(t);return o.feq0(n)?this.matIdentity(e):this.matScale(this.matAdjugate(t),1/n)},matFromColMajor(t){let e=t.length,r=c(t[0].length,e);for(let n,s=0;s<t.length;++s){n=t[s];for(let t=0;t<n.length;++t)r.cells[t*e+s]=n[t]}return r},matToColMajor(t){const[e,r]=t.dim,n=[];t.cells.slice();for(let s,o=0;o<r;++o){s=[];for(let n=0;n<e;++n)s.push(t.cells[n*r+o]);n.push(s)}return n},scale3D(t){const e=this.matIdentity(4);return e.cells[a(0,4,1,1)]=t[0],e.cells[a(0,4,2,2)]=t[1],e.cells[a(0,4,3,3)]=t[2],e},translate3D(t){const e=this.matIdentity(4);return e.cells[a(0,4,4,1)]=t[0],e.cells[a(0,4,4,2)]=t[1],e.cells[a(0,4,4,3)]=t[2],e},rot3D(t,e,r){return this.matMult(this.zRot3D(r),this.matMult(this.yRot3D(e),this.xRot3D(t)))},matVMult(t,e){let r=t.dim[1],n=e.length;o.assert(r===n);let s=this.matMult(t,u(n,1,e)),i=s.cells;return s.cells=null,i},rot2D(t){return this.mat2(r(t),-n(t),n(t),r(t))},xRot3D(t){return this.mat4(1,0,0,0,0,r(t),-n(t),0,0,n(t),r(t),0,0,0,0,1)},yRot3D(t){return this.mat4(r(t),0,n(t),0,0,1,0,0,-n(t),0,r(t),0,0,0,0,1)},zRot3D(t){return this.mat4(r(t),-n(t),0,0,n(t),r(t),0,0,0,0,1,0,0,0,0,1)},isIdentity(t){const[e,r]=t.dim;if(e===r){for(let n,s=0;s<e;++s)for(let e=0;e<r;++e)if(n=t.cells[s*r+e],s+1===e+1){if(1!==n)return!1}else if(0!==n)return!1;return!0}return!1},isOrthogonal(t){let e=this.matDet(t);return 1===Math.abs(e)&&this.isIdentity(this.matMult(this.matXpose(t),this.matInv(t)))}}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/matrix"]=e}(this),function(t){"use strict";const e=" @N/\\Ri2}aP`(xeT4F3mt;8~%r0v:L5$+Z{'V)\"CKIc>z.*fJEwSU7juYg<klO&1?[h9=n,yoQGsW]BMHpXb6A|D#q^_d!-",r=e.length;function n(n){n||(n=t["io/czlab/mcfud/core"]());const{u:s}=n;function o(t){return Math.abs(t)%r}function i(t,r){return(r||e).charAt(t)}function l(t){for(let e=0;e<r;++e)if(i(e)===t)return e;return-1}function a(t,e){let n=e+t;return i(n>=r?n-r:n)}function u(t,e){let n=e-t;return i(n<0?r+n:n)}return{encrypt(t,e){if(0===e)return t;let r,n=[],s=o(e);return t.split("").forEach(t=>{r=l(t),n.push(r<0?t:function(t,e,r){return t<0?a(e,r):u(e,r)}(e,s,r))}),n.join("")},decrypt(t,e){if(0===e)return t;let r,n=[],s=o(e);return t.split("").forEach(t=>{r=l(t),n.push(r<0?t:function(t,e,r){return t<0?u(e,r):a(e,r)}(e,s,r))}),n.join("")}}}"object"==typeof module&&module.exports?module.exports=n(require("./core")):t["io/czlab/mcfud/crypt"]=n}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());return{fsm(t){let e=t.initState();return{state:()=>e,process(){const r=t[e];r&&r.run&&r.run()},trigger(r="change",n){const s=t[e],o=s&&s.transitions[r];if(o){const r=o.target,i=t[r];if(i)return s.exit&&s.exit(),i.enter&&i.enter(),n&&n.action?n.action():o.action&&(n?o.action(n):o.action()),e=r}}}}}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/fsm"]=e}(this),function(t){"use strict";function e(e,r){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/math"]());const n=2*Math.PI,{u:s}=e;return{TXMatrix2D:class{constructor(t){t?(this.m=[],this.clone(t)):this.m=[1,0,0,0,1,0]}identity(){const t=this.m;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,this}clone(t){let e=this.m,r=t.m;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],this}multiply(t){let e=this.m,r=t.m,n=e[0]*r[0]+e[1]*r[3],s=e[0]*r[1]+e[1]*r[4],o=e[0]*r[2]+e[1]*r[5]+e[2],i=e[3]*r[0]+e[4]*r[3],l=e[3]*r[1]+e[4]*r[4],a=e[3]*r[2]+e[4]*r[5]+e[5];return e[0]=n,e[1]=s,e[2]=o,e[3]=i,e[4]=l,e[5]=a,this}rotate(t){if(!s.feq0(t)){let e=this.m,r=Math.cos(t),n=Math.sin(t),s=e[0]*r+e[1]*n,o=-e[0]*n+e[1]*r,i=e[3]*r+e[4]*n,l=-e[3]*n+e[4]*r;e[0]=s,e[1]=o,e[3]=i,e[4]=l}return this}rotateDeg(t){return s.feq0(t)?this:this.rotate(Math.PI*t/180)}scale(t,e){let r=this.m;return void 0===e&&(e=t),r[0]*=t,r[1]*=e,r[3]*=t,r[4]*=e,this}translate(t,e){let r=this.m;return r[2]+=r[0]*t+r[1]*e,r[5]+=r[3]*t+r[4]*e,this}transform(t,e){return[t*this.m[0]+e*this.m[1]+this.m[2],t*this.m[3]+e*this.m[4]+this.m[5]]}transformPoint(t){const[e,r]=this.transform(t.x,t.y);return t.x=e,t.y=r,t}transformArray(t){return this.transform(t[0],t[1])}setContextTransform(t){const e=this.m;t.transform(e[0],e[3],e[1],e[4],e[2],e[5])}},textStyle(t,e,r,n){const s={font:t,fill:e};return r&&(s.align=r),n&&(s.base=n),s},drawShape(t,e,...r){e&&e.draw&&e.draw(t,...r)},cfgStyle(t,e){const{line:r,stroke:n}=e;r&&(r.cap&&(t.lineCap=r.cap),r.width&&(t.lineWidth=r.width)),n&&n.style&&(t.strokeStyle=n.style)},drawPoints(t,e,r){void 0===r&&(r=e.length),s.assert(r<=e.length),t.beginPath();for(let n,s,o,i=0;i<r;++i)o=(i+1)%r,n=e[i],s=e[o],t.moveTo(n[0],n[1]),t.lineTo(s[0],s[1]);t.stroke()},drawShapePoly(t,e){return this.drawPoints(t,e.points)},drawCircle(t,e,r,s){t.beginPath(),t.arc(e,r,s,0,n,!0),t.closePath(),t.stroke()},drawShapeCircle(t,e){return this.drawCircle(t,e.pos[0],e.pos[1],e.radius)},drawRect(t,e,r,n,s,o){let i=e,l=r-s;t.save(),t.translate(i,l),t.rotate(o),t.strokeRect(0,0,n,s),t.restore()},drawShapeRect(t,e){return this.drawRect(t,e.pos[0],e.pos[1],e.width,e.height,e.rotation)},drawLine(t,e,r,n,s){t.beginPath(),t.moveTo(e,r),t.lineTo(n,s),t.stroke()},drawShapeLine(t,e){return this.drawLine(t,e.p[0],e.p[1],e.q[0],e.q[1])}}}"object"==typeof module&&module.exports?module.exports=e(require("./core"),require("./math")):t["io/czlab/mcfud/gfx"]=e}(this),function(t){"use strict";const[e,r,n]=[1,0,-1];function s(s,o,i){s||(s=t["io/czlab/mcfud/core"]()),o||(o=t["io/czlab/mcfud/math"]()),i||(i=t["io/czlab/mcfud/vec2"]());const l=Math.floor,a=Math.abs,{u:u}=s;function c(t){const e=t.length,r=u.assert(e<=36)&&u.fill(36);let n=0,s=t[0][0];for(let r,o=1;o<e;++o)r=t[o][0],r>s?(s=r,n=o):u.feq(r,s)&&t[o][1]<t[n][1]&&(n=o);let o=0,l=n;for(;;){r[o]=l;let s=0,a=r[o];for(let r,n,o,c=1;c<e;++c)s!==l?(r=i.sub(t[s],t[a]),n=i.sub(t[c],t[a]),o=i.cross(r,n),o<0&&(s=c),u.feq0(o)&&i.len2(n)>i.len2(r)&&(s=c)):s=c;if(l=s,++o,s===n)break}const a=[];for(let e=0;e<o;++e)a.push(i.clone(t[r[e]]));return a}class h{constructor(t,e,r,n){switch(arguments.length){case 2:this.pos=i.vec(),this.width=t,this.height=e;break;case 4:this.pos=i.vec(t,e),this.width=r,this.height=n;break;default:throw"Error: bad input to Rect()"}}}class f{constructor(t,e){this.width=t,this.height=e}half(){return new f(l(this.width/2),l(this.height/2))}}class d{constructor(t,e,r,n){this.p=i.vec(t,e),this.q=i.vec(r,n)}}class p{constructor(t,e){this.calcPoints=null,this.normals=null,this.edges=null,this.points=null,this.orient=0,this.pos=i.vec(),this.setPos(t,e)}setPos(t=0,e=0){return i.set(this.pos,t,e),this}set(t){return this.calcPoints=this.calcPoints||[],this.normals=this.normals||[],this.edges=this.edges||[],this.calcPoints.length=0,this.normals.length=0,this.edges.length=0,this.points=u.assert(t.length>2)&&c(t),u.doseq(this.points,t=>{this.calcPoints.push(i.vec()),this.edges.push(i.vec()),this.normals.push(i.vec())}),this._recalc()}setOrient(t){return this.orient=t,this._recalc()}translate(t,e){return u.doseq(this.points,r=>{r[0]+=t,r[1]+=e}),this._recalc()}_recalc(){if(this.points){let t,e,r;u.doseq(this.points,(t,e)=>{i.copy(this.calcPoints[e],t),u.feq0(this.orient)||i.rot$(this.calcPoints[e],this.orient)}),u.doseq(this.points,(n,s)=>{t=(s+1)%this.calcPoints.length,e=this.calcPoints[s],r=this.calcPoints[t],this.edges[s]=i.sub(r,e),this.normals[s]=i.unit(i.normal(this.edges[s]))})}return this}}class m{constructor(t,e){this.overlapN=i.vec(),this.overlapV=i.vec(),this.A=t,this.B=e,this.clear()}swap(){let t=new m,e=this.AInB,r=this.BInA,n=this.A;return t.overlap=this.overlap,t.A=this.B,t.B=n,t.AInB=r,t.BInA=e,t.overlapN=i.flip(this.overlapN),t.overlapV=i.flip(this.overlapV),t}clear(){return this.overlap=1/0,this.AInB=!0,this.BInA=!0,this}}function g(t,e){let r=1/0,n=-1/0;for(let s,o=0;o<t.length;++o)s=i.dot(t[o],e),s<r&&(r=s),s>n&&(n=s);return[r,n]}function y(t,s){let o=i.len2(t),l=i.dot(s,t);return l<0?e:l>o?n:r}function v(t,e,r,n,s,o){let[l,a]=g(e,s),[u,c]=g(n,s),h=i.vecAB(t,r),f=i.dot(h,s);if(u+=f,c+=f,l>c||u>a)return!0;if(o){let t=0;if(l<u)if(o.AInB=!1,a<c)t=a-u,o.BInA=!1;else{let[e,r]=[a-u,c-l];t=e<r?e:-r}else if(o.BInA=!1,a>c)t=l-c,o.AInB=!1;else{let[e,r]=[a-u,c-l];t=e<r?e:-r}let e=Math.abs(t);e<o.overlap&&(o.overlap=e,i.copy(o.overlapN,s),t<0&&i.flip$(o.overlapN))}}new m,x=new h(0,0,1,1),new p(x.pos[0],x.pos[1]).set([i.vec(x.width,0),i.vec(x.width,x.height),i.vec(0,x.height),i.vec()]);var x;function b(t,e,r){let n=i.vecAB(t.pos,e.pos),s=t.radius+e.radius,o=s*s,l=i.len2(n),a=!(l>o);if(a&&r){let o=Math.sqrt(l);r.A=t,r.B=e,r.overlap=s-o,i.copy(r.overlapN,i.unit$(n)),i.copy(r.overlapV,i.mul(n,r.overlap)),r.AInB=t.radius<=e.radius&&o<=e.radius-t.radius,r.BInA=e.radius<=t.radius&&o<=t.radius-e.radius}return a}function M(t,r,s){let o,l=i.vecAB(t.pos,r.pos),a=r.radius*r.radius,u=t.calcPoints,c=i.vec();for(let h,f,d,p,m=u.length,g=0;g<m;++g){h=g===m-1?0:g+1,f=0===g?m-1:g-1,d=0,p=null,i.copy(c,t.edges[g]),o=i.vecAB(u[g],l),s&&i.len2(o)>a&&(s.AInB=!1);let v=y(c,o);if(v===e){if(i.copy(c,t.edges[f]),v=y(c,i.vecAB(u[f],l)),v===n){let t=i.len(o);if(t>r.radius)return!1;s&&(s.BInA=!1,p=i.unit(o),d=r.radius-t)}}else if(v===n){if(i.copy(c,t.edges[h]),i.sub$(i.copy(o,l),u[h]),v=y(c,o),v===e){let t=i.len(o);if(t>r.radius)return!1;s&&(s.BInA=!1,p=i.unit(o),d=r.radius-t)}}else{let t=i.unit$(i.normal(c)),e=i.dot(o,t),n=Math.abs(e);if(e>0&&n>r.radius)return!1;s&&(p=t,d=r.radius-e,(e>=0||d<2*r.radius)&&(s.BInA=!1))}p&&s&&Math.abs(d)<Math.abs(s.overlap)&&(s.overlap=d,i.copy(s.overlapN,p))}return s&&(s.A=t,s.B=r,i.mul$(i.copy(s.overlapV,s.overlapN),s.overlap)),!0}function w(t,e,r){let n=M(e,t,r);if(n&&r){let t=r.A,e=r.AInB;i.flip$(r.overlapN),i.flip$(r.overlapV),r.A=r.B,r.B=t,r.AInB=r.BInA,r.BInA=e}return n}function k(t,e,r){let n=t.calcPoints,s=e.calcPoints;for(let o=0;o<n.length;++o)if(v(t.pos,n,e.pos,s,t.normals[o],r))return!1;for(let o=0;o<s.length;++o)if(v(t.pos,n,e.pos,s,e.normals[o],r))return!1;if(r){if(0===r.overlap||u.feq0(r.overlap))return!1;r.A=t,r.B=e,i.copy(r.overlapV,r.overlapN),i.mul$(r.overlapV,r.overlap)}return!0}return{Rect:h,Area:f,Line:d,Circle:class{constructor(t){this.radius=t,this.orient=0,this.pos=i.vec()}setOrient(t){return this.orient=t,this}setPos(t,e){return i.set(this.pos,t,e),this}},Polygon:p,Manifold:m,orderVertices:t=>c(t),polyArea(t,e=!1){let r=e?this.orderVertices(t):t,n=0;for(let t,e,s,o=r.length,i=0;i<o;++i)s=(i+1)%o,t=r[i],e=r[s],n+=t[0]*e[1]-e[0]*t[1];return l(a(n)/2)},calcPolygonCenter(t,e=!1){const r=e?this.orderVertices(t):t,n=6*this.polyArea(r);let s=0,o=0;for(let t,e,n,i=0,l=r.length;i<l;++i)n=(i+1)%l,t=r[i],e=r[n],s+=(t[0]+e[0])*(t[0]*e[1]-e[0]*t[1]),o+=(t[1]+e[1])*(t[0]*e[1]-e[0]*t[1]);return i.vec(l(s/n),l(o/n))},getAABB(t,e=null){if(e||(e=t.pos),u.has(t,"radius"))return new h(e[0]-t.radius,e[1]-t.radius,2*t.radius,2*t.radius);{let r=i.translate(e,t.calcPoints),n=r[0][0],s=r[0][1],o=n,l=s;for(let t,e=1;e<r.length;++e)t=r[e],t[0]<n&&(n=t[0]),t[0]>o&&(o=t[0]),t[1]<s&&(s=t[1]),t[1]>l&&(l=t[1]);return new h(n,s,o-n,l-s)}},shiftPoints:(t,e)=>t.map(t=>i.add(t,e)),rotPoints:(t,e,r)=>t.map(t=>i.rot(t,e,r)),calcRectPoints(t,e){const r=l(t/2),n=l(e/2);return[i.vec(r,-n),i.vec(r,n),i.vec(-r,n),i.vec(-r,-n)]},line:(t,e,r,n)=>new d(t,e,r,n),rectEqRect:(t,e)=>t.width===e.width&&t.height===e.height&&t.pos[0]===e.pos[0]&&t.pos[1]===e.pos[1],rectContainsRect:(t,e)=>!(t.pos[0]>=e.pos[0]||t.pos[1]>=e.pos[1]||t.pos[0]+t.width<=e.pos[0]+e.width||t.pos[1]+t.height<=e.pos[1]+e.height),rectGetMaxX:t=>t.pos[0]+t.width,rectGetMidX:t=>t.pos[0]+l(t.width/2),rectGetMinX:t=>t.pos[0],rectGetMaxY:t=>t.pos[1]+t.height,rectGetMidY:t=>t.pos[1]+l(t.height/2),rectGetMinY:t=>t.pos[1],rectContainsPoint(t,e,r){return e>=this.rectGetMinX(t)&&e<=this.rectGetMaxX(t)&&r>=this.rectGetMinY(t)&&r<=this.rectGetMaxY(t)},rectOverlayRect:(t,e)=>!(t.pos[0]+t.width<e.pos[0]||e.pos[0]+e.width<t.pos[0]||t.pos[1]+t.height<e.pos[1]||e.pos[1]+e.height<t.pos[1]),rectUnion(t,e){const r=Math.min(t.pos[0],e.pos[0]),n=Math.min(t.pos[1],e.pos[1]);return new h(r,n,Math.max(t.pos[0]+t.width,e.pos[0]+e.width)-r,Math.max(t.pos[1]+t.height,e.pos[1]+e.height)-n)},rectIntersection(t,e){if(this.rectOverlayRect(t,e)){const r=Math.max(t.pos[0],e.pos[0]),n=Math.max(t.pos[1],e.pos[1]);return new h(r,n,Math.min(t.pos[0]+t.width,e.pos[0]+e.width)-r,Math.min(t.pos[1]+t.height,e.pos[1]+e.height)-n)}},hitTestPointCircle(t,e,r){let n=t-r.pos[0],s=e-r.pos[1];return n*n+s*s<=r.radius*r.radius},hitCircleCircle(t,e){let r=new m;if(b(t,e,r))return r},hitTestCircleCircle:(t,e)=>b(t,e,new m),hitPolygonCircle(t,e){let r=new m;if(M(t,e,r))return r},hitTestPolygonCircle:(t,e)=>M(t,e,new m),hitCirclePolygon(t,e){let r=new m;if(w(t,e,r))return r},hitTestCirclePolygon:(t,e)=>w(t,e,new m),hitPolygonPolygon(t,e){let r=new m;if(k(t,e,r))return r},hitTestPolygonPolygon:(t,e)=>k(t,e,new m),hitTestPointInPolygon(t,e,r){let n;for(let s,o,i=r.length,l=0,a=i-1;l<i;)s=r[l],o=r[a],s[1]>e!=o[1]>e&&t<(o[0]-s[0])*(e-s[1])/(o[1]-s[1])+s[0]&&(n=!n),a=l,++l;return n},hitTestPointPolygon(t,e,r){return this.hitTestPointInPolygon(t,e,i.translate(r.pos,r.calcPoints))}}}"object"==typeof module&&module.exports?module.exports=s(require("./core"),require("./math"),require("./vec2")):t["io/czlab/mcfud/geo2d"]=s}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const r=Math.floor,{u:n,is:s}=e;return{spatialGrid:(t=320,e=320)=>function(t,e){const o=new Map;return{searchAndExec(t,e){let r,n=t.getSpatial();for(let s,i,l=n.y1;l<=n.y2;++l)if(i=o.get(l))for(let o,a,u=n.x1;u<=n.x2;++u)if(s=i.get(u))for(o=s.values(),a=o.next();!a.done;){if(t!==a.value&&(r=e(t,a.value))){u=l=1/0;break}r=null,a=o.next()}return r},search(t,e=!1){let r,n,s=[],i=t.getSpatial();for(let l=i.y1;l<=i.y2;++l)if(n=o.get(l))for(let o=i.x1;o<=i.x2;++o)(r=n.get(o))&&r.forEach(r=>{(r!==t||e)&&s.push(r)});return s},engrid(n,s){if(!n)return;let o=n.getBBox(),i=n.getSpatial(),l=r(o.x1/t),a=r(o.y1/e),u=r(o.x2/t),c=r(o.y2/e);return i.x1===l&&i.x2===u&&i.y1===a&&i.y2===c||(this.degrid(n),i.x1=l,i.x2=u,i.y1=a,i.y2=c,s||this._register(n)),n},reset(){o.clear()},_register(t){let e=t.getSpatial();if(s.num(e.x1))for(let r,s,i=e.y1;i<=e.y2;++i){o.has(i)||o.set(i,new Map),s=o.get(i);for(let o=e.x1;o<=e.x2;++o)s.has(o)||s.set(o,new Map),r=s.get(o),n.assoc(r,t.getGuid(),t)}},degrid(t){if(t){let e=t.getSpatial();if(s.num(e.x1))for(let r,s,i=e.y1;i<=e.y2;++i)if(s=o.get(i))for(let o=e.x1;o<=e.x2;++o)(r=s.get(o))&&n.dissoc(r,t.getGuid())}}}}(t,e)}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/spatial"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const r=Math.floor,{u:s}=e;function o(t,e,i,l,a,u,c){let h=null,f=[],d=i<l,p=r((t+e)/2),m=r((i+l)/2);function g(t){let e,r,n,s;if(t.getBBox){let{x1:o,x2:i,y1:l,y2:a}=t.getBBox();e=o,r=l,n=i-o,s=d?a-l:l-a}else void 0!==t.x&&void 0!==t.y&&void 0!==t.width&&void 0!==t.height&&(e=t.x,r=t.y,n=t.width,s=t.height);let o=[],i=e<p,l=e+n>p,a=d?r+s>m:r<m;return(d?r<m:r+s>m)&&(i&&o.push(3),l&&o.push(0)),a&&(i&&o.push(2),l&&o.push(1)),o}function y(){s.assert(null===h),h=[o(p,e,i,m,a,u,c+1),o(p,e,m,l,a,u,c+1),o(t,p,m,l,a,u,c+1),o(t,p,i,m,a,u,c+1)]}const v={x1:t,x2:e,y1:i,y2:l};return{boundingBox:()=>v,subTrees:()=>h,dbg:t=>t(f,h,a,u,c),insert:function(t){for(let e=0;e<arguments.length;++e)t=arguments[e],h?g(t).forEach(e=>h[e].insert(t)):(f.push(t),f.length>a&&c<u&&(y(),f.forEach(t=>g(t).forEach(e=>h[e].insert(t))),f.length=0))},remove(t){h?h.forEach(e=>e.remove(t)):s.disj(f,t)},isLeaf:()=>null===h?-1:f.length,prune(){if(h){let t=0,e=0;for(let r,s=0;s<h.length;++s)r=h[s],r.prune(),n=r.isLeaf(),n>=0&&(++t,e+=n);t===h.length&&e<a&&(s.assert(0===f.length,"quadtree wanted zero items"),h.forEach(t=>t._swap(f)),h=null)}},_swap(t){f.forEach(e=>t.push(e)),f.length=0},reset(){f.length=0,h&&h.forEach(t=>t.reset()),h=null},searchAndExec(t,e,r){let n;if(h){let s=g(t);for(let o=0;o<s.length&&(n=h[s[o]].searchAndExec(t,e,r),!n);++o);}else for(let s,o=0;o<f.length&&(s=f[o],r&&s===t||!(n=e(s,t)));++o);return n},search(t,e){const r=new Map,n=[];return e&&r.set(t,null),h&&g(t).forEach(e=>{h[e].search(t).forEach(t=>{r.has(t)||(r.set(t,null),n.push(t))})}),f.forEach(t=>{r.has(t)||(r.set(t,null),n.push(t))}),r.clear(),n}}}return{quadtree(t,e=12,r=5){const{left:n,right:s,top:i,bottom:l}=t;return o(n,s,i,l,e,r,0)}}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/qtree"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const{u:r}=e;class n{constructor(t,e){this.lastBestMove=null,this.state=null,this.other=e,this.cur=t}clone(t){const e=new n;return e.state=t(this.state),e.lastBestMove=this.lastBestMove,e.other=this.other,e.cur=this.cur,e}}function s(t,e,r,n){return t.evalScore(e,r,n)*(1+.001*r)}function o(t,e,n,i,l,a){if(0===n||t.isOver(e))return{depth:n,value:s(t,e,n,i)};let u=e,c=t.getStateCopier(),h=r.shuffle(t.getNextMoves(e));for(let s,f,d=0;d<h.length;++d)if(f=h[d],t.undoMove||(r.assert(c,"Missing state copier!"),e=u.clone(c)),t.makeMove(e,f),s=o(t,e,n-1,i,{value:-a.value,move:a.move},{value:-l.value,move:l.move}),t.undoMove&&t.unmakeMove(e,f),s.value=-s.value,s.move=f,s.value>l.value&&(l={value:s.value,move:f,depth:s.depth}),l.value>=a.value)return a;return JSON.parse(JSON.stringify(l))}function i(t,e,n,o,l,a){if(0===n||t.isOver(e))return[s(t,e,n,o),null];let u=r.shuffle(t.getNextMoves(e)),c=t.getStateCopier(),h=e,f=-1/0,d=u[0];n===o&&(h.lastBestMove=d);for(let s,p,m=0;m<u.length&&(t.undoMove||(r.assert(c,"Missing state copier!"),e=h.clone(c)),p=u[m],t.makeMove(e,p),s=-i(t,e,n-1,o,-a,-l)[0],t.undoMove&&t.unmakeMove(e,p),f<s&&(f=s,d=p),!(l<s&&(l=s,n===o&&(h.lastBestMove=p),l>=a)));++m);return[f,h.lastBestMove]}const l={algo:"negamax",GFrame:n,GameBoard:class{constructor(){}getStateCopier(){}getFirstMove(t){}getNextMoves(t){}evalScore(t){}isStalemate(t){}isOver(t){}unmakeMove(t,e){if(!this.undoMove)throw Error("Need Implementation");this.switchPlayer(t),this.undoMove(t,e)}makeMove(t,e){if(!this.doMove)throw Error("Need Implementation!");this.doMove(t,e),this.switchPlayer(t)}switchPlayer(t){let e=t.cur;t.cur=t.other,t.other=e}getOtherPlayer(t){return t===this.actors[1]?this.actors[2]:t===this.actors[2]?this.actors[1]:void 0}getPlayer(){return this.actors[0]}takeGFrame(){}run(t,e){this.getAlgoActor=()=>e,this.syncState(t,e);let n=this.getFirstMove();return r.nichts(n)&&(n=l.evalNegaMax(this)),n}},XXevalNegaMax(t){const e=t.takeGFrame(),n=t.depth;let s,o;return[s,o]=i(t,e,n,n,-1/0,1/0),r.nichts(o)&&console.log(`evalNegaMax: score=${s}, pos= ${o}, lastBestMove=${o}`),o},evalNegaMax(t){const e=t.takeGFrame(),n=t.depth;let{value:s,move:i}=o(t,e,n,n,{value:-1/0},{value:1/0});return r.nichts(i)&&console.log(`evalNegaMax: score= ${s}, pos= ${i}`),i}};return l}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/negamax"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const{u:r}=e;class n{constructor(t,e){this.cur=t,this.state=null,this.other=e}clone(t){const e=new n;return e.state=t(this.state),e.other=this.other,e.cur=this.cur,e}}function s(t,e,r,n){return t.evalScore(e,r,n)}function o(t,e,n,i,l,a,u){if(0===n||t.isOver(e))return[s(t,e,n,i),null];let c=e,h=t.getStateCopier(),f=r.shuffle(t.getNextMoves(e));if(u){let s,d,p=null,m=-1/0;for(let g=0;g<f.length&&(t.undoMove||(r.assert(h,"Missing state copier!"),e=c.clone(h)),d=f[g],t.makeMove(e,d),s=o(t,e,n-1,i,l,a,!u)[0],t.undoMove&&t.unmakeMove(e,d),l=Math.max(s,l),s>m&&(m=s,p=d),!(a<=l));++g);return[m,p]}{let s,d,p=null,m=1/0;for(let g=0;g<f.length&&(t.undoMove||(r.assert(h,"Missing state copier!"),e=c.clone(h)),d=f[g],t.makeMove(e,d),s=o(t,e,n-1,i,l,a,!u)[0],t.undoMove&&t.unmakeMove(e,d),a=Math.min(s,a),s<m&&(m=s,p=d),!(a<=l));++g);return[m,p]}}const i={algo:"minimax",GFrame:n,GameBoard:class{constructor(){this.aiActor=null}getStateCopier(){}getFirstMove(t){}getNextMoves(t){}evalScore(t,e,r){}isStalemate(t){}isOver(t,e){}unmakeMove(t,e){if(!this.undoMove)throw Error("Need Implementation");this.switchPlayer(t),this.undoMove(t,e)}makeMove(t,e){if(!this.doMove)throw Error("Need Implementation!");this.doMove(t,e),this.switchPlayer(t)}takeGFrame(){}switchPlayer(t){let e=t.cur;t.cur=t.other,t.other=e}getOtherPlayer(t){return t===this.actors[1]?this.actors[2]:t===this.actors[2]?this.actors[1]:void 0}getPlayer(){return this.actors[0]}run(t,e){this.getAlgoActor=()=>e,this.syncState(t,e);let n=this.getFirstMove();return r.nichts(n)&&(n=i.evalMiniMax(this)),n}},evalMiniMax(t){const e=t.takeGFrame(),n=t.depth;let s,i;return[s,i]=o(t,e,n,n,-1/0,1/0,!0),r.nichts(i)&&console.log(`evalMiniMax: score=${s}, pos= ${i}`),i}};return i}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/minimax"]=e}(this),function(t){"use strict";function e(e,r){if(e||(e=t["io/czlab/mcfud/core"]()),!r)throw"Fatal: No Colors!";const{is:n,u:s}=e;function o(t,e){let r="";for(;t>0;)r+=e,--t;return r}function i(t,e){let r=c;return e&&(n.str(t)?r="any"===t||t===e?h:c:t instanceof e&&(r=h)),r}function l(t,e,r){return new Promise((n,s)=>{let o;try{o=r.call(t),o instanceof Promise?o.then((function(t){n(`${t?h:c}: ${e}`)})):(o=o?709394===o?u:h:c,n(`${o}: ${e}`))}catch(t){o=c,n(`${o}: ${e}`)}})}function a(t,e,r,n){return new Promise((s,o)=>{let l;try{l=r.call(t),l=709394===l?h:i(n,null)}catch(t){l=i(n,t)}s(`${l}: ${e}`)})}const[u,c,h]=["Skippd","Failed","Passed"];return{prn(t){const e=t.passed.length,n=t.total,i=e/n*100;console.log(r.white(o(78,"+"))),console.log(r.white.bold(t.title)),console.log(r.white(t.date)),console.log(r.white(o(78,"+"))),t.passed.length>0&&console.log(r.green(t.passed.join("\n"))),t.skippd.length>0&&console.log(r.grey(t.skippd.join("\n"))),t.failed.length>0&&console.log(r.magenta(t.failed.join("\n"))),console.log(r.white(o(78,"="))),console.log(r.yellow(["Passed: ",e,"/",n," [",0|i,"%]"].join(""))),console.log(r.magenta("Failed: "+(n-e))),console.log(r.white(["cpu-time: ",s.prettyMillis(t.duration)].join(""))),console.log(r.white(o(78,"=")))},deftest(t){let[e,r,n,s]=[null,null,null,null];const o={ensure:(t,e)=>(n.push([1,t,e]),o),eerror:(t,e)=>(n.push([911,t,e]),o),begin:t=>(s={},n=[],e=t,o),end(o){r=o;let i=function(){return new Promise((t,o)=>{e&&e(s);let i,u=[];for(let t,e,r=0;r<n.length;++r){switch(e=n[r],e[0]){case 1:t=l(s,e[1],e[2]);break;case 911:t=a(s,e[1],e[2],"any")}i=i?i.then((function(e){return u.push(e),t})):t}i&&i.then((function(e){u.push(e),n.length=0,r&&r(s),t(u)}))})};return(i.title=t)&&i}};return o},_run:t=>new Promise((e,r)=>{t().then((function(t){e(t)}))}),runtest(t,e){const r=Date.now();return this._run(t).then((function(n){const s=Date.now(),o={title:e||t.title,date:(new Date).toString(),total:n.length,duration:s-r,passed:n.filter(t=>"P"===t[0]),skippd:n.filter(t=>"S"===t[0]),failed:n.filter(t=>"F"===t[0])};return new Promise(t=>{t(o)})}))}}}"object"==typeof module&&module.exports?module.exports=e(require("./core"),require("colors/safe")):t["io/czlab/mcfud/test"]=e}(this);