!function(e){"use strict";const t=["jpg","png","jpeg","gif"],i=["ttf","otf","ttc","woff"],s=["mp3","wav","ogg"],n=1/15;function r(r,o,a,h){const{EventBus:l,dom:c,is:d,u:u}=e["io/czlab/mcfud/core"](),p=e["io/czlab/mcfud/vec2"](),g=l(),m=Math.floor,f=console;let x=!1;class y extends PIXI.Container{constructor(){super(),this.m5={stage:!0}}onResize(e,t){this.children.forEach((i=>{i instanceof e.Scenes.SceneWrapper&&(i=i.children[0]),i.onCanvasResize(t)})),e.Input.resize()}}function w(){return e.innerWidth}function T(){return e.innerHeight}function v(e){const t=new F.Scenes.Scene("loader",{setup(){e.init.call(this)}},{});return F.stage.addChild(t),t.runOnce(),t}function b(e){const[t,i]=[e.offsetHeight,e.offsetWidth],[s,n]=[T(),w()],r=Math.min(n/i,s/t),[o,a]=[t*r,i*r];if(c.css(e,{transformOrigin:"0 0",transform:`scale(${r})`}),i>t?a<n:!(o>s)){const t=m((n-a)/2);c.css(e,{marginTop:"0px",marginBottom:"0px",marginLeft:`${t}px`,marginRight:`${t}px`})}else{const t=m((s-o)/2);c.css(e,{marginLeft:"0px",marginRight:"0px",marginTop:`${t}px`,marginBottom:`${t}px`})}return c.css(e,{display:"block",paddingLeft:"0px",paddingRight:"0px",paddingTop:"0px",paddingBottom:"0px"}),c.css(document.body,"backgroundColor",F.scaledBgColor),r}function S(e,t,i,n){const{Sound:r}=e;let o,h=0;function l(){a.forEach((e=>c.css(e,"display","none"))),t&&e.delBgTask(t),u.delay(0,(()=>{e.Scenes.removeScene(i),n||e.u.start(e)}))}function d(){0==--h&&l()}n||u.doseq(e.assets,((e,t)=>{o=u.fileExt(t),u.has(s,o)&&(h+=1,r.decodeData(e.name,e.url,e.xhr.response,d))})),0===h&&l()}function I(e,t){let n=u.map(e.u.assetFiles,(t=>e.assetPath(t))),r=u.findFiles(n,i);const{PXLR:h,PXLoader:l}=e;let g,x,y,w;if(r.forEach((e=>{w=c.newElm("style"),y=c.newElm("span"),g=e.split("/").pop().split(".")[0],x=`@font-face {font-family: '${g}'; src: url('${e}');}`,o.push(g),c.conj(w,c.newTxt(x)),c.conj(document.head,w),y.innerHTML="?",c.css(y,"fontFamily",g),c.conj(document.body,y),c.css(y,{display:"block",opacity:"0"}),a.push(y)})),s.forEach((e=>{h.setExtensionLoadType(e,h.LOAD_TYPE.XHR),h.setExtensionXhrType(e,h.XHR_RESPONSE_TYPE.BUFFER)})),l.reset(),n.length>0){let i=e.u.load;if(t?i?(i=null,f.log("FatalError: can't proceed.")):i=function(e){const t=e.getScaleFactor(),i=m(e.height/2),s=m(e.width/2),n=m(e.width/4),{Sprites:r}=e,o=2*n,a=24*t,h=i-a/2;return{init(){this.fg=r.rectangle(s,a,16747008),this.bg=r.rectangle(s,a,4210752),this.perc=r.text("0%",{fontSize:m(a/2),fill:"black",fontFamily:"sans-serif"}),p.set(this.bg,s-n,h),p.set(this.fg,s-n,h),p.set(this.perc,s-n+10,m(i-this.perc.height/2)),this.insert(this.bg),this.insert(this.fg),this.insert(this.perc)},update(e,t){this.fg.width=o*(t/100),this.perc.text=`${Math.round(t)}%`,f.log(`file= ${e}, progr= ${t}`)}}}(e):i||(i=function(e){const{Sprites:t}=e;return{init(){let i=t.sprite("boot/ZotohLab_x1240.png"),s=t.sprite("boot/preloader_bar.png"),[n,r]=e.scaleXY([i.width,i.height],[e.width,e.height]),o=e.getScaleFactor(),a=n>r?r:n;a*=.2,p.set(s.scale,a,a),p.set(i.scale,a,a),t.pinCenter(this,i),t.pinBottom(i,s,4*o),s.visible=!1,this.g.pbar=s,this.g.pbar_width=s.width,this.insert(i),this.insert(s)},update(e,t){this.g.pbar.visible||(this.g.pbar.visible=!0),this.g.pbar.width=this.g.pbar_width*(t/100)}}}(e)),i){let t=0,s=[],r=[],o=v(i);l.add(n),l.onError.add(((e,i,s)=>{++t,f.log(`${e}`)})),l.onProgress.add(((e,t)=>{s.unshift(t.url),r.unshift(e.progress)})),l.load((()=>{0===t&&f.log("asset loaded!")})),e.addBgTask({update(){let n=s.pop(),a=r.pop();n&&d.num(a)&&i.update.call(o,n,a),(u.feq(a,100)||a>99.95)&&S(e,this,o,t>0)}})}}else S(e);return e.start()}u.patch(r,{assetFiles:[],logos:[],fps:60});const _={width:0,height:0},E={width:1,height:1};function P(e){let t={outline:"none"};!1!==e.rendering&&(t["image-rendering"]=e.rendering||"pixelated"),c.css(F.canvas,t),c.attrs(F.canvas,"tabindex","0")}function X(t){f.log(`installing module ${t}...`),e[`io/czlab/mojoh5/${t}`](F)}const C=u.jsMap();function O(e){h.forEach((t=>t.update&&t.update(e))),x||F.stageCS((t=>t.update&&t.update(e))),F.ctx.render(F.stage)}function M(t){return e.requestAnimationFrame(t)}const F={EVERY:1,SOME:2,CENTER:3,TOP:4,LEFT:5,RIGHT:6,BOTTOM:7,UP:8,DOWN:9,TOP_LEFT:10,TOP_RIGHT:11,BOTTOM_LEFT:12,BOTTOM_RIGHT:13,NONE:100,PI_90:Math.PI/2,PI_180:Math.PI,PI_270:1.5*Math.PI,PI_360:2*Math.PI,v2:p,ute:u,is:d,dom:c,u:r,Game:{},CON:console,noop:()=>{},PXContainer:PIXI.Container,PXGraphics:PIXI.Graphics,PXTexture:PIXI.Texture,PXFilters:PIXI.filters,PXLR:PIXI.LoaderResource,PXLoader:PIXI.Loader.shared,PXObservablePoint:PIXI.ObservablePoint,on:(...e)=>g.sub(...e),emit:(...e)=>g.pub(...e),off:(...e)=>g.unsub(...e),sideRight:e=>e===F.RIGHT||e===F.TOP_RIGHT||e===F.BOTTOM_RIGHT,sideLeft:e=>e===F.LEFT||e===F.TOP_LEFT||e===F.BOTTOM_LEFT,sideTop:e=>e===F.TOP||e===F.TOP_LEFT||e===F.TOP_RIGHT,sideBottom:e=>e===F.BOTTOM||e===F.BOTTOM_LEFT||e===F.BOTTOM_RIGHT,overlap:(e,t)=>!(e.x2<t.x1||t.x2<e.x1||e.y2<t.y1||t.y2<e.y1),hasClass:(e,t)=>new RegExp(`(\\s|^)${t}(\\s|$)`).test(e.className),addClass:(e,t)=>(u.hasClass(e,t)||(e.className+=`${t}`),e),removeClass:(e,t)=>(u.hasClass(e,t)&&(e.className=e.className.replace(new RegExp(`(\\s|^)${t}(\\s|$)`),"")),e),wrapv:(e,t,i)=>e<t?i:e>i?t:e,defMixin(e,t){if(u.has(C,e))throw`MixinError: "${e}" already defined.`;u.assert(d.fun(t),"mixin must be a function"),u.assoc(C,e,t)},addMixin:(e,t,...i)=>function(e,t,i,...s){return u.assert(!u.has(e,t),`Fatal: mixin ${t} unavailable.`),e[t]=i(e,...s),e}(e,t,C.get(t),...i),get assets(){return PIXI.Loader.shared.resources},get designSize(){return this.u.arena},get width(){return this.canvas.width},get height(){return this.canvas.height},stageCS(e){F.stage.children.forEach((t=>{t instanceof F.Scenes.SceneWrapper&&(t=t.children[0]),e(t)}))},portrait:()=>F.height>F.width,screenCenter:()=>u.v2(m(F.width/2),m(F.height/2)),scaleXY:(e,t)=>[t[0]/e[0],t[1]/e[1]],makeAnchor(e,t){return new F.PXObservablePoint(F.noop,this,e,t)},mockStage(e=0,t=0,i,s){let n=d.obj(e)?e:{x:e,y:t,width:u.nor(i,F.width),height:u.nor(s,F.height)};return n.getGlobalPosition=()=>({x:this.x,y:this.y}),n.anchor=F.makeAnchor(0,0),n.m5={stage:!0},n},getIndex(e,t,i,s,n){if(e<0||t<0)throw`IndexError: ${e},${t}, wanted +ve values`;return m(e/i)+m(t/s)*n},tcached(e){return u.inst(this.PXTexture,e)?e:d.str(e)?PIXI.utils.TextureCache[e]||PIXI.utils.TextureCache[this.assetPath(e)]:void 0},splitXY:(e,t)=>[e%t,m(e/t)],rect:(e,t,i,s)=>new F.PXRectangle(e,t,i,s),scaleSZ:(e,t)=>({width:t.width/e.width,height:t.height/e.height}),id(e){return this.image(e)},image(e){return this.tcached(e)||u.assert(!1,`${e} not loaded.`)},xml(e){return(this.assets[e]||u.assert(!1,`${e} not loaded.`)).data},json(e){return(this.assets[e]||u.assert(!1,`${e} not loaded.`)).data},assetPath(e){if(e.includes("/"))return e;let n="data",r=u.fileExt(e);return u.has(t,r)?n="images":"fnt"==r||u.has(i,r)?n="fonts":u.has(s,r)&&(n="audio"),`${n}/${e}`},contentScaleFactor(){return _.height=F.height,_.width=F.width,"max"!==r.scaleToWindow?E:this.scaleSZ(this.designSize,_)},getScaleFactor(){if("max"!=r.scaleToWindow)return 1;{_.height=F.height,_.width=F.width;let e=this.scaleSZ(this.designSize,_);return"x"==r.scaleFit?e.width:"y"==r.scaleFit?e.height:Math.min(e.width,e.height)}},resource(e,t){return(e?this.assets[e]||this.assets[this.assetPath(e)]:null)||(t?u.assert(!1,`no such resource ${e}.`):void 0)},calcFPS:e=>e>0?m(1/e):0,degToRad:e=>e*(Math.PI/180),radToDeg:e=>e*(180/Math.PI),delBgTask(e){e&&u.disj(h,e)},addBgTask(e){h.push(e)},resume(){x=!1},pause(){x=!0},start(){let e=F.frame,t=u.now(),i=0,s=function(){let r=u.now(),o=(r-t)/1e3;for(o>n&&(o=n),i+=o;i>=e;i-=e)O(o);t=r,M(s)};return M(s)}};return function(t){let i=t.stage=new y,s=r.arena,n=!1;return u.assert(s,"design resolution req'd."),"max"==r.scaleToWindow&&(n=!0,s={width:w(),height:T()},u.nichts(r.arena.width)&&u.nichts(r.arena.height)&&(n=!1,r.arena=s,r.scaleToWindow="win")),r.logos||(r.logos=new Array),t.touchDevice=!!("ontouchstart"in document),t.ctx=PIXI.autoDetectRenderer(s),t.ctx.bgColor=16777215,t.canvas=t.ctx.view,t.canvas.id="mojo",t.maxed=n,t.scale=1,t.frame=1/r.fps,t.scaledBgColor="#323232",u.seq("Sprites,Input,Scenes").forEach(X),u.seq("Sound,FX,2d,Tiles,Touch").forEach(X),h.push(t.FX,t.Input),c.conj(document.body,t.canvas),function(){const e=c.newElm("style");c.conj(e,c.newTxt("body, * {padding: 0; margin: 0}")),c.conj(document.head,e)}(),P(r),u.has(r,"border")&&c.css(t.canvas,"border",r.border),u.has(r,"bgColor")&&(t.ctx.backgroundColor=t.Sprites.color(r.bgColor)),!0===r.scaleToWindow&&(t.scale=b(t.canvas)),t.mouse=t.Input.pointer(),!0===r.resize&&(u.addEvent("resize",e,u.debounce((()=>{const[e,i]=[t.width,t.height];t.ctx.resize(w(),T()),t.emit(["canvas.resize"],[e,i])}),r.debounceRate||150)),t.on(["canvas.resize"],(e=>i.onResize(t,e)))),t.canvas.focus(),function(e){const{PXLoader:t}=e;e.u.load||(e.u.logos=["boot/preloader_bar.png","boot/ZotohLab_x1240.png"]);let i=e.u.logos,s=0;return i=i.map((t=>e.assetPath(t))),0===i.length?I(e):(t.reset(),t.add(i),t.onError.add(((e,t,i)=>{++s,f.log(`${e}`)})),t.load((()=>{u.delay(0,(()=>I(e,s>0))),0===s&&f.log("logo files loaded!")}))),e}(t)}(F)}if("object"==typeof module&&module.exports)throw"Panic: browser only!";e.MojoH5=function(e){return r(e,[],[],[])}}(this),function(e){"use strict";const t={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",brown:"#A52A2A",crimson:"#DC143C",cyan:"#00FFFF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",grey:"#808080",lavender:"#E6E6FA",lime:"#00FF00",magenta:"#FF00FF",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",turquoise:"#40E0D0",wheat:"#F5DEB3",white:"#FFFFFF",yellow:"#FFFF00"};function i(i){const s=e["io/czlab/mcfud/geo2d"](),n=e["io/czlab/mcfud/vec2"](),{ute:r,is:o,dom:a}=i,h=(Math.abs,Math.floor);function l(e,t,s,n){0===(n=n||e.getLocalBounds(null,!0)).width&&(n.width=1),0===n.height&&(n.height=1);let r=PIXI.Matrix.TEMP_MATRIX,o=PIXI.RenderTexture.create({width:0|n.width,height:0|n.height,scaleMode:t,resolution:s});return r.tx=-n.x,r.ty=-n.y,i.ctx.render(e,o,!1,r,!!e.parent),o}var c,d,u;function p(e,t){let s,n;var a;return r.inst(i.PXTexture,e)?n=e:o.vec(e)?(a=e,r.assert(o.vec(a),"bad arg to animFromVec"),o.str(a[0])&&(a=i.tcached(a[0])?a.map((e=>i.tcached(e))):a.map((e=>i.assetPath(e)))),s=r.inst(i.PXTexture,a[0])?new i.PXASprite(a):i.PXASprite.fromImages(a)):o.str(e)&&(n=i.tcached(e)||function(e){return i.PXTexture.from(i.assetPath(e))}(e)),n&&(s=t(n)),r.assert(s,`SpriteError: ${e} not found`)&&s}function g(e,t,i,s,n,r){const o=[];let a=t,h=e;for(let t,l,c,d=0;d<i;++d){c=[];for(let e=0;e<s;++e)l=a+r,t=h+n,c.push({x1:h,x2:t,y1:a,y2:l}),h=t;a=l,h=e,o.push(c)}return o}function m(e,t,s=null){let n,r=null;return t.m5.stage?n={x1:0,y1:0,x2:i.width,y2:i.height}:(r=t.parent,n=e.getBBox(t)),s&&r===s&&(n.x1+=s.x,n.x2+=s.x,n.y1+=s.y,n.y2+=s.y),[n,h((n.x2-n.x1)/2),h((n.y2-n.y1)/2),h((n.x1+n.x2)/2),h((n.y1+n.y2)/2)]}function f(e,t,i){if(t.m5.static){let t=n.mul(i.overlapN,2*n.dot(e.m5.vel,i.overlapN));n.sub$(e.m5.vel,t)}else{let s=n.mul$(n.sub(t.m5.vel,e.m5.vel),i.overlapN),r=-2*(s[0]+s[1])/(e.m5.invMass+t.m5.invMass);n.sub$(e.m5.vel,n.mul$(n.div(i.overlapN,e.m5.mass),r)),n.add$(t.m5.vel,n.mul$(n.div(i.overlapN,t.m5.mass),r))}}function x(e,t,i){const n=e.toShape(t),r=e.toShape(i);let o;return o=t.m5.circle?i.m5.circle?s.hitCircleCircle(n,r):s.hitCirclePolygon(n,r):i.m5.circle?s.hitPolygonCircle(n,r):s.hitPolygonPolygon(n,r),o&&(o.A=t,o.B=i),o}c=new PIXI.Container,(d=new PIXI.Graphics).clear(),d.beginFill(0),d.drawCircle(0,0,4),d.endFill(),u=new PIXI.Sprite(l(d)),["m5","tiled","collideXY","getGuid","getBBox","getSpatial"].forEach((e=>{[[c,"Container"],[d,"Graphics"],[u,"Sprite"]].forEach((t=>{r.assertNot(r.has(t[0],e),`PIXI ${t[1]} has ${e} property!`)}))})),r.inject(i,{PXMatrix:PIXI.Matrix.TEMP_MATRIX,PXRTexture:PIXI.RenderTexture,PXRect:PIXI.Rectangle,PXBText:PIXI.BitmapText,PXSprite:PIXI.Sprite,PXGraphics:PIXI.Graphics,PXText:PIXI.Text,PXTSprite:PIXI.TilingSprite,PXASprite:PIXI.AnimatedSprite,PXPContainer:PIXI.ParticleContainer});n.vec();const y={assertCenter:e=>r.assert(e.anchor.x>.3&&e.anchor.x<.7&&e.anchor.y>.3&&e.anchor.y<.7,"not center'ed"),empty:e=>0===e.children.length,setXY:(e,t,i)=>(o.num(t)&&(e.x=t),o.num(i)&&(e.y=i),e),sizeXY:(e,t,i)=>(o.num(i)&&(e.height=i),o.num(t)&&(e.width=t),e),scaleXY:(e,t,i)=>(o.num(t)&&(e.scale.x=t),o.num(i)&&(e.scale.y=i),e),anchorXY:(e,t,i)=>(o.num(t)&&(e.anchor.x=t),o.num(i)&&(e.anchor.y=i),e),velXY:(e,t,i)=>(o.num(t)&&(e.m5.vel[0]=t),o.num(i)&&(e.m5.vel[1]=i),e),isVX:e=>!r.feq0(e.m5.vel[0]),isVY:e=>!r.feq0(e.m5.vel[1]),accXY:(e,t,i)=>(o.num(t)&&(e.m5.acc[0]=t),o.num(i)&&(e.m5.acc[1]=i),e),gravityXY:(e,t,i)=>(o.num(t)&&(e.m5.gravity[0]=t),o.num(i)&&(e.m5.gravity[1]=i),e),frictionXY:(e,t,i)=>(o.num(t)&&(e.m5.friction[0]=t),o.num(i)&&(e.m5.friction[1]=i),e),halfSize:e=>({width:h(e.width/2),height:h(e.height/2)}),centerAnchor:e=>(e.anchor.set(.5,.5),e),topLeftAnchor:e=>(e.anchor.set(0,0),e),topLeftOffsetXY(e){return this.isTopLeft(e)?n.vec():n.vec(-h(e.width*e.anchor.x),-h(e.height*e.anchor.y))},centerOffsetXY(e){return this.isCenter(e)?n.vec():n.vec(h(e.width/2)-h(e.anchor.x*e.width),h(e.height/2)-h(e.anchor.y*e.height))},extend(e){if(!e.m5){let t=this;e.g={},e.m5={uuid:r.nextId(),circle:!1,stage:!1,drag:!1,dead:!1,angVel:0,friction:n.vec(1,1),gravity:n.vec(),vel:n.vec(),acc:n.vec(),static:!1,sensor:!1,sgrid:{},mass:1,type:0,cmask:0,speed:0,heading:i.RIGHT,get invMass(){return r.feq0(e.m5.mass)?0:1/e.m5.mass}},e.m5.resize=function(i,s,n,r){t.resize(e,i,s,n,r)},e.m5.getImageOffsets=function(){return{x1:0,x2:0,y1:0,y2:0}},e.m5.getContactPoints=function(){return function(e,t,i){let s=[n.vec(t,i),n.vec(t,0),n.vec(0,0),n.vec(0,i)];return s.forEach((s=>{s[0]-=h(t*e.x),s[1]-=h(i*e.y)})),s}(e.anchor,e.width,e.height)},e.getBBox=function(){return t.boundingBox(e)},e.getGuid=function(){return e.m5.uuid},e.getSpatial=function(){return e.m5.sgrid}}return e},toPolygon:e=>new s.Polygon(e.x,e.y).setOrient(e.rotation).set(e.m5.getContactPoints()),toCircle(e){return this.assertCenter(e)&&new s.Circle(h(e.width/2)).setPos(e.x,e.y).setOrient(e.rotation)},toShape(e){return e.m5.circle?this.toCircle(e):this.toPolygon(e)},gposXY(e){const t=e.getGlobalPosition();return n.vec(t.x,t.y)},isTopLeft:e=>e.anchor.x<.3&&e.anchor.y<.3,isCenter:e=>e.anchor.x>.3&&e.anchor.x<.7&&e.anchor.y>.3&&e.anchor.y<.7,centerXY(e){let t;if(this.isCenter(e))t=n.vec(e.x,e.y);else{let[i,s]=this.centerOffsetXY(e);t=n.vec(e.x+i,e.y+s)}return t},setScaleModeNearest:(e,t)=>(e.texture.baseTexture.scaleMode=t?PIXI.SCALE_MODES.NEAREST:PIXI.SCALE_MODES.LINEAR,e),angle(e,t){return n.angle(this.centerXY(e),this.centerXY(t))},move:(e,t)=>(t=r.nor(t,1),n.add$(e,n.mul(e.m5.vel,t))),leftSide(e){let t=e.x,i=e.width,s=e.anchor.x;return s>.7?t-=i:s>0&&(t-=h(i/2)),t},rightSide(e){return this.leftSide(e)+e.width},topSide(e){let t=e.y,i=e.height,s=e.anchor.y;return s>.7?t-=i:s>0&&(t-=h(i/2)),t},bottomSide(e){return this.topSide(e)+e.height},getBBox(e){let t={x1:this.leftSide(e),x2:this.rightSide(e),y1:this.topSide(e),y2:this.bottomSide(e)};return r.assert(t.y1<=t.y2,"bbox bad y values")&&t},bbox4:(e,t,i,s)=>r.assert(i<=s,"bad bbox")&&{x1:e,x2:t,y1:i,y2:s},bboxCenter(e){if(o.num(e.x1))return n.vec(h((e.x1+e.x2)/2),h((e.y1+e.y2)/2))},bboxSize:e=>n.vec(e.x2-e.x1,e.y2-e.y1),pointInBBox:(e,t,i)=>e>i.x1&&e<i.x2&&t>i.y1&&t<i.y2,boundingBox(e){let t,i,s,n,o,a,l=[],c=[],d=h(e.width/2),u=h(e.height/2),p=Math.tanh(u/d),g=Math.sqrt(d*d+u*u);return r.feq0(e.rotation)||r.assert(this.isCenter(e),"wanted center anchor"),i=2*Math.PI-p+e.rotation,c.push(g*Math.sin(i)),l.push(g*Math.cos(i)),i=p+e.rotation,c.push(g*Math.sin(i)),l.push(g*Math.cos(i)),i=Math.PI-p+e.rotation,c.push(g*Math.sin(i)),l.push(g*Math.cos(i)),i=Math.PI+p+e.rotation,c.push(g*Math.sin(i)),l.push(g*Math.cos(i)),t=this.centerXY(e),c.sort(((e,t)=>e-t)),l.sort(((e,t)=>e-t)),s=h(l[0]+t[0]),n=h(l[3]+t[0]),o=h(c[0]+t[1]),a=h(c[3]+t[1]),{x1:s,x2:n,y1:o,y2:a}},hitTestPoint(e,t,i){let n=this.toShape(i);return i.m5.circle?s.hitTestPointCircle(e,t,n):s.hitTestPointPolygon(e,t,n)},lineOfSight(e,t,i,s=32){let r=this.centerXY(e),o=this.centerXY(t),a=n.vecAB(r,o),l=n.vec(),c=!1,d=n.len(a),u=n.div(a,d);for(let e,t=h(d/s),o=1;o<=t&&!c;++o)e=s*o,n.copy(l,n.add(r,n.mul(u,e))),c=i.some((e=>this.hitTestPoint(l[0],l[1],e)));return!c},distance(e,t){return n.dist(this.centerXY(e),this.centerXY(t))},scaleContent(...e){1===e.length&&o.vec(e[0])&&(e=e[0]);let t=i.getScaleFactor();e.forEach((e=>{e.scale.x=t,e.scale.y=t}))},scaleToCanvas:e=>(e.height=i.height,e.width=i.width,e),uuid:(e,t)=>(e.m5.uuid=t,e),pset:(e,t,i)=>(e.g[t]=i,e),pget:(e,t)=>e.g[t],container(e){let t=new i.PXContainer;return t=this.extend(t),e&&e(t),t},sprite(e,t=!1,s=0,n=0){let a=p(e,(e=>new i.PXSprite(e)));return t&&this.centerAnchor(a),a=this.setXY(this.extend(a),s,n),r.inst(i.PXASprite,a)?function(e){let t,i=[0,0,0,0];function s(){return t=r.clear(t),e}function n(){i[2]<i[3]+1?(e.gotoAndStop(e.currentFrame+1),i[2]+=1):e.loop&&(e.gotoAndStop(i[0]),i[2]=1)}return r.inject(e.m5,{stopFrames(){s()&&e.gotoAndStop(e.currentFrame)},showFrame(t){s()&&e.gotoAndStop(t)},playFrames(a){s(),i[0]=0,i[1]=e.totalFrames-1,o.vec(a)&&a.length>1&&(i[0]=a[0],i[1]=a[1]),i[3]=i[1]-i[0],e.gotoAndStop(i[0]),i[2]=1,t=r.timer(n,1e3/12,!0)}}),e}(a):a},tilingSprite(e,t=!1,s=0,n=0){let r=p(e,(e=>new i.PXTSprite(e)));return t&&this.centerAnchor(r),this.setXY(this.extend(r),s,n)},animation(e,t,s,r=0){let o=i.tcached(e);if(!o)throw`SpriteError: ${e} not loaded.`;let a=h(o.width/t),l=[],c=a*h(o.height/s);for(let e,i,o=0;o<c;++o)e=o%a*t,i=h(o/a)*s,r>0&&(e+=r+r*o%a,i+=r+r*h(o/a)),l.push(n.vec(e,i));return this.sprite(((e,t,s,n)=>n.map((n=>new i.PXTexture(e.baseTexture,new i.PXRect(n[0],n[1],t,s)))))(o,t,s,l))},frame(e,t,s,n,r){const o=i.tcached(e);return this.sprite(new i.PXTexture(o.baseTexture,new i.PXRect(n,r,t,s)))},frameSelect(e,t,s,n){const r=i.tcached(e);return n.map((e=>new i.PXTexture(r.baseTexture,new i.PXRect(e[0],e[1],t,s))))},frames(e,t,s,n=0,r=0,o=0,a=0){let l=i.tcached(e),c=t+n,d=s+r,u=[],p=h(l.height/d),g=h((l.width+n)/c);for(let e,n=0;n<p;++n){e=a+s*n;for(let n,r=0;r<g;++r)n=o+t*r,u.push(new i.PXTexture(l.baseTexture,new i.PXRect(n,e,t,s)))}return u},frameImages:(...e)=>(1===e.length&&o.vec(e[0])&&(e=e[0]),e.map((e=>i.tcached(e)))),spriteFrom(...e){return this.sprite(this.frameImages(e))},text(e,t,s=0,n=0){let r=new i.PXText(e,t);return this.setXY(this.extend(r),s,n)},bitmapText(e,t,s=0,n=0){let r=new i.PXBText(e,t);return this.setXY(this.extend(r),s,n)},rectangle(e,t,s=16724736,n=13260,r=0,o=0,a=0){let h=this.graphics(),l=this.color(n);!1!==s&&h.beginFill(this.color(s)),r>0&&h.lineStyle(r,l,1),h.drawRect(0,0,e,t),!1!==s&&h.endFill();let c=this.genTexture(h),d=new i.PXSprite(c);return this.setXY(this.extend(d),o,a)},drawBody(e,...t){let s=this.graphics();return e.apply(this,[s].concat(t)),this.extend(new i.PXSprite(this.genTexture(s)))},circle(e,t=16724736,s=13260,n=0,r=0,o=0){let a,h=this.graphics(),l=this.color(s);return!1!==t&&h.beginFill(this.color(t)),n>0&&h.lineStyle(n,l,1),h.drawCircle(0,0,e),!1!==t&&h.endFill(),a=new i.PXSprite(this.genTexture(h)),a=this.setXY(this.extend(a),r,o),(a.m5.circle=!0)&&this.centerAnchor(a)},line(e,t,i,s){let o,a=this.graphics(),h=n.clone(i),l=n.clone(s),c=this.color(e);function d(){a.clear(),a.lineStyle(t,c,1),a.moveTo(h[0],h[1]),a.lineTo(l[0],l[1])}return d(),o=this.extend(a),o.m5.ptA=function(e,t){return void 0!==e&&(h[0]=e,h[1]=r.nor(t,e),d()),h},o.m5.ptB=function(e,t){return void 0!==e&&(l[0]=e,l[1]=r.nor(t,e),d()),l},o},isMoving:e=>!r.feq0(e.m5.vel[0])||!r.feq0(e.m5.vel[1]),makeCells(e,t,i,s,n,r){let o=h((i-e)/n);return g(e,t,h((s-e)/r),o,n,r)},gridBox(e=.9,t=.9,s=null){let n=r.nor(s,i),o=h(n.height*t),a=h(n.width*e),l=h((n.width-a)/2),c=h((n.height-o)/2);return{x1:l,y1:c,x2:l+a,y2:c+o}},gridSQ(e,t=.6,s=null){let n=t*(i.height<i.width?i.height:i.width),r=h(n/e),o=r,a=h((i.height-n)/2),l=h((i.width-n)/2),c=l,d=a;return s&&(s.height=n,s.width=n,void 0!==s.x&&(c=s.x),void 0!==s.y&&(d=s.y),s.x=l,s.y=a),g(c,d,e,e,r,o)},gridXY([e,t],s=.9,n=.9,r=null){let o,a,l,c,d=h(i.height*n),u=h(i.width*s),p=h(u/e),m=h(d/t),f=p>m?m:p;return d=t*f,u=e*f,l=h((i.height-d)/2),c=h((i.width-u)/2),o=c,a=l,r&&(r.height=d,r.width=u,void 0!==r.x&&(o=r.x),void 0!==r.y&&(a=r.y),r.x=c,r.y=l),g(o,a,t,e,f,f)},gridBBox(e,t,i){let s=i[0].length,n=i[0][0],r=i[i.length-1][s-1];return{x1:e+n.x1,x2:e+r.x2,y1:t+n.y1,y2:t+r.y2}},graphics(e=null){let t=new i.PXGraphics;return(t.m5={uuid:`${e||r.nextId()}`})&&t},drawGridBox(e,t=1,i="white",s=null){return s||(s=this.graphics()),s.lineStyle(t,this.color(i)),s.drawRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),s},drawGridLines(e,t,i,s,n,r=null){let o=i.length,a=i[0].length;r||(r=this.graphics()),r.lineStyle(s,this.color(n));for(let s,n=1;n<o;++n)s=i[n],r.moveTo(e+s[0].x1,t+s[0].y1),r.lineTo(e+s[a-1].x2,t+s[a-1].y1);for(let s,n=1;n<a;++n)s=i[0],r.moveTo(e+s[n].x1,t+s[n].y1),s=i[o-1],r.lineTo(e+s[n].x1,t+s[n].y2);return r},shoot(e,t,i,s,r,o){let a=this.topLeftOffsetXY(e),h=s();return n.add$(a,[r,o]),n.copy(h,n.add(e,a)),n.set(h.m5.vel,Math.cos(t)*i,Math.sin(t)*i),h},group(...e){return 1===e.length&&o.vec(e[0])&&(e=e[0]),this.container((t=>e.forEach((e=>t.addChild(e)))))},add:(e,...t)=>(t.forEach((t=>t&&e.addChild(t))),e),remove(...e){1===e.length&&o.vec(e[0])&&(e=e[0]),r.doseqEx(e,(e=>{e.parent&&(r.inst(i.Scenes.Scene,e.parent)?e.parent.remove(e):e.parent.removeChild(e)),i.off(e),e.m5.dispose&&e.m5.dispose(),i.emit(["post.remove",e])}))},colorToRgbA(e){if(!e||!o.str(e)||0===e.length)return;let i=e.toLowerCase(),s=t[i];if(s&&(e=s),"#"==e[0])return e.length<7&&(e=`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}${e.length>4?e[4]+e[4]:""}`),[parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16),e.length>7?parseInt(e.substr(7,2),16)/255:1];if("transparent"==i)return[0,0,0,0];if(0===i.indexOf("rgb"))return i.indexOf("rgba")<0&&(i+=",1"),i.match(/[\.\d]+/g).map((e=>+e));throw`Error: Bad color: ${e}`},byteToHex:e=>("0"+e.toString(16)).slice(-2),colorToHex(e){const t=this.colorToRgbA(e);return"0x"+[0,1,2].map((e=>this.byteToHex(t[e]))).join("")},color(e){return isNaN(e)?parseInt(this.colorToHex(e)):e},rgba(e){return r.assert(o.vec(e),"wanted rgba array"),parseInt("0x"+[0,1,2].map((t=>this.byteToHex(e[t]))).join(""))},hsla(e,t,i,s){function n(e){return Math.min(1,Math.max(0,e))}function r(e){return 6*(e=e<0?e+1:e>1?e-1:e)<1?a+(o-a)*e*6:2*e<1?o:3*e<2?a+(o-a)*(2/3-e)*6:a}e=e%360/360,t=n(t),i=n(i),s=n(s);let o=i<=.5?i*(t+1):i+t-i*t,a=2*i-o;return this.rgba([255*r(e+1/3),255*r(e),255*r(e-1/3),s])},resize(e,t,i,s,n){e&&r.doseqEx(e.children,(t=>t.m5&&t.m5.resize&&t.m5.resize(e.x,e.y,e.width,e.height)))},pinTop(e,t,i=10,s=.5){let[r,o,a,h,l]=m(this,e),[c,d,u,p,g]=m(this,t,e),f=r.y1-i-(c.y2-c.y1),x=s<.3?r.x1:s<.7?h-d:r.x2-(c.x2-c.x1);t.y=t.anchor.y<.3?f:t.anchor.y<.7?f+u:f+(c.y2-c.y1),t.x=t.anchor.x<.3?x:t.anchor.x<.7?x+d:x+(c.x2-c.x1),t.parent===e&&n.sub$(t,e)},pinBottom(e,t,i=10,s=.5){let[r,o,a,h,l]=m(this,e),[c,d,u,p,g]=m(this,t,e),f=r.y2+i,x=s<.3?r.x1:s<.7?h-d:r.x2-(c.x2-c.x1);t.y=t.anchor.y<.3?f:t.anchor.y<.7?f+u:f+(c.y2-c.y1),t.x=t.anchor.x<.3?x:t.anchor.x<.7?x+d:x+(c.x2-c.x1),t.parent===e&&n.sub$(t,e)},pinCenter(e,t){let[i,s,r,o,a]=m(this,e),[h,l,c,d,u]=m(this,t,e),p=o-l,g=a-c;t.y=t.anchor.y<.3?g:t.anchor.y<.7?g+c:g+(h.y2-h.y1),t.x=t.anchor.x<.3?p:t.anchor.x<.7?p+l:p+(h.x2-h.x1),(e.m5.stage||t.parent===e)&&n.sub$(t,e)},pinLeft(e,t,i=10,s=.5){let[r,o,a,h,l]=m(this,e),[c,d,u,p,g]=m(this,t,e),f=r.x1-i-(c.x2-c.x1),x=s<.3?r.y1:s<.7?l-u:r.y2-(c.y2-c.y1);t.y=t.anchor.y<.3?x:t.anchor.y<.7?x+u:x+(c.y2-c.y1),t.x=t.anchor.x<.3?f:t.anchor.x<.7?f+d:f+(c.x2-c.x1),t.parent===e&&n.sub$(t,e)},pinRight(e,t,i=10,s=.5){let[r,o,a,h,l]=m(this,e),[c,d,u,p,g]=m(this,t,e),f=r.x2+i,x=s<.3?r.y1:s<.7?l-u:r.y2-(c.y2-c.y1);t.y=t.anchor.y<.3?x:t.anchor.y<.7?x+u:x+(c.y2-c.y1),t.x=t.anchor.x<.3?f:t.anchor.x<.7?f+d:f+(c.x2-c.x1),t.parent===e&&n.sub$(t,e)},setMass(e,t){e.m5.mass=t},genTexture:(e,t,i,s)=>l(e,t,i,s),bounceOff:e=>f(e.A,e.B,e),hit(e,t){let s=x(this,e,t);return s&&(i.emit(["hit",e],s),i.emit(["hit",t],s.swap())),s},collide(e,t,s=!0){let r=function(e,t,i,s=!0){let r=x(e,t,i);if(r){if(i.m5.static)n.sub$(t,r.overlapV);else{let e=n.div(r.overlapV,2);n.sub$(t,e),n.add$(i,e)}s&&f(t,i,r)}return r}(this,e,t,s);return r&&function(e){const t=new Set;return e.overlapN[1]<-.3&&t.add(i.TOP),e.overlapN[1]>.3&&t.add(i.BOTTOM),e.overlapN[0]<-.3&&t.add(i.LEFT),e.overlapN[0]>.3&&t.add(i.RIGHT),t}(r)},hitTest(e,t){return x(this,e,t)},clamp(e,t,n=!1,o=null){let a;t instanceof i.Scenes.Scene?a=i.mockStage():(t.m5&&t.m5.stage||(t.isSprite?r.assert(e.parent===t):r.assert(!1,"Error: clamp() using bad container"),r.assert(r.feq0(t.rotation),"Error: clamp() container can't rotate"),r.assert(r.feq0(t.anchor.x),"Error: clamp() container anchor.x !==0"),r.assert(r.feq0(t.anchor.y),"Error: clamp() container anchor.y !==0")),a=t);let h=this.topLeftOffsetXY(a),l=new Set,c=!1,d=!1,u=s.getAABB(this.toShape(e)),p=a.x+h[0],g=p+a.width,m=a.y+h[1],f=m+a.height,x=u.pos[0],y=u.pos[1];return x<p&&(e.x+=p-x,c=!0,l.add(i.LEFT)),x+u.width>g&&(e.x-=x+u.width-g,c=!0,l.add(i.RIGHT)),y<m&&(e.y+=m-y,d=!0,l.add(i.TOP)),y+u.height>f&&(e.y-=y+u.height-f,d=!0,l.add(i.BOTTOM)),l.size>0?(c&&(e.m5.vel[0]/=e.m5.mass,n&&(e.m5.vel[0]*=-1)),d&&(e.m5.vel[1]/=e.m5.mass,n&&(e.m5.vel[1]*=-1)),o&&o(l)):l=null,l},dbgShowCol(e){let t=[];if(o.set(e))for(let s of e.values())switch(s){case i.TOP:t.push("top");break;case i.LEFT:t.push("left");break;case i.RIGHT:t.push("right");break;case i.BOTTOM:t.push("bottom")}return t.join(",")}};return i.Sprites=y}if("object"==typeof module&&module.exports)throw"Panic: browser only";e["io/czlab/mojoh5/Sprites"]=function(e){return e.Sprites?e.Sprites:i(e)}}(this),function(e){"use strict";if("object"==typeof module&&module.exports)throw"Panic: browser only";e["io/czlab/mojoh5/Scenes"]=function(e){return e.Scenes?e.Scenes:function(e,t){const{ute:i,is:s}=e,n=Math.floor;function r(t=320,r=320){const o=new Map;return{searchAndExec(e,t){let i,s=e.m5.sgrid;for(let n,r,a=s.y1;a<=s.y2;++a)if(r=o.get(a))for(let o,h,l=s.x1;l<=s.x2;++l)if(n=r.get(l))for(o=n.values(),h=o.next();!h.done;){if(e!==h.value&&(i=t(e,h.value))){l=a=1/0;break}i=null,h=o.next()}return i},search(e,t=!1){let i,s,n=[],r=e.m5.sgrid;for(let a=r.y1;a<=r.y2;++a)if(s=o.get(a))for(let o=r.x1;o<=r.x2;++o)(i=s.get(o))&&i.forEach((i=>{(i!==e||t)&&n.push(i)}));return n},engrid(i,s){if(!i||!i.anchor)return;let o=e.Sprites.boundingBox(i),a=i.m5.sgrid,h=n(o.x1/t),l=n(o.y1/r),c=n(o.x2/t),d=n(o.y2/r);return a.x1===h&&a.x2===c&&a.y1===l&&a.y2===d||(this.degrid(i),a.x1=h,a.x2=c,a.y1=l,a.y2=d,s||this._register(i)),i},reset(){o.clear()},_register(e){let t=e.m5.sgrid;if(s.num(t.x1))for(let s,n,r=t.y1;r<=t.y2;++r){o.has(r)||o.set(r,new Map),n=o.get(r);for(let r=t.x1;r<=t.x2;++r)n.has(r)||n.set(r,new Map),s=n.get(r),i.assoc(s,e.m5.uuid,e)}},degrid(e){if(e&&e.anchor){let t=e.m5.sgrid;if(s.num(t.x1))for(let s,n,r=t.y1;r<=t.y2;++r)if(n=o.get(r))for(let r=t.x1;r<=t.x2;++r)(s=n.get(r))&&i.dissoc(s,e.m5.uuid)}}}}function o(e){return e.startsWith("scene::")?e:`scene::${e}`}function a(e){e&&(e.dispose&&e.dispose(),e.parent.removeChild(e))}class h extends e.PXContainer{constructor(e){super(),this.addChild(e),this.name=e.name,this.m5={stage:!0}}update(e){this.children[0].update(e)}}class l extends e.PXContainer{constructor(e,t,n){if(super(),this.name=o(e),this.g={},this.m5={sid:e,index:{},queue:[],garbo:[],options:n,stage:!0,sgrid:r(n.sgridX||320,n.sgridY||320)},s.fun(t))this.m5.setup=t.bind(this);else if(s.obj(t)){let e=i.dissoc(t,"setup");e&&(this.m5.setup=e.bind(this)),i.inject(this,t)}}_hitObjects(t,i,s,n=3){let r=n;for(let n,o,a=0,h=s.length;a<h&&(o=s[a],!(i!==o&&!o.m5.dead&&i.m5.cmask&o.m5.type&&(n=e.Sprites.hitTest(i,o),n&&(e.emit(["hit",i],n),n.B.m5.static?n=null:e.emit(["hit",n.B],n.swap()),t.engrid(i),0==--r))));++a);}collideXY(e){this._hitObjects(this.m5.sgrid,e,this.m5.sgrid.search(e))}onCanvasResize([t,i]){e.Sprites.resize({x:0,y:0,width:t,height:i,children:this.children})}future(e,t){this.m5.queue.push([e,t])}getChildById(e){return e&&this.m5.index[e]}remove(t){s.str(t)&&(t=this.getChildById(t)),t&&(this.removeChild(t),t.m5._engrid&&this.m5.sgrid.degrid(t),t.m5.drag&&e.Input.undoDrag(t),t.m5.button&&e.Input.undoButton(t),e.off(t),i.dissoc(this.m5.index,t.m5.uuid))}insert(e,t=!1){return this.insertAt(e,null,t)}insertAt(e,t,i=!1){return e=this._addit(e,t),i&&(e instanceof PIXI.TilingSprite||(e.m5._engrid=!0,this.m5.sgrid.engrid(e))),e}_addit(e,t){return s.num(t)&&t>=0&&t<this.children.length?this.addChildAt(e,t):this.addChild(e),this.m5.index[e.m5.uuid]=e}dispose(){e.off(this),this.m5.dead=!0,function t(i){if(i){i.children.length>0&&i.children.forEach((e=>t(e)));const s=e.Input;i.m5.button&&s.undoButton(i),i.m5.drag&&s.undoDrag(i)}}(this),this.removeChildren()}_tick(t,i){t.forEach((t=>{t.visible&&t.m5&&t.m5.tick&&(t.m5.tick(i),"x"==t.m5.flip&&(t.scale.x*=-1),"y"==t.m5.flip&&(t.scale.y*=-1),t.m5.flip=!1,e.emit(["post.tick",t],i),t.m5._engrid&&this.m5.sgrid.engrid(t)),t.children.length>0&&this._tick(t.children,i)}))}searchSGrid(e,t=!1){return this.m5.sgrid.search(e,t)}queueForRemoval(e){this.m5.garbo.push(e)}update(e){if(this.m5.dead)return;let t,s=this.m5.queue.filter((e=>(e[1]-=1,e[1]<=0)));for(;s.length>0;)i.disj(this.m5.queue,t=s.shift()),t[0]();this.preUpdate&&this.preUpdate(e),this._tick(this.children,e),this.postUpdate&&this.postUpdate(e),this.m5.garbo.forEach((e=>this.remove(e))),this.m5.garbo.length=0}runOnce(){this.m5.setup&&(this.m5.setup(this.m5.options),delete this.m5.setup)}}function c(t,s,r){const{Sprites:o}=e,a=e.getScaleFactor();if(0===t.length)return;let h,l=(s=i.patch(s,{color:0,padding:10,fit:20,borderWidth:4,border:16777215})).borderWidth*a,c=s.group||o.group(),d=s.padding*a,u=s.fit*a*2;t.forEach(((t,n)=>{s.skipAdd||c.addChild(t),i.assert(t.anchor.x<.3&&t.anchor.y<.3,"wanted topleft anchor"),n>0&&o[r===e.DOWN?"pinBottom":"pinRight"](h,t,d),h=t}));let[p,g]=[c.width,c.height],m=i.tail(t);if("transparent"!=s.bg){let e=o.rectangle(p+u,g+u,s.bg,s.border,l);e.alpha=0===s.opacity?0:s.opacity||.5,c.addChildAt(e,0)}g=c.height,p=c.width;let[f,x]=[n(p/2),n(g/2)];if(r===e.DOWN){t.forEach((e=>e.x=f-n(e.width/2)));let e=g-(m.y+m.height);e=n(e/2),t.forEach((t=>t.y+=e))}else{t.forEach((e=>e.y=x-n(e.height/2)));let e=p-(m.x+m.width);e=n(e/2),t.forEach((t=>t.x+=e))}return c.x=i.nor(s.x,n((e.width-p)/2)),c.y=i.nor(s.y,n((e.height-g)/2)),c}const d={Scene:l,SceneWrapper:h,layoutX:(t,i)=>c(t,i,e.RIGHT),layoutY:(t,i)=>c(t,i,e.DOWN),defScene(e,i,n){s.fun(i)&&(i={setup:i}),t[e]=[i,n]},replaceScene(t,i,n){const r=o(s.str(t)?t:t.name),a=e.stage.getChildByName(r);if(!a)throw`Fatal: no such scene: ${r}`;return this.runScene(i,e.stage.getChildIndex(a),n)},removeScene(...t){1===t.length&&s.vec(t[0])&&(t=t[0]),t.forEach((t=>{s.str(t)?a(e.stage.getChildByName(o(t))):t&&a(t)}))},removeScenes(){for(;e.stage.children.length>0;)a(e.stage.children[e.stage.children.length-1]);e.mouse.reset()},findScene:t=>e.stage.getChildByName(o(t)),runSceneEx(e,t,i){this.removeScenes(),this.runScene(e,t,i)},runScene(n,r,o){let c,d,u,p=t[n];if(!p)throw`Fatal: unknown scene: ${n}`;if(s.obj(r)&&(o=r,r=i.dissoc(o,"slot")),o=i.inject({},p[1],o),u=i.inject({},p[0]),s.undef(r)&&(r=o.slot||-1),e.mouse.reset(),o.tiled?(i.assert(o.tiled.name,"no tmx file!"),d=new e.Tiles.TiledScene(n,u,o)):d=new l(n,u,o),c=d,o.centerStage&&(c=new h(d)),r>=0&&r<e.stage.children.length){let t=e.stage.getChildAt(r);e.stage.addChildAt(c,r),a(t)}else e.stage.addChild(c);return d.runOnce(),d}};return e.Scenes=d}(e,{})}}(this),function(e){"use strict";if(!e.AudioContext)throw"Fatal: no audio.";const t=console;Math.floor;if("object"==typeof module&&module.exports)throw"Panic: browser only";e["io/czlab/mojoh5/Sound"]=function(i){return i.Sound?i.Sound:function(i,s){const{ute:n,is:r}=i;function o(e,t,i){const n={soundNode:null,buffer:null,src:i,name:t,loop:!1,playing:!1,vol:1,start:0,startOffset:0,playbackRate:1,gainNode:e.ctx.createGain(),panNode:e.ctx.createStereoPanner(),play(){this.start=e.ctx.currentTime,this.soundNode=e.ctx.createBufferSource(),this.soundNode.buffer=this.buffer,this.soundNode.playbackRate.value=this.playbackRate,this.soundNode.connect(this.gainNode),this.gainNode.connect(this.panNode),this.panNode.connect(e.ctx.destination),this.soundNode.loop=this.loop,this.soundNode.start(0,this.startOffset%this.buffer.duration),this.playing=!0},_stop(){this.playing&&(this.playing=!1),this.soundNode.stop(0)},pause(){this.playing&&(this._stop(),this.startOffset+=e.ctx.currentTime-this.start)},playFrom(e){this.startOffset=e,this._stop(),this.play()},restart(){this.playFrom(0)},get pan(){return this.panNode.pan.value},set pan(e){this.panNode.pan.value=e},get volume(){return this.vol},set volume(e){this.vol=e,this.gainNode.gain.value=e}};return s[t]=n}const a={ctx:new e.AudioContext,decodeData(e,i,s,n,r){let a=o(this,e,i);return this.ctx.decodeAudioData(s,(e=>{n(a.buffer=e),t.log(`decoded sound file:${i}`)}),(e=>{r&&r(i,e)})),a},decodeUrl(e,t,i,s){let n=new XMLHttpRequest,r=o(this,e,t);return n.open("GET",t,!0),n.responseType="arraybuffer",n.addEventListener("load",(()=>{this.decodeData(t,n.response,i,s)})),n.send(),r}};return i.sound=function(e){return s[i.assetPath(e)]||n.assert(!1,`Sound: ${e} not loaded.`)},i.Sound=a}(i,{})}}(this),function(e){"use strict";function t(t,i,s,n){const r=e["io/czlab/mcfud/geo2d"](),o=e["io/czlab/mcfud/vec2"](),{ute:a,is:h}=t,l=a.jsMap();const c={LEFT:37,RIGHT:39,UP:38,DOWN:40,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ENTER:13,ESC:27,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,SPACE:32,HOME:36,END:35,PGGUP:33,PGDOWN:34,ptr:null,resize(){this.ptr&&this.ptr.dispose(),t.mouse=this.pointer()},reset(){l.clear()},keybd(e,t,i){const s={press:t,release:i,isDown:!1,isUp:!0};function n(e){e.preventDefault(),s.code.includes(e.keyCode)&&(s.isUp&&s.press&&s.press(),s.isUp=!1,s.isDown=!0)}function r(e){e.preventDefault(),s.code.includes(e.keyCode)&&(s.isDown&&s.release&&s.release(),s.isUp=!0,s.isDown=!1)}return s.code=h.vec(e)?e:[e],a.addEvent([["keyup",window,r,!1],["keydown",window,n,!1]]),s.dispose=()=>{a.delEvent([["keyup",window,r],["keydown",window,n]])},s},undoButton:e=>(e.m5.enabled=!1,e.m5.button=!1,a.disj(s,e),e),makeButton:e=>(e.m5.enabled=!0,e.m5.button=!0,a.conj(s,e),e),update(e){n.length>0&&function(e){if(e&&e.state[0])if(e.dragged)o.set(e.dragged,e.x-e.dragOffsetX,e.y-e.dragOffsetY);else for(let i,s=n.length-1;s>=0;--s)if(i=n[s],i.m5.drag&&e.hitTest(i)){let s=i.parent.children,r=t.Sprites.gposXY(i);e.dragged=i,e.dragOffsetX=e.x-r[0],e.dragOffsetY=e.y-r[1],e.state[2]=!1,a.disj(s,i),a.conj(s,i),a.disj(n,i),a.conj(n,i);break}e&&e.state[1]&&(e.dragged&&e.dragged.m5.onDragDropped&&e.dragged.m5.onDragDropped(),e.dragged=null)}(this.ptr)},makeDrag:e=>(a.conj(n,e),e.m5.drag=!0,e),undoDrag:e=>(a.disj(n,e),e.m5.drag=!1,e),keyUp(e){return!this.keyDown(e)},keyDown:e=>!0===l.get(e),pointer(){let e={state:[!1,!0,!1],_visible:!0,_x:0,_y:0,width:1,height:1,downTime:0,elapsedTime:0,dragged:null,dragOffsetX:0,dragOffsetY:0,anchor:t.makeAnchor(.5,.5),get cursor(){return t.canvas.style.cursor},set cursor(e){t.canvas.style.cursor=e},get x(){return this._x/t.scale},get y(){return this._y/t.scale},get visible(){return this._visible},get isUp(){return this.state[1]},get isDown(){return this.state[0]},get isClicked(){return this.state[2]},set visible(e){this.cursor=e?"auto":"none",this._visible=e},getGlobalPosition(){return{x:this.x,y:this.y}},press(){for(let t,i=0,n=s.length;i<n;++i)if(t=s[i],t.m5.enabled&&t.m5.press&&e.hitTest(t)){t.m5.press(t);break}},tap(){e.press()},mouseDown(i){0===i.button&&(e._x=i.pageX-i.target.offsetLeft,e._y=i.pageY-i.target.offsetTop,e.downTime=a.now(),a.setVec(e.state,!0,!1,!0),i.preventDefault(),t.emit(["mousedown"]))},mouseMove(i){e._x=i.pageX-i.target.offsetLeft,e._y=i.pageY-i.target.offsetTop,t.emit(["mousemove"])},mouseUp(i){0===i.button&&(e.elapsedTime=Math.abs(e.downTime-a.now()),e._x=i.pageX-i.target.offsetLeft,e._y=i.pageY-i.target.offsetTop,a.setVec(e.state,!1,!0),e.state[2]&&(e.press(),e.state[2]=!1),i.preventDefault(),t.emit(["mouseup"]))},_copyTouch:(e,t)=>({offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,identifier:e.identifier}),touchStart(s){let n=s.changedTouches,r=s.target,o=n[0].identifier||0;e._x=n[0].pageX-r.offsetLeft,e._y=n[0].pageY-r.offsetTop,e.downTime=a.now(),a.setVec(e.state,!0,!1,!0),s.preventDefault(),a.assoc(i,o,e._copyTouch(n[0],r)),t.emit(["touchstart"])},touchMove(s){let n=s.changedTouches,r=s.target,o=n[0].identifier||0;a.get(i,o);e._x=n[0].pageX-r.offsetLeft,e._y=n[0].pageY-r.offsetTop,s.preventDefault(),t.emit(["touchmove"])},touchEnd(s){let n=s.changedTouches,r=s.target,o=n[0].identifier||0,h=a.get(i,o);e._x=n[0].pageX-r.offsetLeft,e._y=n[0].pageY-r.offsetTop,a.setVec(e.state,!1,!0),e.elapsedTime=Math.abs(e.downTime-a.now()),e.state[2]&&(h&&e.elapsedTime<=200&&e.tap(),e.state[2]=!1),s.preventDefault(),t.emit(["touchend"])},touchCancel(e){let t=e.changedTouches,s=(e.target,t[0],touch.identifier||0),n=a.get(i,s);e.preventDefault(),n&&a.dissoc(i,s)},reset(){a.setVec(e.state,!1,!0,!1),s.length=0,n.length=0},hitTest(i){let s=t.Sprites,n=s.gposXY(i),a=s.toPolygon(i),h=o.translate(n,a.calcPoints);return r.hitTestPointInPolygon(e.x,e.y,h)},dispose(){e.reset(),a.delEvent([["mousemove",t.canvas,e.mouseMove],["mousedown",t.canvas,e.mouseDown],["mouseup",window,e.mouseUp],["touchmove",t.canvas,e.touchMove],["touchstart",t.canvas,e.touchStart],["touchend",window,e.touchEnd],["touchcancel",window,e.touchCancel]])}};return a.addEvent([["mousemove",t.canvas,e.mouseMove],["mousedown",t.canvas,e.mouseDown],["mouseup",window,e.mouseUp],["touchmove",t.canvas,e.touchMove],["touchstart",t.canvas,e.touchStart],["touchend",window,e.touchEnd],["touchcancel",window,e.touchCancel]]),t.canvas.style.touchAction="none",this.ptr=e}};return a.addEvent([["keyup",window,function(e){e.preventDefault(),l.set(e.keyCode,!1)},!1],["keydown",window,function(e){e.preventDefault(),l.set(e.keyCode,!0)},!1]]),t.Input=c}if("object"==typeof module&&module.exports)throw"Panic: browser only";e["io/czlab/mojoh5/Input"]=function(e){return e.Input?e.Input:t(e,new Map,[],[])}}(this),function(e){"use strict";function t(e){const{is:t,ute:i}=e,s=Math.PI/8;function n(e,t,i){const s=+t,n=+i;return Math.min(1,Math.sqrt(s*s+n*n)/e.m5.outerRadius)}function r(t){function r(e){let i=e.changedTouches,s=e.target;i?(t.m5.startX=i[0].pageX-s.offsetLeft,t.m5.startY=i[0].pageY-s.offsetTop,t.m5.touchId=i[0].identifier):(t.m5.startX=e.pageX-s.offsetLeft,t.m5.startY=e.pageY-s.offsetTop,t.m5.touchId=0),t.m5.drag=!0,t.m5.inner.alpha=1,t.m5.onStart()}function o(e){t.m5.drag&&(t.m5.inner.alpha=t.m5.innerAlphaStandby,t.m5.inner.position.set(0,0),t.m5.drag=!1,t.m5.onEnd())}function a(i){if(!t.m5.drag)return;let r=i.changedTouches,o=i.target,a=null,h=null;if(r){for(let e=0;e<r.length;++e)if(t.m5.touchId===r[e].identifier){a=r[e].pageX-o.offsetLeft,h=r[e].pageY-o.offsetTop;break}}else a=i.pageX-o.offsetLeft,h=i.pageY-o.offsetTop;if(null===a||null===h)return;let l=a-t.m5.startX,c=h-t.m5.startY,d=0,u=0;if(a=0,h=0,0===l&&0===c)return;d=l*l+c*c>=t.m5.outerRadius*t.m5.outerRadius?t.m5.outerRadius:t.m5.outerRadius-t.m5.innerRadius;let p=e.LEFT,g=Math.abs(l),m=Math.abs(c),f=0;if(0===l)c>0?(a=0,h=c>t.m5.outerRadius?t.m5.outerRadius:c,u=270,p=e.BOTTOM):(a=0,h=-(m>t.m5.outerRadius?t.m5.outerRadius:m),u=90,p=e.TOP),t.m5.inner.position.set(a,h),f=n(t,a,h),t.m5.onChange(p,u,f);else if(0===c)l>0?(a=g>t.m5.outerRadius?t.m5.outerRadius:g,h=0,u=0,p=e.LEFT):(a=-(g>t.m5.outerRadius?t.m5.outerRadius:g),h=0,u=180,p=e.RIGHT),t.m5.inner.position.set(a,h),f=n(t,a,h),t.m5.onChange(p,u,f);else{let i=Math.abs(c/l),r=Math.atan(i);u=180*r/Math.PI,a=h=0,l*l+c*c>=t.m5.outerRadius*t.m5.outerRadius?(a=t.m5.outerRadius*Math.cos(r),h=t.m5.outerRadius*Math.sin(r)):(a=g>t.m5.outerRadius?t.m5.outerRadius:g,h=m>t.m5.outerRadius?t.m5.outerRadius:m),c<0&&(h=-Math.abs(h)),l<0&&(a=-Math.abs(a)),l>0&&c<0||(l<0&&c<0?u=180-u:l<0&&c>0?u+=180:l>0&&c>0&&(u=360-u)),f=n(t,a,h),p=function(t,i){const n=Math.atan2(+i,+t);let r=e.TOP_RIGHT;return n>=-s&&n<0||n>=0&&n<s?r=e.RIGHT:n>=s&&n<3*s?r=e.BOTTOM_RIGHT:n>=3*s&&n<5*s?r=e.BOTTOM:n>=5*s&&n<7*s?r=e.BOTTOM_LEFT:n>=7*s&&n<Math.PI||n>=-Math.PI&&n<-7*s?r=e.LEFT:n>=-7*s&&n<-5*s?r=e.TOP_LEFT:n>=-5*s&&n<-3*s&&(r=e.TOP),r}(a,h),t.m5.inner.position.set(a,h),t.m5.onChange(p,u,f)}}i.addEvent([["mousemove",e.canvas,a],["mousedown",e.canvas,r],["mouseup",window,o],["touchend",window,o],["touchcancel",window,o],["touchmove",e.canvas,a],["touchstart",e.canvas,r]])}const o={joystick(t){let s=i.inject({outerScaleX:1,outerScaleY:1,outerRadius:0,innerRadius:0,innerScaleX:1,innerScaleY:1,innerAlphaStandby:.5,onStart(){},onEnd(){},onChange(e,t,i){}},t),n=s.outer=e.Sprites.sprite("joystick.png"),o=s.inner=e.Sprites.sprite("joystick-handle.png"),a=new PIXI.Container;return a.m5=s,n.alpha=.5,n.anchor.set(.5),o.anchor.set(.5),o.alpha=s.innerAlphaStandby,n.scale.set(s.outerScaleX,s.outerScaleY),o.scale.set(s.innerScaleX,s.innerScaleY),a.addChild(n),a.addChild(o),s.outerRadius=a.width/2.5,s.innerRadius=o.width/2,r(a),a}};return e.Touch=o}if("object"==typeof module&&module.exports)throw"Panic: browser only";e["io/czlab/mojoh5/Touch"]=function(e){return e.Touch?e.Touch:t(e)}}(this),function(e){"use strict";if("object"==typeof module&&module.exports)throw"Panic: browser only";e["io/czlab/mojoh5/2d"]=function(t){return t["2d"]?t["2d"]:function(t){const i=e["io/czlab/mcfud/vec2"](),s=t.Sprites.color("white"),{is:n,ute:r}=t,o=Math.abs,a=Math.floor;t.Scenes.defScene("StarfieldBg",{setup(e){e.minVel||(e.minVel=15),e.maxVel||(e.maxVel=30),e.count||(e.count=100),e.width||(e.width=t.width),e.height||(e.height=t.height);let i=t.Sprites.graphics(),s=[];this.g.fps=1/e.fps,this.g.stars=s,this.g.gfx=i,this.g.lag=0;for(let t=0;t<e.count;++t)s[t]={x:r.rand()*e.width,y:r.rand()*e.height,size:3*r.rand()+1,vel:r.rand()*(e.maxVel-e.minVel)+e.minVel};this._draw(),this.insert(i)},_draw(){this.g.gfx.clear(),this.g.stars.forEach((e=>{this.g.gfx.beginFill(s),this.g.gfx.drawRect(e.x,e.y,e.size,e.size),this.g.gfx.endFill()}))},postUpdate(e){if(this.g.lag+=e,!(this.g.lag<this.g.fps)){this.g.lag=0;for(let t,s=0;s<this.g.stars.length;++s)t=this.g.stars[s],t.y+=e*t.vel,t.y>this.m5.options.height&&(i.set(t,r.rand()*this.m5.options.width,0),t.size=3*r.rand()+1,t.vel=r.rand()*(this.m5.options.maxVel-this.m5.options.minVel)+this.m5.options.minVel);this._draw()}}},{fps:30,count:100,minVel:15,maxVel:30}),t.defMixin("2d",(function(e,...s){const{Sprites:a}=t,h=[],l=[],c=[],d={dispose(){c.forEach((e=>e.dispose())),l.forEach((e=>t.off(...e)))},boom(s){if(r.assert(s.A===e,"got hit by someone else???"),s.B&&s.B.m5.sensor)t.emit(["2d.sensor",s.B],s.A);else{let[r,a]=e.m5.vel;s.impact=null,i.sub$(e,s.overlapV),s.overlapN[1]<-.3&&(!e.m5.skipHit&&a<0&&i.setY(e.m5.vel,0),s.impact=o(a),t.emit(["bump.top",e],s)),s.overlapN[1]>.3&&(!e.m5.skipHit&&a>0&&i.setY(e.m5.vel,0),s.impact=o(a),t.emit(["bump.bottom",e],s)),s.overlapN[0]<-.3&&(!e.m5.skipHit&&r<0&&i.setX(e.m5.vel,0),s.impact=o(r),t.emit(["bump.left",e],s)),s.overlapN[0]>.3&&(!e.m5.skipHit&&r>0&&i.setX(e.m5.vel,0),s.impact=o(r),t.emit(["bump.right",e],s)),n.num(s.impact)?t.emit(["bump",e],s):s.impact=0}h.shift(s)},onTick(t){h.length=0,n.num(t)&&(i.add$(e.m5.vel,i.mul(e.m5.gravity,t)),i.add$(e.m5.vel,i.mul(e.m5.acc,t)),i.mul$(e.m5.vel,e.m5.friction)),e.parent.collideXY(a.move(e,t)),c.forEach((e=>e.onTick(t,h)))}};l.push([["hit",e],"boom",d],[["post.remove",e],"dispose",d]),l.forEach((e=>t.on(...e)));for(let t,i,o,a=0;a<s.length;++a)o=s[a],t=o[0],o[0]=e,i=t(...o),i.onTick&&c.push(i),r.assert(n.str(t.name))&&(d[t.name]=i);return d})),t.defMixin("camera2d",(function(e,i,s,o){const h=o?o.height:s,l=o?o.width:i,c=a(h/2),d=a(l/2),u=a(h/4),p=a(l/4),{Sprites:g}=t,m=[];let f=0,x=0;const y={dispose(){m.forEach((e=>t.off(...e)))},set x(t){f=t,e.x=-f},set y(t){x=t,e.y=-x},get x(){return f},get y(){return x},worldWidth:i,worldHeight:s,width:l,height:h,follow(e){const t=r.feq0(e.angle)?g.getBBox(e):g.boundingBox(e);(()=>{t.x1<this.x+a(d-p)&&(this.x=t.x1-p)})(),(()=>{t.x2>this.x+a(d+p)&&(this.x=t.x2-3*p)})(),(()=>{t.y1<this.y+a(c-u)&&(this.y=t.y1-u)})(),(()=>{t.y2>this.y+a(c+u)&&(this.y=t.y2-3*u)})(),this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x+l>i&&(this.x=i-l),this.y+h>s&&(this.y=s-h);let{x1:n,x2:o,y1:m,y2:f}=e.m5.getImageOffsets(),x=t.x2-o;x>i&&(e.x-=x-i),x=t.y2-f,x>s&&(e.y-=x-s),x=t.x1+n,x<0&&(e.x+=-x),x=t.y1+m,x<0&&(e.y+=-x)},centerOver:function(e,t){if(1!==arguments.length||n.num(e))n.num(e)&&(this.x=e-d),n.num(t)&&(this.y=t-c);else{let t=g.centerXY(e);this.x=t[0]-d,this.y=t[1]-c}}};return m.push([["post.remove",e],"dispose",y]),m.forEach((e=>t.on(...e))),y}));const h={Patrol:function(e,s,n){const r=[],o={dispose(){r.forEach((e=>t.off(...e)))},goLeft(s){i.setX(e.m5.vel,-s.impact),e.m5.heading=t.LEFT,e.m5.flip="x"},goRight(s){i.setX(e.m5.vel,s.impact),e.m5.heading=t.RIGHT,e.m5.flip="x"},goUp(s){i.setY(e.m5.vel,-s.impact),e.m5.heading=t.UP,e.m5.flip="y"},goDown(s){i.setY(e.m5.vel,s.impact),e.m5.heading=t.DOWN,e.m5.flip="y"}};return r.push([["post.remove",e],"dispose",o]),s&&r.push([["bump.right",e],"goLeft",o],[["bump.left",e],"goRight",o]),n&&r.push([["bump.top",e],"goDown",o],[["bump.bottom",e],"goUp",o]),r.forEach((e=>t.on(...e))),o},Platformer:function(e){const{Input:s,Sprites:n}=t,r=[],o={jumpKey:s.UP,jumpSpeed:-300,_jumping:0,_ground:0,dispose(){r.forEach((e=>t.off(...e)))},onGround(){o._ground=.2},onTick(t,i){e.m5.skipHit||this._onTick(t,i),o._ground-=t},_onTick(n,r){let a=r[0],h=e.m5.speed,l=o.jumpSpeed/3,c=s.keyDown(s.RIGHT),d=s.keyDown(s.LEFT),u=s.keyDown(o.jumpKey);a&&(d||c||o._ground>0)&&(a.overlapN[1]>.85||a.overlapN[1]<-.85)&&(a=null),d&&!c?(e.m5.heading=t.LEFT,a&&o._ground>0?i.set(e.m5.vel,h*a.overlapN[0],-h*a.overlapN[1]):i.setX(e.m5.vel,-h)):c&&!d?(e.m5.heading=t.RIGHT,a&&o._ground>0?i.set(e.m5.vel,-h*a.overlapN[0],h*a.overlapN[1]):i.setX(e.m5.vel,h)):(i.setX(e.m5.vel,0),a&&o._ground>0&&i.setY(e.m5.vel,0)),o._ground>0&&!o._jumping&&u?(i.setY(e.m5.vel,o.jumpSpeed),o._jumping+=1,o._ground=-n):u&&o._jumping<2&&(o._jumping+=1,t.emit(["jump",e])),o._jumping&&!u&&(o._jumping=0,t.emit(["jumped",e]),e.m5.vel[1]<l&&(e.m5.vel[1]=l))}};return r.push([["bump.bottom",e],"onGround",o]),r.forEach((e=>t.on(...e))),o},MazeRunner:function(e,s){const{Sprites:n,Input:o}=t,a={onTick(n){let[a,h]=e.m5.vel,l=e.m5.speed,c=!r.feq0(a),d=!r.feq0(h);c&&d||!s||(d&&e.m5.showFrame(s[h>0?t.DOWN:t.UP]),c&&e.m5.showFrame(s[a>0?t.RIGHT:t.LEFT]));const u=o.keyDown(o.RIGHT)&&t.RIGHT,p=o.keyDown(o.DOWN)&&t.DOWN,g=o.keyDown(o.LEFT)&&t.LEFT,m=o.keyDown(o.UP)&&t.UP;(g||m)&&(l*=-1),g&&u?i.setX(e.m5.vel,0):(g||u)&&(i.setX(e.m5.vel,l),e.m5.heading=g||u),m&&p?i.setY(e.m5.vel,0):(m||p)&&(i.setY(e.m5.vel,l),e.m5.heading=m||p)}};return(e.m5.heading=t.UP)&&a},PeriodicDischarge:class{constructor(e,t,i=16,...s){this._interval=t,this._ctor=e,this._timer=0,this._size=i,this._pool=r.fill(i,e)}_take(){if(this._pool.length>0)return this._pool.pop()}reclaim(e){this._pool.length<this._size&&this._pool.push(e)}lifeCycle(e){this._timer+=e,this._timer>this._interval&&(this._timer=0,this.discharge())}discharge(){throw"PeriodicCharge: please implement action()"}}};return t["2d"]=h}(t)}}(this),function(e){"use strict";function t(t,i,s){const n=e["io/czlab/mcfud/math"](),r=e["io/czlab/mcfud/vec2"](),{ute:o,is:a}=t,h=Math.floor,l=5*Math.PI,c=Math.PI/2;Math.PI;function d(e,s,n=60,r=!1,h={}){return o.inject({sprite:e,easing:s,on:!1,curf:0,loop:r,frames:n,onFrame(e,t){},_run(){this.on=!0,this.curf=0,i.push(this)},onTick(){this.on&&(this.curf<this.frames?(this.onFrame(!1,this.easing(this.curf/this.frames)),this.curf+=1):(this.onFrame(!0),this.loop?(a.num(this.loop)&&--this.loop,this.onLoopReset(),this.curf=0):(this.on=!1,this.onComplete&&o.delay(0,(()=>this.onComplete())),this.dispose())))},dispose(){o.disj(i,this),t.emit(["tween.disposed"],this)}},h)}function u(e,t,i,s){return d(e,t,i,s,{start(e,t,i,s){this._x=a.num(t)?[e,t]:null,this._y=a.num(s)?[i,s]:null,this._run()},onLoopReset(){if(this._x){let[e,t]=this._x;this._x[0]=t,this._x[1]=e}if(this._y){let[e,t]=this._y;this._y[0]=t,this._y[1]=e}},onFrame(e,t){this._x&&(this.sprite.x=e?this._x[1]:n.lerp(this._x[0],this._x[1],t)),this._y&&(this.sprite.y=e?this._y[1]:n.lerp(this._y[0],this._y[1],t))}})}const p={EXPO_IN:e=>0===e?0:Math.pow(1024,e-1),EXPO_OUT:e=>1===e?1:1-Math.pow(2,-10*e),EXPO_INOUT:e=>0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1))),LINEAR:e=>e,SMOOTH:e=>3*e*e-2*e*e*e,SMOOTH_QUAD(e){let t=p.SMOOTH(e);return t*t},SMOOTH_CUBIC(e){let t=p.SMOOTH(e);return t*t*t},EASE_IN_CUBIC:e=>e*e*e,EASE_OUT_CUBIC(e){let t=1-e;return 1-t*t*t},EASE_INOUT_CUBIC(e){if(e<.5)return 4*e*e*e;{let t=-2*e+2;return 1-t*t*t/2}},EASE_IN_QUAD:e=>e*e,EASE_OUT_QUAD:e=>1-(1-e)*(1-e),EASE_INOUT_QUAD(e){if(e<.5)return 2*e*e;{let t=-2*e+2;return 1-t*t/2}},EASE_IN_SINE:e=>1-Math.cos(e*c),EASE_OUT_SINE:e=>Math.sin(e*c),EASE_INOUT_SINE:e=>.5-Math.cos(e*Math.PI)/2,SPLINE:(e,t,i,s,n)=>(2*i+(s-t)*e+(2*t-5*i+4*s-n)*e*e+(3*i-t-3*s+n)*e*e*e)/2,CUBIC_BEZIER:(e,t,i,s,n)=>t*e*e*e+3*i*e*e*(1-e)+3*s*e*(1-e)*(1-e)+n*(1-e)*(1-e)*(1-e),ELASTIC_IN:e=>0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*l),ELASTIC_OUT:e=>0===e?0:1===e?1:1+Math.pow(2,-10*e)*Math.sin((e-.1)*l),ELASTIC_INOUT(e){switch(e){case 0:return 0;case 1:return 1;default:return(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*l):1+.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*l)}},BOUNCE_IN:e=>1-p.BOUNCE_OUT(1-e),BOUNCE_OUT:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,BOUNCE_INOUT:e=>e<.5?.5*p.BOUNCE_IN(2*e):.5*p.BOUNCE_OUT(2*e-1)+.5,tweenAlpha(e,t,i,s=60,r=!1){const o=function(e,t,i,s){return d(e,t,i,s,{start(e,t){this._a=[e,t],this._run()},onLoopReset(){let[e,t]=this._a;this._a[0]=t,this._a[1]=e},onFrame(e,t){this.sprite.alpha=e?this._a[1]:n.lerp(this._a[0],this._a[1],t)}})}(e,t,s,r);let h=e.alpha,l=i;return a.vec(i)&&(h=i[0],l=i[1]),o.start(h,l),o},tweenScale(e,t,i,s,r=60,o=!1){const h=function(e,t,i,s){return d(e,t,i,s,{start(e,t,i,s){this._x=a.num(t)?[e,t]:null,this._y=a.num(s)?[i,s]:null,this._run()},onLoopReset(){if(this._x){let[e,t]=this._x;this._x[0]=t,this._x[1]=e}if(this._y){let[e,t]=this._y;this._y[0]=t,this._y[1]=e}},onFrame(e,t){this._x&&(this.sprite.scale.x=e?this._x[1]:n.lerp(this._x[0],this._x[1],t)),this._y&&(this.sprite.scale.y=e?this._y[1]:n.lerp(this._y[0],this._y[1],t))}})}(e,t,r,o);let l=e.scale.x,c=e.scale.y,u=i,p=s;return a.vec(i)&&(l=i[0],u=i[1]),a.vec(s)&&(c=s[0],p=s[1]),a.num(u)||(l=u=null),a.num(p)||(c=p=null),h.start(l,u,c,p),h},tweenXY(e,t,i,s,n=60,r=!1){const o=u(e,t,n,r);let h=e.x,l=e.y,c=i,d=s;return a.vec(i)&&(h=i[0],c=i[1]),a.vec(s)&&(l=s[0],d=s[1]),a.num(c)||(h=c=null),a.num(d)||(l=d=null),o.start(h,c,l,d),o},fadeOut(e,t=60){return this.tweenAlpha(e,this.EASE_OUT_SINE,0,t)},fadeIn(e,t=60){return this.tweenAlpha(e,this.EASE_OUT_SINE,1,t)},pulse(e,t=0,i=60,s=!0){return this.tweenAlpha(e,this.SMOOTH,t,i,s)},slide(e,t,i,s,n=60){return this.tweenXY(e,t,i,s,n)},breathe(e,t=.8,i=.8,s=60,n=!0){return this.tweenScale(e,this.SMOOTH_QUAD,t,i,s,n)},scale(e,t=.5,i=.5,s=60){return this.tweenScale(e,this.SMOOTH,t,i,s)},strobe(e,t=1.3,i=10,s=20,n=10,r=!0){return this.tweenScale(e,(e=>this.SPLINE(e,i,0,1,s)),t,t,n,r)},wobble(e,i,s=1.2,n=1.2,r=10,a=!0){let{x1:h,x2:l,y1:c,y2:d}=i;return function(...e){const i={children:e.slice(),onTweenEnd(e){for(let t,i=0;i<this.children.length;++i)if(t=this.children[i],t===e){this.children.splice(i,1);break}0===this.children.length&&(this.onComplete&&o.delay(0,(()=>this.onComplete())),this.dispose())},size(){return this.children.length},dispose(){t.off(["tween.disposed"],"onTweenEnd",this),this.children.forEach((e=>e.dispose())),this.children.length=0}};return t.on(["tween.disposed"],"onTweenEnd",i),i}(this.tweenScale(e,(e=>this.SPLINE(e,o.or(h,10),0,1,o.or(l,10))),s,null,r,a),this.tweenScale(e,(e=>this.SPLINE(e,o.or(c,-10),0,1,o.or(d,-10))),null,n,r,a))},followCurve(e,t,i,s=60){let n=u(e,t,s),o=this;return n.start=function(e){this._p=e,this._run()},n.onFrame=function(t,i){let s=this._p;t||r.set(e,o.CUBIC_BEZIER(i,s[0][0],s[1][0],s[2][0],s[3][0]),o.CUBIC_BEZIER(i,s[0][1],s[1][1],s[2][1],s[3][1]))},n.start(i),n},walkPath(e,t,i,s=300){let n=(s,r)=>{let a=this.tweenXY(e,t,[i[s][0],i[s+1][0]],[i[s][1],i[s+1][1]],r);return a.onComplete=()=>{++s<i.length-1&&o.delay(0,(()=>n(s,r)))},a};return n(0,h(s/i.length))},walkCurve(e,t,i,s=300){let n=(s,r)=>{let a=this.followCurve(e,t,i[s],r);return a.onComplete=()=>{++s<i.length&&o.delay(0,(()=>n(s,r)))},a};return n(0,h(s/i.length))},remove(e){e&&e.dispose()},update(e){o.rseq(i,(t=>t.onTick(e))),o.rseq(s,(t=>t.onTick(e)))},createParticles(e,i,n,a,h,l,c,d=!0,u=20){function p(d){let u=o.randInt2(l.size,c.size),p=n();s.push(p),a.addChild(p),p.totalFrames&&p.gotoAndStop(o.randInt2(0,p.totalFrames-1)),t.Sprites.sizeXY(p,u,u),r.set(p,e,i),t.Sprites.centerAnchor(p),p.m5.scaleSpeed=o.randFloat(l.scale,c.scale),p.m5.alphaSpeed=o.randFloat(l.alpha,c.alpha),p.m5.angVel=o.randFloat(l.rotate,c.rotate);let g=o.randFloat(l.speed,c.speed);r.set(p.m5.vel,g*Math.cos(d),g*Math.sin(d)),p.onTick=function(){r.add$(p.m5.vel,h),r.add$(p,p.m5.vel),p.scale.x-p.m5.scaleSpeed>0&&(p.scale.x-=p.m5.scaleSpeed),p.scale.y-p.m5.scaleSpeed>0&&(p.scale.y-=p.m5.scaleSpeed),p.rotation+=p.m5.angVel,p.alpha-=p.m5.alphaSpeed,p.alpha<=0&&(o.disj(s,p),t.Sprites.remove(p))}}l=o.patch(l,{angle:0,size:4,speed:.3,scale:.01,alpha:.02,rotate:.01}),c=o.patch(c,{angle:6.28,size:16,speed:3,scale:.05,alpha:.02,rotate:.03}),o.assert(u>1),h[0]=0;for(let e=(c.angle-l.angle)/(u-1),t=l.angle,i=0;i<u;++i)p(d?o.randFloat(l.angle,c.angle):t),t+=e},shake(e,t=16,i=!1,n=!0){let r={},a=1,l=e.x,c=e.y,d=e.rotation,u=t,p=h(t/10);let g=1;r.onTick=()=>i?void(a<10?(e.rotation=d,t-=p,e.rotation=t*g,++a,g*=-1):n?(t=u,a=1):o.disj(s,r)):void(a<10?(e.x=l,e.y=c,t-=p,e.x+=o.randInt2(-t,t),e.y+=o.randInt2(-t,t),++a):n?(t=u,a=1):o.disj(s,r)),s.push(r)}};return t.FX=p}if("object"==typeof module&&module.exports)throw"Panic: browser only";e["io/czlab/mojoh5/FX"]=function(e){return e.FX?e.FX:t(e,[],[])}}(this),function(e){"use strict";function t(t){const i=[t.UP,t.LEFT,t.RIGHT,t.DOWN],s=e["io/czlab/mcfud/vec2"](),{ute:n,is:r}=t,o=Math.abs,a=Math.ceil,h=Math.floor,l=[];function c(e,i,s){return t.getIndex(e,i,s.tiled.tileW,s.tiled.tileH,s.tiled.tilesInX)}function d(e,i){return s.vecAB(t.Sprites.centerXY(e),t.Sprites.centerXY(i))}function u(e){const t=e.image,i=t&&t.split("/");return i&&i.length&&i[i.length-1]}function p(e,t){let i=-1;if(e>0)for(i=0;t[i+1]&&e>=t[i+1][0];)++i;if(i>=0)return t[i]}function g(e,t,i){let s,o,a=[];return e.forEach((e=>{o={},e.image=u(e),r.num(e.spacing)||(e.spacing=0),a.push([e.firstgid,e]),e.tiles.forEach((t=>{s=n.inject(n.selectNotKeys(t,"properties"),m(t)),s.gid=e.firstgid+t.id,o[t.id]=s,i[s.gid]=s})),t[e.name]=o})),a.sort(((e,t)=>e[0]>t[0]?1:e[0]<t[0]?-1:0))}function m(e){return(e.properties||l).reduce(((e,t)=>(e[t.name]=t.value,e)),{})}function f(e,i,s){let o=r.str(i)?function(e){let i=t.resource(e,!0).data,s=i&&(i.tiledversion||i.version);return s&&n.cmpVerStrs(s,"1.4.2")>=0?i:n.assert(!1,`${e} needs update`)}(i):i,a={},l={};n.assert(r.obj(o),"bad tiled map"),n.inject(e.tiled,{tileW:o.tilewidth,tileH:o.tileheight,tilesInX:o.width,tilesInY:o.height,tiledMap:o,saved_tileW:o.tilewidth,saved_tileH:o.tileheight,tiledWidth:o.tilewidth*o.width,tiledHeight:o.tileheight*o.height},m(o));let c=e.getScaleFactor(),d=h(c*o.tilewidth),f=h(c*o.tileheight);n.isEven(d)||--d,n.isEven(f)||--f,e.tiled.new_tileW=d,e.tiled.new_tileH=f;const y={tilelayer(t){if(r.vec(t.data[0])&&(n.nichts(t.width)&&(t.width=t.data[0].length),n.nichts(t.height)&&(t.height=t.data.length),t.data=t.data.flat()),!1===t.visible)return;t.width||(t.width=e.tiled.tilesInX),t.height||(t.height=e.tiled.tilesInY);let i=m(t);for(let n,r=0;r<t.data.length;++r){if(0===(n=t.data[r]))continue;!1===t.collision||!1===i.collision||(t.collision=!0,n>0&&(e.tiled.collision[r]=n));let o=r%t.width,a=h(r/t.width),c=i.width,d=i.height,u=x(e,n,o,a,c,d),g=p(n,e.tiled.tileGidList)[1],m=l[n],f=m&&m.Class,y=f&&s[f];u.tiled.index=r,u.m5.static=!0,y&&(u=y.c(e,u,g,m)),u&&m&&m.sensor&&(u.m5.sensor=!0),e.insert(u,!!y)}},objectgroup(t){t.objects.forEach((t=>{n.assert(r.num(t.x),"wanted xy position");let i,o,a=n.or(t.gid,-1),c=m(t);a>0&&(o=l[a]),n.inject(t,c);let u=n.nor(o&&o.Class,t.Class),g=u&&s[u],y=e.tiled.saved_tileW,w=e.tiled.saved_tileH,T=h((t.x+y/2)/y),v=h((t.y-w/2)/w),b=p(a,e.tiled.tileGidList);b&&(b=b[1]),t.column=T,t.row=v,i=a>0?x(e,a,T,v,t.width,t.height,u):{width:d,height:f},g&&(i=g.c(e,i,b,o,t)),i&&(o&&o.sensor&&(i.m5.sensor=!0),e.insert(i,!0))}))},imagelayer(e){e.image=u(e)}};s=n.or(s,{}),n.inject(e.tiled,{tileProps:l,tileSets:a,objFactory:s,collision:n.fill(o.width*o.height,0),imagelayer:[],objectgroup:[],tilelayer:[],tileGidList:g(o.tilesets,a,l)}),["imagelayer","tilelayer","objectgroup"].forEach((t=>{o.layers.filter((e=>e.type==t)).forEach((i=>{y[t](i),e.tiled[t].push(i)}))})),e.tiled.tileW=d,e.tiled.tileH=f,e.tiled.tiledWidth=d*o.width,e.tiled.tiledHeight=f*o.height,e.parent instanceof t.Scenes.SceneWrapper&&(e.tiled.tiledHeight<t.height&&(e.parent.y=h((t.height-e.tiled.tiledHeight)/2)),e.tiled.tiledWidth<t.width&&(e.parent.x=h((t.width-e.tiled.tiledWidth)/2)))}function x(e,i,s,o,a,l,c){let d,u=p(i,e.tiled.tileGidList)[1],g=e.getScaleFactor(),m=u.columns,f=e.tiled.tileProps[i],x=i-u.firstgid;d=(c=n.nor(c,f&&f.Class))&&e.tiled.objFactory[c],n.assertNot(x<0,`Bad tile id: ${x}`),r.num(m)||(m=h(u.imagewidth/(u.tilewidth+u.spacing)));let y=x%m,w=h(x/m),T=y*u.tilewidth,v=w*u.tileheight;u.spacing>0&&(T+=u.spacing*y,v+=u.spacing*w);let b=d&&d.s()||t.Sprites.frame(u.image,a||u.tilewidth,l||u.tileheight,T,v);return b.tiled={gid:i,id:x},a===e.tiled.saved_tileW?b.width=e.tiled.new_tileW:(b.scale.x=g,b.width=h(b.width),n.isEven(b.width)||--b.width),l===e.tiled.saved_tileH?b.height=e.tiled.new_tileH:(b.scale.y=g,b.height=h(b.height),n.isEven(b.height)||--b.height),b.x=s*e.tiled.new_tileW,b.y=o*e.tiled.new_tileH,b}const y={width:0,height:0,parent:null,x:0,y:0,rotation:0,tiled:{},anchor:{x:0,y:0},getGlobalPosition(){return{x:this.x+this.parent.x,y:this.y+this.parent.y}}};class w extends t.Scenes.Scene{constructor(e,i,s){super(e,i,s),this.tiled={},y.parent=this,t.Sprites.extend(y)}reloadMap(e){let t=this.m5.options.tiled=e;this.tiled={},f(this,t.name,t.factory)}runOnce(){let e=this.m5.options.tiled;f(this,e.name,e.factory),super.runOnce()}removeTile(e){let i=e.x,s=e.y;e.anchor.x<.3&&(i=e.x+h(e.width/2),s=e.y+h(e.height/2));let r=h(i/this.tiled.tileW),o=h(s/this.tiled.tileH)*this.tiled.tilesInX+r,a=this.tiled.collision.length;n.assert(o>=0&&o<a,"bad index to remove"),this.tiled.collision[o]=0,t.Sprites.remove(e)}getTileLayer(e,t){let i=n.some(this.tiled.tilelayer,(t=>{if(t.name==e)return t}));if(!i&&t)throw`There is no layer with name: ${e}`;return i}getObjectGroup(e,t){let i=n.some(this.tiled.objectgroup,(t=>{if(t.name==e)return t}));if(!i&&t)throw`There is no group with name: ${e}`;return i}setTile(e,t,i,s){let n=this.tiled.tilesInX*t+i,r=this.getTileLayer(e),o=this.getTSInfo(s);o.firstgid;return r.collision&&(this.tiled.collision[n]=s),x(this,s,i,t,o.tilewidth,o.tileheight)}getTile(e){let t=e.x,i=e.y;return e.anchor.x<.3&&(i+=h(e.height/2),t+=h(e.width/2)),this.getTileXY(t,i)}getTileXY(e,t){let i=h(e/this.tiled.tileW),s=h(t/this.tiled.tileH);return n.assert(i>=0&&i<this.tiled.tilesInX,`bad tile col:${i}`),n.assert(s>=0&&s<this.tiled.tilesInY,`bad tile row:${s}`),[i,s]}getNamedItem(e){let t=[];return this.tiled.objectgroup.forEach((i=>{i.objects.forEach((s=>{e==n.get(s,"name")&&t.push(i)}))})),t}getScaleFactor(){let e,i,s=1;return"max"==t.u.scaleToWindow&&(t.width>t.height?(i=t.height/(this.tiled.saved_tileH*this.tiled.tilesInY),s=i):(e=t.width/(this.tiled.saved_tileW*this.tiled.tilesInX),s=e)),s}getTileIndex(e){let[i,s]=t.Sprites.centerXY(e);return c(i,s,this)}getTSInfo(e){return p(e,this.tiled.tileGidList)[1]}getTileProps(e){return this.tiled.tileProps[e]}_getContactObj(e,t,i){let s=y;return s.height=this.tiled.tileH,s.width=this.tiled.tileW,s.x=t*s.width,s.y=i*s.height,s.tiled.gid=e,s.tiled.row=i,s.tiled.col=t,s.m5.sensor=!1,s}collideXY(e){let i=t.Sprites,s=this.tiled.tileW,o=this.tiled.tileH,l=this.tiled.collision,c=n.feq0(e.rotation)?i.getBBox(e):i.boundingBox(e),d=Math.max(0,h(c.x1/s)),u=Math.max(0,h(c.y1/o)),p=Math.min(this.tiled.tilesInX-1,a(c.x2/s)),g=Math.min(this.tiled.tilesInY-1,a(c.y2/o));for(let i,s,o,a,h=u;h<=g;++h)for(let c=d;c<=p;++c)o=h*this.tiled.tilesInX+c,s=l[o],r.num(s)||n.assert(r.num(s),"bad gid"),0!==s&&(a=this._getContactObj(s,c,h),i=this.getTileProps(s),i&&(a.m5.sensor=!!i.sensor),t.Sprites.hit(e,a)&&a.m5.sensor&&t.emit(["tile.sensor",e],a));return super.collideXY(e)}}class T{constructor(e){e[0].length;let t=e.length-1,i=e[0],s=e[1],r=(e[t],i[1].x1-i[0].x2),o=s[0].y1-i[0].y2;n.assert(r===o),this._grid=e,this._gap=r}drawBox(e="white"){return t.Sprites.drawBody((t=>this._draw(t,e,!0)))}draw(e="white"){return t.Sprites.drawBody((t=>this._draw(t,e)))}_draw(e,t="white",i=!1){let s=this._grid[0].length,n=this._grid.length,r=s-1,o=n-1,a=this._grid[0],h=this._grid[o];a[0],h[r];e.lineStyle(this.gap,_S.color(t));for(let t,s=0;s<n;++s)t=this._grid[s],0===s&&(e.moveTo(t[s].x1,t[s].y1),e.lineTo(a[r].x2,a[r].y1)),s===o?(e.moveTo(t[0].x1,t[0].y2),e.lineTo(t[r].x2,t[r].y2)):i||(e.moveTo(t[0].x1,t[0].y2),e.lineTo(t[r].x2,t[r].y2));for(let t=0;t<s;++t)0===t&&(e.moveTo(a[t].x1,a[t].y1),e.lineTo(h[t].x1,h[t].y2)),t===r?(e.moveTo(a[t].x2,a[t].y1),e.lineTo(h[t].x2,h[t].y2)):i||(e.moveTo(a[t].x2,a[t].y1),e.lineTo(h[t].x2,h[t].y2))}cell(e,t){return this._grid[e][t]}get gap(){return this._gap}get data(){return this._grid}}class v{constructor(e,t){this.straightCost=e,this.diagonalCost=t}manhattan(e,t){return o(e.row-t.row)*this.straightCost+o(e.col-t.col)*this.straightCost}euclidean(e,t){let i=t.col-e.col,s=t.row-e.row;return h(n.sqrt(i*i+s*s)*this.straightCost)}diagonal(e,t){let i=o(t.col-e.col),s=o(t.row-e.row);return h(i>s?this.diagonalCost*s+this.straightCost*(i-s):this.diagonalCost*i+this.straightCost*(s-i))}}const b={TiledScene:w,mapGridPos(e,i,s=.8,n="center"){let o,a,l,c,d,u,p,g,m,f,x,y,w,v=[];switch(r.vec(e)?[m,f]=e:m=f=e,i<0&&(i=0),p=i*(m+1),g=i*(f+1),x=t.portrait()?h((s*t.width-p)/m):h(s*(t.height-g)/f),y=x*m+p,w=x*f+g,a=h((t.height-w)/2),n){case"right":o=t.width-y;break;case"left":o=0;break;default:o=h((t.width-y)/2)}o+=i,l=o,a+=i,c=a;for(let e,t=0;t<f;++t){e=[];for(let t=0;t<m;++t)u=c+x,d=l+x,e.push({x1:l,x2:d,y1:c,y2:u}),l=d+i;v.push(e),c=u+i,l=o}return new T(v)},neighborCells(e,t,i){let s=t.tiled.tilesInX,n=[e-s-1,e-s,e-s+1,e-1],r=[e+1,e+s-1,e+s,e+s+1];return i||n.push(e),n.concat(r)},updateMap(e,t,i){let s=n.fill(e.length,0),o=e=>{let t=this.getTileIndex(e,i);n.assert(t>=0&&t<s.length,"tiled index outofbound"),e.tiled.index=t,s[t]=e.tiled.gid};return r.vec(t)?t.forEach(o):o(t),s},shortestPath(e,t,i,s,n=[],r="manhattan",o=!0){let a=s.tiled.tilesInX,l=i.map(((e,t)=>({f:0,g:0,h:0,parent:null,index:t,col:t%a,row:h(t/a)}))),c=l[t],d=l[e],u=d,p=[u],g=[],m=[],f=e=>(o?this.neighborCells(e,s,!0):this.crossCells(e,s)).map((e=>l[e])).filter((t=>{if(t){let s=e%a==0,r=(e+1)%a==0,o=t.col%(a-1)==0&&0!==t.col,h=t.col%a==0,l=n.some((e=>i[t.index]===e));return s?!o:r?!h:!l}}));for(;u!==c;){let e=f(u.index);for(let t,i,s,n,o,a=0;a<e.length;++a){o=e[a],n=14,u.row!==o.row&&u.col!==o.col||(n=10),i=u.g+n,t=i+new v(10,14)[r](o,c);let h=p.some((e=>o===e)),l=g.some((e=>o===e));h||l?o.f>t&&(o.f=t,o.g=i,o.h=s,o.parent=u):(o.f=t,o.g=i,o.h=s,o.parent=u,p.push(o))}if(g.push(u),0===p.length)return m;p=p.sort(((e,t)=>e.f-t.f)),u=p.shift()}if(0!==p.length){let e=c;for(m.push(e);e!==d;)e=e.parent,m.unshift(e)}return m},lineOfSight(e,i,n,r,o=0,a=32,l=[]){let u,p,g,m,f,x=d(e,i),y=s.len(x),w=h(y/a),T=[];for(let i,s=1;s<=w;++s)i=t.Sprites.centerXY(e),u=a*s,m=x[0]/y,f=x[1]/y,p=h(i[0]+m*u),g=h(i[1]+f*u),T.push({x:p,y:g,index:c(p,g,r)});let v=180*Math.atan2(x[1],x[0])/Math.PI;return T.every((e=>n[e.index]===o))&&(0===l.length||l.some((e=>e===v)))},crossCells(e,t){const i=t.tiled.tilesInX;return[e-i,e-1,e+1,e+i]},getCrossTiles(e,t,i){return this.crossCells(e,i).map((e=>t[e]))},getDiagonalCells(e,t){const i=r.num(t)?t:t.tiled.tilesInX;return[e-i-1,e-i+1,e+i-1,e+i+1]},getDiagonalTiles(e,t,i){return this.getDiagonalCells(e,i).map((e=>t[e]))},validDirections(e,s,n,r){const o=this.getTileIndex(e,r);return this.getCrossTiles(o,s,r).map(((e,s)=>e===n?i[s]:t.NONE)).filter((e=>e!==t.NONE))},canChangeDirection(e=[]){let i=e.find((e=>e===t.UP)),s=e.find((e=>e===t.DOWN)),n=e.find((e=>e===t.LEFT)),r=e.find((e=>e===t.RIGHT));return 0===e.length||1===e.length||(i||s)&&(n||r)},randomDirection:(e=[])=>0===e.length?t.TRAPPED:1===e.length?e[0]:e[n.randInt2(0,e.length-1)],closestDirection(e,i){const s=d(e,i);return o(s[0])<o(s[1])?s[1]<=0?t.UP:t.DOWN:s[0]<=0?t.LEFT:t.RIGHT}};return t.Tiles=b}if("object"==typeof module&&module.exports)throw"Panic: browser only";e["io/czlab/mojoh5/Tiles"]=function(e){return e.Tiles?e.Tiles:t(e)}}(this);